<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yeyuan1107.github.io</id>
    <title>YBLOG</title>
    <updated>2022-07-06T03:14:16.031Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yeyuan1107.github.io"/>
    <link rel="self" href="https://yeyuan1107.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://yeyuan1107.github.io/images/avatar.png</logo>
    <icon>https://yeyuan1107.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, YBLOG</rights>
    <entry>
        <title type="html"><![CDATA[å¸¸è§æ’åºç®—æ³•ï¼ˆä¸‹ï¼‰]]></title>
        <id>https://yeyuan1107.github.io/post/chang-jian-pai-xu-suan-fa-xia/</id>
        <link href="https://yeyuan1107.github.io/post/chang-jian-pai-xu-suan-fa-xia/">
        </link>
        <updated>2022-06-28T06:39:27.000Z</updated>
        <content type="html"><![CDATA[<h1 id="è®¡æ•°æ’åº">è®¡æ•°æ’åº</h1>
<ul>
<li>å‡†å¤‡å¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§-maxå’Œæœ€å°-minçš„å…ƒç´ ï¼Œå‡†å¤‡ä¸€ä¸ªé•¿åº¦ä¸ºï¼ˆmax-min+1ï¼‰è¾…åŠ©è®¡æ•°æ•°ç»„helpã€‚</li>
<li>åˆ†é…:ç»Ÿè®¡åŸæ•°ç»„ä¸­å€¼ä¸ºarr[i]çš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥è¾…åŠ©è®¡æ•°æ•°ç»„å¯¹åº”arr[i]-minçš„ç´¢å¼•ä½ç½®å¤„ã€‚</li>
<li>æ”¶é›†: æ”¶é›†:æ ¹æ®è¾…åŠ©æ•°ç»„çš„åå‘ä»index=0å¼€å§‹å¡«å……ç›®æ ‡æ•°ç»„ã€‚å¾ªç¯åˆ¤æ–­è¾…åŠ©æ•°ç»„ç´¢å¼•ä¸ºiçš„å…ƒç´ å€¼help[i]æ˜¯å¦&gt;0ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™åŸæ•°ç»„arr[index++]=i + min</li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        // stream è·å–æœ€å¤§æœ€å°å€¼æ–¹æ³•
        int max = Arrays.stream(nums).max().getAsInt();
        int min = Arrays.stream(nums).min().getAsInt();
        int[] support = new int[max - min + 1];
        for(int num : nums){
            support[num - min]++;
        }
        int index = 0;
        for(int i = 0 ; i &lt; support.length ; i++){
            int times = support[i];
            while(times-- &gt; 0){
                nums[index++] = i + min;
            }
        }
        return nums;
    }
}
</code></pre>
<h1 id="æ¡¶æ’åº">æ¡¶æ’åº</h1>
<p>æ¡¶æ’åºï¼ˆBucket sortï¼‰åˆè¢«ç§°ä¸ºç®±æ’åºã€‚å‰é¢è®²çš„è®¡æ•°æ’åºï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼ç›¸å·®å¤šå°‘å°±å‡†å¤‡å¤šå°‘ä¸ªæ¡¶ï¼Œè¯•æƒ³å¦‚æœæœ€å¤§å€¼å’Œæœ€å°å€¼ç›¸å·®è¿‡å¤§çš„è¯ï¼Œä¼šé€ æˆæ¡¶çš„æ•°é‡è¿‡å¤šï¼Œç©ºé—´å¤æ‚åº¦å¤§å¹…åº¦æå‡ã€‚è®¡æ•°æ’åºä¸å†é€‚ç”¨ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨æ¡¶æ’åºã€‚<br>
ç¨³å®šæ€§ï¼šæ¡¶æ’åºæ˜¯å¦ç¨³å®šå–å†³äºæ¯ä¸ªæ¡¶é‡‡ç”¨çš„æ’åºç®—æ³•ï¼Œå› ä¸ºæ¡¶æ’åºå¯ä»¥åšåˆ°ç¨³å®šï¼Œæ‰€ä»¥æ¡¶æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚<br>
æ¡¶æ’åºè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å‡†å¤‡å¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§-maxå’Œæœ€å°-minçš„å…ƒç´ ï¼Œå‡†å¤‡ä¸€ä¸ªæ¡¶å®¹å™¨ï¼Œæ¯ä¸ªæ¡¶é‡Œæ”¾çš„å…ƒç´ ç”¨listå­˜å‚¨ï¼Œå› ä¸ºæ¯ä¸ªæ¡¶å­˜æ”¾å…ƒç´ çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ã€‚æ¡¶çš„æ•°é‡ä¸ºk=(max-min)/arr.length+1ã€‚</li>
<li>éå†æ•°ç»„ arrï¼ŒæŒ‰ä¸€å®šçš„æ˜ å°„è§„åˆ™ï¼ˆè¿™ç±»ä¼¼äºå“ˆå¸Œè¡¨ï¼‰è®¡ç®—æ¯ä¸ªå…ƒç´ æ”¾çš„æ¡¶ä½ç½®ï¼Œå¹¶å°†å¾…æ’åºå…ƒç´ åˆ’åˆ†åˆ°ä¸åŒçš„æ¡¶ã€‚</li>
<li>æ¯ä¸ªæ¡¶å„è‡ªæ’åºï¼Œä¸€èˆ¬é‡‡ç”¨å¿«é€Ÿæ’åºã€‚</li>
<li>é¡ºåºéå†æ¡¶é›†åˆï¼ŒæŠŠæ’åºå¥½çš„å…ƒç´ å›å†™è¿›åŸæ•°ç»„ã€‚</li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        int max = Arrays.stream(nums).max().getAsInt();
        int min = Arrays.stream(nums).min().getAsInt();
        // è®¡ç®—æ¡¶æ•°ç»„çš„é•¿åº¦
        int bucketNums = (max - min) / nums.length + 1;
        List&lt;Integer&gt;[] buckets = new List[bucketNums];
        // è®¡ç®—æ¯ä¸ªæ¡¶çš„è£…è½½èŒƒå›´
        int bucketRange = (max - min + 1) / bucketNums;
        for(int i = 0 ; i &lt; buckets.length ; i++){
            buckets[i] = new ArrayList&lt;&gt;();
        }
        for(int num : nums){
            // è®¡ç®—å½“å‰æ•°å€¼åº”è¯¥æ”¾å…¥åˆ°å“ªä¸ªæ¡¶ä¸­
            int index = (num - min) / (bucketRange + 1);
            buckets[index].add(num);
        }
        int index = 0;
        for(List&lt;Integer&gt; list : buckets){
            Collections.sort(list);
            for (Integer integer : list) {
                nums[index++] = integer;
            }
        }
        return nums;

    }
}
</code></pre>
<h1 id="åŸºæ•°æ’åº">åŸºæ•°æ’åº</h1>
<ul>
<li>æœ‰è´Ÿæ•°ä¸è¡Œ</li>
<li>å°†æ‰€æœ‰å¾…æ’åºéè´Ÿæ•´æ•°ç»Ÿä¸€ä¸ºä½æ•°ç›¸åŒçš„æ•´æ•°ï¼Œä½æ•°è¾ƒå°‘çš„å‰é¢è¡¥é›¶ã€‚ä¸€èˆ¬ç”¨10è¿›åˆ¶ï¼Œä¹Ÿå¯ä»¥ç”¨16è¿›åˆ¶ç”šè‡³2è¿›åˆ¶ï¼Œæ‰€æœ‰çš„å‰ææ˜¯èƒ½å¤Ÿæ‰¾åˆ°æœ€å¤§å€¼ï¼Œå¾—åˆ°æœ€é•¿çš„ä½æ•°ï¼Œè®¾kè¿›åˆ¶ä¸‹æœ€é•¿ä¸ºä½æ•°ä¸ºdã€‚å®é™…ä¸Šç›¸åŒä½æ•°ä¸Šçš„å€¼å°±æ˜¯è¦æ¯”è¾ƒçš„å¤šä¸ªé”®ã€‚</li>
<li>å¯¹ç›¸åŒçš„ä½æ•°ä¸Šçš„æ•°å€¼æŒ‰ç…§å¤§å°è¿›è¡Œç¨³å®šæ’åºï¼ˆå› ä¸ºç¨³å®šæ’åºèƒ½å¤Ÿå°†ä¸Šä¸€æ¬¡æ’åºçš„æˆæœä¿ç•™ä¸‹æ¥ã€‚ä¾‹å¦‚åä½æ•°çš„æ’åºè¿‡ç¨‹èƒ½ä¿ç•™ä¸ªä½æ•°çš„æ’åºæˆæœï¼Œç™¾ä½æ•°çš„æ’åºè¿‡ç¨‹èƒ½ä¿ç•™åä½æ•°çš„æ’åºæˆæœï¼‰ã€‚åŸºæ•°æ’åºçš„æ–¹å¼å¯ä»¥é‡‡ç”¨LSDï¼ˆLeast significant digitalï¼‰æˆ–MSDï¼ˆMost significant digitalï¼‰ï¼ŒLSDçš„æ’åºæ–¹å¼ç”±é”®å€¼çš„æœ€å³è¾¹å¼€å§‹ï¼Œè€ŒMSDåˆ™ç›¸åï¼Œç”±é”®å€¼çš„æœ€å·¦è¾¹å¼€å§‹ã€‚
<ul>
<li>MSDï¼šå…ˆä»é«˜ä½å¼€å§‹è¿›è¡Œæ’åºï¼Œåœ¨æ¯ä¸ªå…³é”®å­—ä¸Šï¼Œå¯é‡‡ç”¨è®¡æ•°æ’åºã€‚</li>
<li>LSDï¼šå…ˆä»ä½ä½å¼€å§‹è¿›è¡Œæ’åºï¼Œåœ¨æ¯ä¸ªå…³é”®å­—ä¸Šï¼Œå¯é‡‡ç”¨æ¡¶æ’åºã€‚</li>
</ul>
</li>
</ul>
<pre><code class="language-java">class Solution {
    int[] digit;
    public int[] sortArray(int[] nums) {
        int[] help = new int[10];
        int[] temp = new int[nums.length];
        int max = Arrays.stream(nums).max().getAsInt();
        int len = String.valueOf(max).length();
        digit = new int[len];
        digit[0] = 1;
        for(int i = 1 ; i &lt; len ; i++){
            digit[i] = digit[i - 1] * 10;
        }
        for(int k = 1 ; k &lt;= len ; k++){
            Arrays.fill(help, 0);
            for(int num : nums){
                help[getNum(num, k)]++;
            }
            // é€šè¿‡helpæ•°ç»„ç›´æ¥æ‰¾åˆ°å¯¹åº”çš„index
            for(int i = 1; i &lt; help.length ; i++){
                help[i] += help[i - 1];
            }
            // ä¸€å®šè¦ä»åå‘å‰éå†ï¼Œä¿è¯ç›¸å¯¹é¡ºåºä¸å˜
            for(int i = nums.length - 1 ; i &gt;= 0 ; i--){
                temp[help[getNum(nums[i], k)] - 1] = nums[i];
                help[getNum(nums[i], k)]--;
            }
            for(int i = 0 ; i &lt; nums.length ; i++){
                nums[i] = temp[i];
            }

        }
        return nums;


    }

    /**
     * ç”¨äºè®¡ç®—numä»ä½åˆ°é«˜ä½kä½çš„æ•°å€¼
     * @param num
     * @param k
     * @return kä½æ•°å€¼
     */
    public int getNum(int num, int k){
        return (num / digit[k - 1]) % 10;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¸¸è§æ’åºç®—æ³•ï¼ˆä¸Šï¼‰]]></title>
        <id>https://yeyuan1107.github.io/post/chang-jian-pai-xu-suan-fa-shang/</id>
        <link href="https://yeyuan1107.github.io/post/chang-jian-pai-xu-suan-fa-shang/">
        </link>
        <updated>2022-06-28T02:38:40.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æœ¬æ–‡ç« æ€»ç»“äº†ä¸ƒç§æ¯”è¾ƒæ’åºç®—æ³•</p>
</blockquote>
<h1 id="å†’æ³¡æ’åº">å†’æ³¡æ’åº</h1>
<ul>
<li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚</li>
<li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚</li>
<li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚</li>
<li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚</li>
<li><code>O(n2)</code></li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        int len = nums.length;
        for(int i = 0 ; i &lt; len - 1 ; i++){
            boolean flag = true;
            for(int j = 0 ; j &lt; len - 1 - i ; j++){
                if(nums[j] &gt; nums[j + 1]){
                    swap(nums, j, j+1);
                    flag = false;
                }
            }
            if (flag) break;
        }
        return nums;
    }

    public void swap(int[] nums, int left, int right){
        int temp = nums[left];
        nums[left] = nums[right];
        nums[right] = temp;
    }
}

</code></pre>
<h1 id="é€‰æ‹©æ’åº">é€‰æ‹©æ’åº</h1>
<ul>
<li>é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</li>
<li>å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</li>
<li>é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</li>
<li><code>O(n2)</code></li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        int len = nums.length;
        for(int i = 0 ; i &lt; len - 1 ; i++){
            int index = i;
            for(int j = i + 1 ; j &lt; len ; j++){
                if(nums[j] &lt; nums[index]){
                    index = j;
                }
            }
            swap(nums, i, index);
        }
        return nums;
    }

    public void swap(int[] nums, int left, int right){
        int temp = nums[left];
        nums[left] = nums[right];
        nums[right] = temp;
    }
}
</code></pre>
<h1 id="æ’å…¥æ’åº">æ’å…¥æ’åº</h1>
<ul>
<li>å°†ç¬¬ä¸€å¾…æ’åºåºåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ çœ‹åšä¸€ä¸ªæœ‰åºåºåˆ—ï¼ŒæŠŠç¬¬äºŒä¸ªå…ƒç´ åˆ°æœ€åä¸€ä¸ªå…ƒç´ å½“æˆæ˜¯æœªæ’åºåºåˆ—ã€‚</li>
<li>ä»å¤´åˆ°å°¾ä¾æ¬¡æ‰«ææœªæ’åºåºåˆ—ï¼Œå°†æ‰«æåˆ°çš„æ¯ä¸ªå…ƒç´ æ’å…¥æœ‰åºåºåˆ—çš„é€‚å½“ä½ç½®ã€‚ï¼ˆå¦‚æœå¾…æ’å…¥çš„å…ƒç´ ä¸æœ‰åºåºåˆ—ä¸­çš„æŸä¸ªå…ƒç´ ç›¸ç­‰ï¼Œåˆ™å°†å¾…æ’å…¥å…ƒç´ æ’å…¥åˆ°ç›¸ç­‰å…ƒç´ çš„åé¢ã€‚ï¼‰</li>
<li><code>O(n2)</code></li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        int len = nums.length;
        for(int i = 0 ; i &lt; len ; i++){
            int temp = nums[i];
            int j = i - 1;
            while(j &gt;= 0 &amp;&amp; nums[j] &gt; temp){
                nums[j + 1] = nums[j];
                j--;
            }
            nums[j + 1] = temp;
        }
        return nums;
    }
}
</code></pre>
<h1 id="å¸Œå°”æ’åº">å¸Œå°”æ’åº</h1>
<ul>
<li>å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•&quot;åŸºæœ¬æœ‰åº&quot;æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚</li>
</ul>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        int len = nums.length;
        int temp;
        for(int step = len / 2 ; step &gt;= 1 ; step /= 2){
            for(int i = step ; i &lt; len ; i++){
                temp = nums[i];
                int j = i - step;
                while(j &gt;= 0 &amp;&amp; nums[j] &gt; temp){
                    nums[j + step] = nums[j];
                    j -= step;
                }
                nums[j + step] = temp;
            }
        }
        return nums;
    }
}
</code></pre>
<h1 id="å½’å¹¶æ’åº">å½’å¹¶æ’åº</h1>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        return mergeSort(nums, 0, nums.length);
    }

    public int[] mergeSort(int[] nums, int begin, int end){
        if(begin &gt;= end) return new int[0];
        if(begin + 1 == end) return new int[]{nums[begin]};
        int mid = (end + begin) &gt;&gt; 1;
        int[] left = mergeSort(nums, begin, mid);
        int[] right = mergeSort(nums, mid, end);
        int[] ans = new int[end - begin];
        int index = 0, lPointer = 0, rPointer = 0;
        while(lPointer &lt; left.length || rPointer &lt; right.length){
            if(lPointer &gt;= left.length){
                ans[index++] = right[rPointer++];
            }else if(rPointer &gt;= right.length){
                ans[index++] = left[lPointer++];
            }else{
                if(left[lPointer] &gt; right[rPointer]){
                    ans[index++] = right[rPointer++];
                }else{
                    ans[index++] = left[lPointer++];
                }
            }
        }
        return ans;
    }
}
</code></pre>
<h1 id="å¿«é€Ÿæ’åº">å¿«é€Ÿæ’åº</h1>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        quickSort(nums, 0, nums.length);
        return nums;
    }

    public void quickSort(int[] nums, int begin, int end){
        if(begin &gt;= end) return;
        if(begin + 1 == end) return;
        // éšæœºé€‰å–ä¸€ä¸ªå€¼ä½œä¸ºåŸºå‡†å€¼
        int index = new Random().nextInt(end - begin) + begin;
        swap(nums, begin, index);
        int cur = begin;
        // æ¯”åŸºå‡†å€¼å°çš„æ”¾åˆ°æ•°ç»„çš„å·¦è¾¹ï¼Œå¤§çš„æ”¾åˆ°å³è¾¹
        for(int i = begin ; i &lt; end ; i++){
            if(nums[i] &lt;= nums[begin]){
                swap(nums, cur, i);
                cur++;
            }
        }
        swap(nums, begin, cur - 1);
        // åˆ†å¼€æ’åº
        quickSort(nums, begin, cur - 1);
        quickSort(nums, cur, end);

    }

    public void swap(int[] nums, int left, int right){
        int temp = nums[left];
        nums[left] = nums[right];
        nums[right] = temp;
    }
}
</code></pre>
<h1 id="å †æ’åº">å †æ’åº</h1>
<pre><code class="language-java">class Solution {
    public int[] sortArray(int[] nums) {
        for(int i = (nums.length - 2) / 2 ; i &gt;= 0 ; i--){
            buildBigHeap(nums, i, nums.length);
        }
        for(int i = nums.length - 1 ; i &gt;= 0 ; i--){
            swap(nums, 0, i);
            buildBigHeap(nums, 0, i);
        }
        return nums;
    }

    public void buildBigHeap(int[] nums, int begin, int end){
        int childIndex;
        for(int i = begin ; i * 2 + 1 &lt; end ; i = childIndex){
            childIndex = i * 2 + 1;
            if(childIndex + 1 &lt; end &amp;&amp; nums[childIndex] &lt; nums[childIndex + 1]){
                childIndex += 1;
            }
            if(nums[childIndex] &gt; nums[i]){
                swap(nums, i, childIndex);
            }else{
                break;
            }
        }
    }

    public void swap(int[] nums, int left, int right){
        int temp = nums[left];
        nums[left] = nums[right];
        nums[right] = temp;
    }
}
</code></pre>
<ul>
<li>å †çš„ä¸‹æ²‰å’Œä¸Šæµ®æ–¹æ³•ï¼Œä¸Šæµ®æ–¹æ³•ç”¨äºæ’å…¥å»ºå †ï¼Œä¸‹æ²‰ç”¨äºç›´æ¥å»ºå †</li>
</ul>
<pre><code class="language-java">
public void sink(int[] nums, int begin, int end){
    int childIndex;
    for(int i = begin ; i * 2 + 1 &lt; end ; i = childIndex){
        childIndex = i * 2 + 1;
        if(childIndex + 1 &lt; end &amp;&amp; nums[childIndex] &lt; nums[childIndex + 1]){
            childIndex += 1;
        }
        if(nums[childIndex] &gt; nums[i]){
            swap(nums, i, childIndex);
        }else{
            break;
        }
    }
}

public void flow(int[] nums, int num, int end){
    nums[end] = num;
    int parentIndex;
    for(int i = end ; (i - 1) / 2 &gt;= 0 ; i = parentIndex){
        parentIndex = (i - 1) / 2;
        if(nums[parentIndex] &lt; nums[i]) {
            swap(nums, parentIndex, i);
        }else{
            break;
        }
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JMMå†…å­˜æ¨¡å‹]]></title>
        <id>https://yeyuan1107.github.io/post/jmm-nei-cun-mo-xing/</id>
        <link href="https://yeyuan1107.github.io/post/jmm-nei-cun-mo-xing/">
        </link>
        <updated>2022-02-27T13:10:43.000Z</updated>
        <content type="html"><![CDATA[<p><a name="anXft"></a></p>
<h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2>
<p><code>sychronized(åŒæ­¥å…³é”®å­—)</code><br />è¯­æ³•</p>
<pre><code class="language-java">synchronized( å¯¹è±¡ ) { 
    è¦ä½œä¸ºåŸå­æ“ä½œä»£ç 
}
</code></pre>
<p>ç”¨<code>synchronized</code>è§£å†³å¹¶å‘é—®é¢˜</p>
<pre><code class="language-java">static int i = 0;
static Object obj = new Object();
public static void main(String[] args) throws InterruptedException {
    Thread t1 = new Thread(() -&gt; {
        for (int j = 0; j &lt; 5000; j++) {
            synchronized (obj) {
                i++; }
        }
    });
    Thread t2 = new Thread(() -&gt; {
        for (int j = 0; j &lt; 5000; j++) {
            synchronized (obj) {
                i--;
            } 
        }
    });
    t1.start();
    t2.start();
    t1.join();
    t2.join();
    System.out.println(i);
}
</code></pre>
<p>å¦‚ä½•ç†è§£å‘¢:ä½ å¯ä»¥æŠŠ obj æƒ³è±¡æˆä¸€ä¸ªæˆ¿é—´ï¼Œçº¿ç¨‹ t1ï¼Œt2 æƒ³è±¡æˆä¸¤ä¸ªäººã€‚ <br />å½“çº¿ç¨‹ t1 æ‰§è¡Œåˆ° synchronized(obj) æ—¶å°±å¥½æ¯” t1 è¿›å…¥äº†è¿™ä¸ªæˆ¿é—´ï¼Œå¹¶åæ‰‹é”ä½äº†é—¨ï¼Œåœ¨é—¨å†…æ‰§è¡Œcount++ ä»£ç ã€‚ <br />è¿™æ—¶å€™å¦‚æœ t2 ä¹Ÿè¿è¡Œåˆ°äº† synchronized(obj) æ—¶ï¼Œå®ƒå‘ç°é—¨è¢«é”ä½äº†ï¼Œåªèƒ½åœ¨é—¨å¤–ç­‰å¾…ã€‚<br />å½“ t1 æ‰§è¡Œå®Œ synchronized{} å—å†…çš„ä»£ç ï¼Œè¿™æ—¶å€™æ‰ä¼šè§£å¼€é—¨ä¸Šçš„é”ï¼Œä» obj æˆ¿é—´å‡ºæ¥ã€‚t2 çº¿ç¨‹è¿™æ—¶æ‰ å¯ä»¥è¿›å…¥ obj æˆ¿é—´ï¼Œåé”ä½é—¨ï¼Œæ‰§è¡Œå®ƒçš„ count-- ä»£ç ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸Šä¾‹ä¸­ t1 å’Œ t2 çº¿ç¨‹å¿…é¡»ç”¨ synchronized é”ä½åŒä¸€ä¸ª obj å¯¹è±¡ï¼Œå¦‚æœ t1 é”ä½çš„æ˜¯ m1 å¯¹ è±¡ï¼Œt2 é”ä½çš„æ˜¯ m2 å¯¹è±¡ï¼Œå°±å¥½æ¯”ä¸¤ä¸ªäººåˆ†åˆ«è¿›å…¥äº†ä¸¤ä¸ªä¸åŒçš„æˆ¿é—´ï¼Œæ²¡æ³•èµ·åˆ°åŒæ­¥çš„æ•ˆæœã€‚</p>
</blockquote>
<ul>
<li>æ¯ä¸ªç±»å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªMonitoråŒºï¼Œåªæœ‰åœ¨ä½¿ç”¨<code>synchronizedå…³é”®å­—</code>æ‰ç”Ÿæ•ˆ</li>
<li>Ownerè¡¨ç¤ºMonitorçš„æ‰€æœ‰è€…ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æˆä¸ºOwner
<ul>
<li>å½“ä¸€ä¸ªçº¿ç¨‹t1åˆ°è¾¾ï¼Œå‘ç°Ownerä¸ºç©ºçš„ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¼šæˆä¸ºOwnerï¼Œå¹¶ä¸”æ‰§è¡Œ<code>monitorenter</code>ä¼šå¯¹Monitorè¿›è¡Œé”å®š</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹t2åˆ°è¾¾ï¼Œå‘ç°Ownerä¸ä¸ºç©ºï¼Œä¸”é”å®šäº†Monitorï¼Œè¿›å…¥EntryListè¿›è¡Œç­‰å¾…(é˜»å¡)</li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646032230273-20f9d2d1-9562-4b2c-a452-6a885fedc887-20220312195457419.png" alt="image.png" loading="lazy"></li>
<li>å½“t1æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œ<code>monitorexit</code>ï¼Œé€šçŸ¥EntryListä¸­æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¯ä»¥æ¥äº‰æŠ¢æˆä¸ºæ–°çš„Owner</li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646032367951-68e98a2f-4b68-47a1-a257-f20767f9c163-20220312195457498.png" alt="image.png" loading="lazy"></li>
</ul>
</li>
<li>EntryList</li>
<li>WaitSet<br>
<a name="GEFc1"></a></li>
</ul>
<h1 id="å¯è§æ€§">å¯è§æ€§</h1>
<p><a name="FIv42"></a></p>
<h2 id="é€€ä¸å‡ºçš„å¾ªç¯">é€€ä¸å‡ºçš„å¾ªç¯</h2>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªç°è±¡ï¼Œmain çº¿ç¨‹å¯¹ run å˜é‡çš„ä¿®æ”¹å¯¹äº t çº¿ç¨‹ä¸å¯è§ï¼Œå¯¼è‡´äº† t çº¿ç¨‹æ— æ³•åœæ­¢:</p>
<pre><code class="language-java">static boolean run = true;

public static void main(String[] args) throws InterruptedException {
    Thread t = new Thread(()-&gt;{
        while(run){
            // ....
        } 
    });
	t.start();
    
    Thread.sleep(1000);
	run = false; // çº¿ç¨‹tä¸ä¼šå¦‚é¢„æƒ³çš„åœä¸‹æ¥ 
}
</code></pre>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Œåˆ†æä¸€ä¸‹å¯çŸ¥</p>
<ol>
<li>åˆå§‹çŠ¶æ€ï¼Œtçº¿ç¨‹åˆšå¼€å§‹ä»ä¸»å†…å­˜è¯»å–äº†runçš„å€¼åˆ°å·¥ä½œå†…å­˜ï¼Œæ¯æ¬¡å¾ªç¯éƒ½éœ€è¦ä»ä¸»å†…å­˜ä¸­è¯»ä¸€æ¬¡runçš„å€¼</li>
</ol>
<figure data-type="image" tabindex="3"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646027955406-6a6e180a-fa53-4662-a8ef-820e819eac89-20220312195457562.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</li>
</ol>
<figure data-type="image" tabindex="4"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646027980654-54ff16b5-66c5-4779-b3bc-9947169666f7-20220312195457623.png" alt="image.png" loading="lazy"></figure>
<ol start="3">
<li>1 ç§’ä¹‹åï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œç»“æœæ°¸è¿œæ˜¯æ—§å€¼</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646028003664-3197ca78-0ff7-4943-8f1c-f6b1449b5471-20220312195457757.png" alt="image.png" loading="lazy"><br>
<a name="fzTwg"></a></p>
<h2 id="è§£å†³æ–¹æ³•-2">è§£å†³æ–¹æ³•</h2>
<p><code>volatile (æ˜“å˜å…³é”®å­—)</code><br />å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ° ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜<br>
<a name="vL7kO"></a></p>
<h2 id="å¯è§æ€§-2">å¯è§æ€§</h2>
<p>å‰é¢ä¾‹å­ä½“ç°çš„å®é™…å°±æ˜¯å¯è§æ€§ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ ä¸ªçº¿ç¨‹å¯è§ï¼Œ ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œä»…ç”¨åœ¨ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œå¤šä¸ªè¯»çº¿ç¨‹çš„æƒ…å†µ: <br />ä¸Šä¾‹ä»å­—èŠ‚ç ç†è§£æ˜¯è¿™æ ·çš„:</p>
<pre><code>getstatic			run //çº¿ç¨‹tè·å–runtrue
getstatic			run //çº¿ç¨‹tè·å–runtrue
getstatic			run //çº¿ç¨‹tè·å–runtrue
getstatic			run //çº¿ç¨‹tè·å–runtrue
putstatic			run // çº¿ç¨‹ main ä¿®æ”¹ run ä¸º falseï¼Œ ä»…æ­¤ä¸€æ¬¡
getstatic			run // çº¿ç¨‹ t è·å– run false
</code></pre>
<p>æ¯”è¾ƒä¸€ä¸‹ä¹‹å‰æˆ‘ä»¬å°†çº¿ç¨‹å®‰å…¨æ—¶ä¸¾çš„ä¾‹å­:ä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ª i++ ä¸€ä¸ª i-- ï¼Œåªèƒ½ä¿è¯çœ‹åˆ°æœ€æ–°å€¼ï¼Œä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™</p>
<pre><code>// å‡è®¾içš„åˆå§‹å€¼ä¸º0
getstatic				i // çº¿ç¨‹1-è·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0
getstatic				i // çº¿ç¨‹2-è·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0
iconst_1					// çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1
iadd							// çº¿ç¨‹1-è‡ªå¢ çº¿ç¨‹å†…i=1
putstatic				i // çº¿ç¨‹1-å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1
iconst_1					// çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1
isub							// çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1
putstatic				i // çº¿ç¨‹2-å°†ä¿®æ”¹åçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„åŸå­æ€§ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„å¯è§æ€§ã€‚ä½†ç¼ºç‚¹æ˜¯ synchronizedæ˜¯å±äºé‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½</p>
<p>å¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘ç°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ°å¯¹ run å˜é‡çš„ä¿®æ”¹äº†<br>
printlnä¸­æœ‰synchronizedå…³é”®å­—ï¼Œå¼ºåˆ¶å½“å‰çº¿ç¨‹ä»ä¸»å­˜ä¸­è¯»å–å€¼è€Œä¸æ˜¯ä»å‘Šè¯‰ç¼“å­˜ä¸­</p>
</blockquote>
<p><a name="Z6Nwy"></a></p>
<h1 id="æœ‰åºæ€§">æœ‰åºæ€§</h1>
<p><a name="GIZIJ"></a></p>
<h2 id="è¯¡å¼‚çš„ç»“æœ">è¯¡å¼‚çš„ç»“æœ</h2>
<pre><code class="language-java">int num = 0;
boolean ready = false;
// çº¿ç¨‹1 æ‰§è¡Œæ­¤æ–¹æ³•
public void actor1(I_Result r) {
    if(ready) {
        //r1ç”¨æ¥ä¿å­˜ç»“æœ
        r.r1 = num + num;
    } else {
        r.r1 = 1;
    } 
}

// çº¿ç¨‹2 æ‰§è¡Œæ­¤æ–¹æ³•
public void actor2(I_Result r) {
	num = 2;
    ready = true;
}
</code></pre>
<p>I_Result æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªå±æ€§ r1 ç”¨æ¥ä¿å­˜ç»“æœï¼Œé—®ï¼Œå¯èƒ½çš„ç»“æœæœ‰å‡ ç§?<br />æœ‰åŒå­¦è¿™ä¹ˆåˆ†æ<br />æƒ…å†µ1:çº¿ç¨‹1 å…ˆæ‰§è¡Œï¼Œè¿™æ—¶ ready = falseï¼Œæ‰€ä»¥è¿›å…¥ else åˆ†æ”¯ç»“æœä¸º 1<br />æƒ…å†µ2:çº¿ç¨‹2 å…ˆæ‰§è¡Œ num = 2ï¼Œä½†æ²¡æ¥å¾—åŠæ‰§è¡Œ ready = trueï¼Œçº¿ç¨‹1æ‰§è¡Œï¼Œè¿˜æ˜¯è¿›å…¥ else åˆ†æ”¯ï¼Œç»“æœä¸º1<br />æƒ…å†µ3:çº¿ç¨‹2 æ‰§è¡Œåˆ° ready = trueï¼Œçº¿ç¨‹1 æ‰§è¡Œï¼Œè¿™å›è¿›å…¥ if åˆ†æ”¯ï¼Œç»“æœä¸º 4(å› ä¸º num å·²ç»æ‰§è¡Œè¿‡äº†)<br />ä½†æˆ‘å‘Šè¯‰ä½ ï¼Œç»“æœè¿˜æœ‰å¯èƒ½æ˜¯ 0 ğŸ˜ğŸ˜ğŸ˜ï¼Œä¿¡ä¸ä¿¡å§!<br />è¿™ç§æƒ…å†µä¸‹æ˜¯:çº¿ç¨‹2 æ‰§è¡Œ ready = trueï¼Œåˆ‡æ¢åˆ°çº¿ç¨‹1ï¼Œè¿›å…¥ifåˆ†æ”¯ï¼Œç›¸åŠ ä¸º0ï¼Œå†åˆ‡å›çº¿ç¨‹2æ‰§è¡Œnum = 2<br />ç›¸ä¿¡å¾ˆå¤šäººå·²ç»æ™•äº† ğŸ˜µğŸ˜µğŸ˜µ</p>
<p>è¿™ç§ç°è±¡å«åšæŒ‡ä»¤é‡æ’ï¼Œæ˜¯ JIT ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶çš„ä¸€äº›ä¼˜åŒ–ï¼Œè¿™ä¸ªç°è±¡éœ€è¦é€šè¿‡å¤§é‡æµ‹è¯•æ‰èƒ½å¤ç°:<br />å€ŸåŠ© java å¹¶å‘å‹æµ‹å·¥å…· jcstress <a href="https://wiki.openjdk.java.net/display/CodeTools/jcstress">https://wiki.openjdk.java.net/display/CodeTools/jcstress</a></p>
<pre><code>mvn archetype:generate  -DinteractiveMode=false -
DarchetypeGroupId=org.openjdk.jcstress -DarchetypeArtifactId=jcstress-java-test-
archetype -DgroupId=org.sample -DartifactId=test -Dversion=1.0
</code></pre>
<p>åˆ›å»ºmavené¡¹ç›®ï¼Œæä¾›å¦‚ä¸‹æµ‹è¯•ç±»</p>
<pre><code class="language-java">@JCStressTest
//æ£€æŸ¥æ„Ÿå…´è¶£çš„ç»“æœ
@Outcome(id = {&quot;1&quot;, &quot;4&quot;}, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)
@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)
@State
public class ConcurrencyTest {
    int num = 0;
    boolean ready = false;
    @Actor
    public void actor1(I_Result r) {
        if(ready) {
            r.r1 = num + num;
        } else {
            r.r1 = 1;
        } 
    }
	@Actor
    public void actor2(I_Result r) {
        num = 2;
        ready = true;
    }
}
</code></pre>
<p>æ‰§è¡Œ</p>
<pre><code>mvn clean install
java -jar target/jcstress.jar
</code></pre>
<p>ä¼šè¾“å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç»“æœ</p>
<pre><code>*** INTERESTING tests
  Some interesting behaviors observed. This is for the plain curiosity.
  2 matching test results.
      [OK] test.ConcurrencyTest
    (JVM args: [-XX:-TieredCompilation])
 Observed state   Occurrences              Expectation  Interpretation
  						0         1,729   ACCEPTABLE_INTERESTING  !!!!
             	1    42,617,915								ACCEPTABLE  ok
             	4     5,146,627								ACCEPTABLE  ok
    [OK] test.ConcurrencyTest
  (JVM args: [])
Observed state   Occurrences							Expectation  Interpretation
             0         1,652   ACCEPTABLE_INTERESTING  !!!!
             1    46,460,657               ACCEPTABLE  ok
             4     4,571,072               ACCEPTABLE  ok
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°ç»“æœä¸º 0 çš„æƒ…å†µæœ‰ 1729 æ¬¡ï¼Œè™½ç„¶æ¬¡æ•°ç›¸å¯¹å¾ˆå°‘ï¼Œä½†æ¯•ç«Ÿæ˜¯å‡ºç°äº†ã€‚<br>
<a name="lZYvh"></a></p>
<h2 id="è§£å†³">è§£å†³</h2>
<p>volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’</p>
<pre><code class="language-java">@JCStressTest
@Outcome(id = {&quot;1&quot;, &quot;4&quot;}, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)
@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)
@State
public class ConcurrencyTest {
    int num = 0;
    volatile boolean ready = false;
    @Actor
    public void actor1(I_Result r) {
        if(ready) {
            r.r1 = num + num;
        } else {
            r.r1 = 1;
        } 
    }
    
	@Actor
    public void actor2(I_Result r) {
        num = 2;
        ready = true;
    }
}
</code></pre>
<p>ç»“æœä¸º</p>
<pre><code>*** INTERESTING tests
  Some interesting behaviors observed. This is for the plain curiosity.
  0 matching test results.
</code></pre>
<p><a name="wGXgF"></a></p>
<h3 id="æœ‰åºæ€§ç†è§£">æœ‰åºæ€§ç†è§£</h3>
<p>JVM ä¼šåœ¨ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œæ€è€ƒä¸‹é¢ä¸€æ®µä»£ç </p>
<pre><code class="language-java">static int i;
static int j;
// åœ¨æŸä¸ªçº¿ç¨‹å†…æ‰§è¡Œå¦‚ä¸‹èµ‹å€¼æ“ä½œ 
i = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œ
j = ...;
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè‡³äºæ˜¯å…ˆæ‰§è¡Œ i è¿˜æ˜¯ å…ˆæ‰§è¡Œ j ï¼Œå¯¹æœ€ç»ˆçš„ç»“æœä¸ä¼šäº§ç”Ÿå½±å“ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çœŸæ­£æ‰§è¡Œ æ—¶ï¼Œæ—¢å¯ä»¥æ˜¯</p>
<pre><code class="language-java">i = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œ 
j = ...;
</code></pre>
<p>ä¹Ÿå¯ä»¥æ˜¯</p>
<pre><code class="language-java">j = ...;
i = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œ
</code></pre>
<p>è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€æŒ‡ä»¤é‡æ’ã€ï¼Œå¤šçº¿ç¨‹ä¸‹ã€æŒ‡ä»¤é‡æ’ã€ä¼šå½±å“æ­£ç¡®æ€§ï¼Œä¾‹å¦‚è‘—åçš„ double-checked locking æ¨¡å¼å®ç°å•ä¾‹</p>
<pre><code class="language-java">public final class Singleton {
    private Singleton() { }
    private static Singleton INSTANCE = null;
    public static Singleton getInstance() {
		// å®ä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å— 
        if (INSTANCE == null) {
            synchronized (Singleton.class) {
                // ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡ 
                if (INSTANCE == null) {
                    INSTANCE = new Singleton();
                }
            } 
        }
        return INSTANCE;
    }
}
</code></pre>
<p>ä»¥ä¸Šå®ç°çš„ç‰¹ç‚¹æ˜¯</p>
<ul>
<li>æ‡’æƒ°å®ä¾‹åŒ–</li>
<li>é¦–æ¬¡ä½¿ç”¨ getInstance() æ‰ä½¿ç”¨ synchronized åŠ é”ï¼Œåç»­ä½¿ç”¨æ—¶æ— éœ€åŠ é”</li>
</ul>
<p>ä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œ INSTANCE = new Singleton() å¯¹åº”çš„å­—èŠ‚ç ä¸º:</p>
<pre><code>0: new           #2						// class cn/itcast/jvm/t4/Singleton
3: dup
4: invokespecial #3						// Method &quot;&lt;init&gt;&quot;:()V
7: putstatic     #4						// Field INSTANCE:Lcn/itcast/jvm/t4/Singleton;
</code></pre>
<p>å…¶ä¸­4 7 ä¸¤æ­¥çš„é¡ºåºä¸æ˜¯å›ºå®šçš„ï¼Œä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸º:å…ˆå°†å¼•ç”¨åœ°å€èµ‹å€¼ç»™ INSTANCE å˜é‡åï¼Œå†æ‰§è¡Œ æ„é€ æ–¹æ³•ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œ:</p>
<pre><code>æ—¶é—´1 t1 çº¿ç¨‹æ‰§è¡Œåˆ° INSTANCE = new Singleton();
æ—¶é—´2 t1 çº¿ç¨‹åˆ†é…ç©ºé—´ï¼Œä¸ºSingletonå¯¹è±¡ç”Ÿæˆäº†å¼•ç”¨åœ°å€(0 å¤„)
æ—¶é—´3 t1 çº¿ç¨‹å°†å¼•ç”¨åœ°å€èµ‹å€¼ç»™ INSTANCEï¼Œè¿™æ—¶ INSTANCE != null(7 å¤„)
æ—¶é—´4 t2 çº¿ç¨‹è¿›å…¥getInstance() æ–¹æ³•ï¼Œå‘ç° INSTANCE != null(synchronizedå—å¤–)ï¼Œç›´æ¥ è¿”å› INSTANCE
æ—¶é—´5 t1 çº¿ç¨‹æ‰§è¡ŒSingletonçš„æ„é€ æ–¹æ³•(4 å¤„)
</code></pre>
<p>è¿™æ—¶ t1 è¿˜æœªå®Œå…¨å°†æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹<br />å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ ä¼šçœŸæ­£æœ‰æ•ˆ<br>
<a name="ac7Rj"></a></p>
<h2 id="happens-before">happens-before</h2>
<p>happens-before è§„å®šäº†å“ªäº›å†™æ“ä½œå¯¹å…¶å®ƒçº¿ç¨‹çš„è¯»æ“ä½œå¯è§ï¼Œå®ƒæ˜¯å¯è§æ€§ä¸æœ‰åºæ€§çš„ä¸€å¥—è§„åˆ™æ€»ç»“ï¼Œ æŠ›å¼€ä»¥ä¸‹ happens-before è§„åˆ™ï¼ŒJMM å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™ï¼Œå¯¹äºå…¶å®ƒçº¿ç¨‹å¯¹è¯¥å…±äº«å˜é‡çš„è¯»å¯è§</p>
<ul>
<li>çº¿ç¨‹è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºæ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§</li>
</ul>
<pre><code class="language-java">static int x;
static Object m = new Object();
new Thread(()-&gt;{
    synchronized(m) {
		x = 10; 
    }
},&quot;t1&quot;).start();

new Thread(()-&gt;{
    synchronized(m) {
        System.out.println(x);
    }
},&quot;t2&quot;).start();
</code></pre>
<ul>
<li>çº¿ç¨‹å¯¹volatileå˜é‡çš„å†™ï¼Œå¯¹æ¥ä¸‹æ¥å…¶ä»–çº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§</li>
</ul>
<pre><code class="language-java">volatile static int x;
new Thread(()-&gt;{
    x = 10;
},&quot;t1&quot;).start();
new Thread(()-&gt;{
    System.out.println(x);
},&quot;t2&quot;).start();
</code></pre>
<ul>
<li>çº¿ç¨‹startå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åå¯¹è¯¥å˜é‡çš„è¯»å¯è§</li>
</ul>
<pre><code class="language-java">static int x;
x = 10;
new Thread(()-&gt;{
    System.out.println(x);
},&quot;t2&quot;).start();
</code></pre>
<ul>
<li>çº¿ç¨‹ç»“æŸå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¾—çŸ¥å®ƒç»“æŸåçš„è¯»å¯è§(æ¯”å¦‚å…¶å®ƒçº¿ç¨‹è°ƒç”¨ t1.isAlive() æˆ– t1.join()ç­‰å¾…å®ƒç»“æŸ)</li>
</ul>
<pre><code class="language-java">static int x;
Thread t1 = new Thread(()-&gt;{
    x = 10;
},&quot;t1&quot;);
t1.start();

t1.join();
System.out.println(x);
</code></pre>
<ul>
<li>çº¿ç¨‹ t1 æ‰“æ–­ t2(interrupt)å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹å¾—çŸ¥ t2 è¢«æ‰“æ–­åå¯¹å˜é‡çš„è¯»å¯è§(é€š è¿‡t2.interrupted æˆ– t2.isInterrupted)</li>
</ul>
<pre><code class="language-java">static int x;
public static void main(String[] args) {
    Thread t2 = new Thread(()-&gt;{
        while(true) {
            if(Thread.currentThread().isInterrupted()) {
                System.out.println(x);
				break; 
            }
        } 
    },&quot;t2&quot;);
	t2.start();
    
    new Thread(()-&gt;{
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
		x = 10;
        t2.interrupt();
    },&quot;t1&quot;).start();
    while(!t2.isInterrupted()) {
        Thread.yield();
    }
    System.out.println(x);
}
</code></pre>
<ul>
<li>å¯¹å˜é‡é»˜è®¤å€¼(0ï¼Œfalseï¼Œnull)çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§</li>
<li>å…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æœ x hb-&gt; y å¹¶ä¸” y hb-&gt; z é‚£ä¹ˆæœ‰ x hb-&gt; z</li>
</ul>
<blockquote>
<p>å˜é‡éƒ½æ˜¯æŒ‡æˆå‘˜å˜é‡æˆ–é™æ€æˆå‘˜å˜é‡<br>
å‚è€ƒ: ç¬¬17é¡µ</p>
</blockquote>
<p><a name="pnhX8"></a></p>
<h1 id="casä¸åŸå­ç±»">CASä¸åŸå­ç±»</h1>
<p><a name="uALee"></a></p>
<h2 id="cas">CAS</h2>
<p>CAS å³ Compare and Swap ï¼Œå®ƒä½“ç°çš„ä¸€ç§ä¹è§‚é”çš„æ€æƒ³ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹è¦å¯¹ä¸€ä¸ªå…±äº«çš„æ•´å‹å˜é‡æ‰§è¡Œ +1 æ“ä½œ:</p>
<pre><code class="language-java">// éœ€è¦ä¸æ–­å°è¯• 
while(true) {
    int æ—§å€¼ = å…±äº«å˜é‡ ; // æ¯”å¦‚æ‹¿åˆ°äº†å½“å‰å€¼ 0
    int ç»“æœ = æ—§å€¼ +1;// åœ¨æ—§å€¼ 0 çš„åŸºç¡€ä¸Šå¢åŠ  1 ï¼Œæ­£ç¡®ç»“æœæ˜¯ 1
    /*
    è¿™æ—¶å€™å¦‚æœåˆ«çš„çº¿ç¨‹æŠŠå…±äº«å˜é‡æ”¹æˆäº† 5ï¼Œæœ¬çº¿ç¨‹çš„æ­£ç¡®ç»“æœ 1 å°±ä½œåºŸäº†ï¼Œè¿™æ—¶å€™ 
    compareAndSwap è¿”å› falseï¼Œé‡æ–°å°è¯•ï¼Œç›´åˆ°:
    compareAndSwap è¿”å› trueï¼Œè¡¨ç¤ºæˆ‘æœ¬çº¿ç¨‹åšä¿®æ”¹çš„åŒæ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ²¡æœ‰å¹²æ‰°
    */
    if( compareAndSwap ( æ—§å€¼, ç»“æœ )) { 
        // æˆåŠŸï¼Œé€€å‡ºå¾ªç¯
    } 
}
</code></pre>
<p>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„å¯è§æ€§ï¼Œéœ€è¦ä½¿ç”¨ volatile ä¿®é¥°ã€‚ç»“åˆ CAS å’Œ volatile å¯ä»¥å®ç°æ— é”å¹¶å‘ï¼Œé€‚ç”¨äºç«äº‰ä¸æ¿€çƒˆã€å¤šæ ¸ CPU çš„åœºæ™¯ä¸‹ã€‚</p>
<ul>
<li>å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€</li>
<li>ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li>
</ul>
<p>CAS åº•å±‚ä¾èµ–äºä¸€ä¸ª Unsafe ç±»æ¥ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚çš„ CAS æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯ç›´æ¥ä½¿ç”¨ Unsafe å¯¹è±¡è¿› è¡Œçº¿ç¨‹å®‰å…¨ä¿æŠ¤çš„ä¸€ä¸ªä¾‹å­</p>
<pre><code class="language-java">import sun.misc.Unsafe;
import java.lang.reflect.Field;
public class TestCAS {
    public static void main(String[] args) throws InterruptedException {
        DataContainer dc = new DataContainer();
        int count = 5;
        Thread t1 = new Thread(() -&gt; {
    		for (int i = 0; i &lt; count; i++) {
                dc.increase();
            }
        });
        t1.start();
        t1.join();
        System.out.println(dc.getData());
    }
}

class DataContainer {
    private volatile int data;
    static final Unsafe unsafe;
    static final long DATA_OFFSET;
	static { 
        try {
            // Unsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾—
            Field theUnsafe = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); 
            theUnsafe.setAccessible(true);
            unsafe = (Unsafe) theUnsafe.get(null);
        } catch (NoSuchFieldException | IllegalAccessException e) {
            throw new Error(e);
        } try {
            // data å±æ€§åœ¨ DataContainer å¯¹è±¡ä¸­çš„åç§»é‡ï¼Œç”¨äº Unsafe ç›´æ¥è®¿é—®è¯¥å±æ€§
            DATA_OFFSET = unsafe.objectFieldOffset(DataContainer.class.getDeclaredField(&quot;data&quot;));
        } catch (NoSuchFieldException e) {
            throw new Error(e);
        } 
    }
    
    public void increase() {
        int oldValue;
        while(true) {
            // è·å–å…±äº«å˜é‡æ—§å€¼ï¼Œå¯ä»¥åœ¨è¿™ä¸€è¡ŒåŠ å…¥æ–­ç‚¹ï¼Œä¿®æ”¹ data è°ƒè¯•æ¥åŠ æ·±ç†è§£
            oldValue = data;
            // cas å°è¯•ä¿®æ”¹ data ä¸º æ—§å€¼ + 1ï¼Œå¦‚æœæœŸé—´æ—§å€¼è¢«åˆ«çš„çº¿ç¨‹æ”¹äº†ï¼Œè¿”å› false
            if (unsafe.compareAndSwapInt(this, DATA_OFFSET, oldValue, oldValue + 1)){
                return; 
            }
        }
    }
    
    public void decrease() {
    	int oldValue;
        while(true){
            oldValue = data;
    		if (unsafe.compareAndSwapInt(this, DATA_OFFSET, oldValue, oldValue - 1)){
                return;
            }
        }
    }
    public int getData() {
        return data;
    } 
}
</code></pre>
<p><a name="amqXK"></a></p>
<h2 id="ä¹è§‚é”ä¸æ‚²è§‚é”">ä¹è§‚é”ä¸æ‚²è§‚é”</h2>
<ul>
<li>CAS æ˜¯åŸºäºä¹è§‚é”çš„æ€æƒ³:æœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œ æˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚</li>
<li>synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³:æœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é” ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚<br>
<a name="yAZIy"></a></li>
</ul>
<h2 id="åŸå­æ“ä½œç±»">åŸå­æ“ä½œç±»</h2>
<p>juc(java.util.concurrent)ä¸­æä¾›äº†åŸå­æ“ä½œç±»ï¼Œå¯ä»¥æä¾›çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œä¾‹å¦‚:AtomicIntegerã€<br />AtomicBooleanç­‰ï¼Œå®ƒä»¬åº•å±‚å°±æ˜¯é‡‡ç”¨ CAS æŠ€æœ¯ + volatile æ¥å®ç°çš„ã€‚ å¯ä»¥ä½¿ç”¨ AtomicInteger æ”¹å†™ä¹‹å‰çš„ä¾‹å­:</p>
<pre><code class="language-java">// åˆ›å»ºåŸå­æ•´æ•°å¯¹è±¡
private static AtomicInteger i = new AtomicInteger(0);
public static void main(String[] args) throws InterruptedException {
    Thread t1 = new Thread(() -&gt; {
        for (int j = 0; j &lt; 5000; j++) { 
            i.getAndIncrement(); // è·å–å¹¶ä¸”è‡ªå¢ i++
            //i.incrementAndGet(); // è‡ªå¢å¹¶ä¸”è·å– ++i
        } 
    });
    Thread t2 = new Thread(() -&gt; {
        for (int j = 0; j &lt; 5000; j++) {
            i.getAndDecrement(); // è·å–å¹¶ä¸”è‡ªå‡ i-- 
        }
    });
    
    t1.start();
    t2.start();
    t1.join();
    t2.join();
    System.out.println(i);
}
</code></pre>
<p><a name="liIpj"></a></p>
<h1 id="sychronizedä¼˜åŒ–">sychronizedä¼˜åŒ–</h1>
<p>Java HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å¯¹è±¡å¤´(åŒ…æ‹¬ class æŒ‡é’ˆå’Œ Mark Word)ã€‚Mark Word å¹³æ—¶å­˜å‚¨è¿™ä¸ªå¯¹è±¡çš„<code>å“ˆå¸Œç ã€åˆ†ä»£å¹´é¾„(ä»å¹¸å­˜åŒºæ™‹å‡åˆ°è€å¹´ä»£ä¼šç”¨åˆ°)</code>ï¼Œå½“åŠ é”æ—¶ï¼Œè¿™äº›ä¿¡æ¯å°±æ ¹æ®æƒ…å†µè¢«æ›¿æ¢ä¸º<code>æ ‡è®°ä½(é”çš„ç±»å‹)</code>ã€<code>çº¿ç¨‹é”è®°å½•æŒ‡é’ˆ</code>ã€<code>é‡é‡çº§é”æŒ‡é’ˆ</code>ã€<code>çº¿ç¨‹ID</code>ç­‰å†…å®¹<br>
<a name="KYHSb"></a></p>
<h2 id="è½»é‡çº§é”">è½»é‡çº§é”</h2>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è®¿é—®ï¼Œä½†å¤šçº¿ç¨‹è®¿é—®çš„æ—¶é—´æ˜¯é”™å¼€çš„(ä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰)ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è¿™å°±å¥½æ¯”:<br />å­¦ç”Ÿ(çº¿ç¨‹ A)ç”¨è¯¾æœ¬å åº§ï¼Œä¸Šäº†åŠèŠ‚è¯¾ï¼Œå‡ºé—¨äº†(CPUæ—¶é—´åˆ°)ï¼Œå›æ¥ä¸€çœ‹ï¼Œå‘ç°è¯¾æœ¬æ²¡å˜ï¼Œè¯´æ˜æ²¡æœ‰ç«äº‰ï¼Œç»§ç»­ä¸Šä»–çš„è¯¾ã€‚<br />å¦‚æœè¿™æœŸé—´æœ‰å…¶å®ƒå­¦ç”Ÿ(çº¿ç¨‹ B)æ¥äº†ï¼Œä¼šå‘ŠçŸ¥(çº¿ç¨‹A)æœ‰å¹¶å‘è®¿é—®ï¼Œçº¿ç¨‹ A éšå³å‡çº§ä¸ºé‡é‡çº§é”(é”è†¨èƒ€)ï¼Œ è¿›å…¥é‡é‡çº§é”çš„æµç¨‹ã€‚<br />è€Œé‡é‡çº§é”å°±ä¸æ˜¯é‚£ä¹ˆç”¨è¯¾æœ¬å åº§é‚£ä¹ˆç®€å•äº†ï¼Œå¯ä»¥æƒ³è±¡çº¿ç¨‹ A èµ°ä¹‹å‰ï¼ŒæŠŠåº§ä½ç”¨ä¸€ä¸ªé“æ …æ å›´èµ·æ¥ <br />å‡è®¾æœ‰ä¸¤ä¸ªæ–¹æ³•åŒæ­¥å—ï¼Œåˆ©ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é”</p>
<pre><code class="language-java">static Object obj = new Object();
public static void method1() {
    synchronized( obj ) { 
        // åŒæ­¥å— A
        method2(); 
    }
}
public static void method2() {
	synchronized( obj ) { 
        // åŒæ­¥å— B
    } 
}
</code></pre>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•çš„ç»“æ„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„ Mark Word</p>
<ul>
<li>å¦‚æœåŠ é”MarkWordä¸­çš„å†…å®¹éœ€è¦å‘ç”Ÿæ”¹å˜ï¼Œéœ€è¦æŠŠåŸæ¥çš„å†…å®¹ä¿å­˜èµ·æ¥</li>
<li>åŠ é”æ—¶å°†é”è®°å½•åœ°å€ç»™MarkWord</li>
<li>ç­‰è§£é”åï¼Œéœ€è¦æŠŠåŸæ¥çš„å†…å®¹è¿˜ç»™MarkWord</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646029795880-2166b3ce-3e43-4645-bc27-c0943ede2098-20220312195457959.png" alt="image.png" loading="lazy"><br>
<a name="GVmLp"></a></p>
<h2 id="é”è†¨èƒ€">é”è†¨èƒ€</h2>
<p>å¦‚æœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”(æœ‰ç«äº‰)ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚<br />çº¿ç¨‹ä¸€è§£é”å¤±è´¥ï¼Œæ˜¯ä¸ºäº†å‘Šè¯‰çº¿ç¨‹ä¸€ç°åœ¨æ˜¯ä¸€ä¸ªé‡é‡çº§é”ï¼Œéœ€è¦æŒ‰ç…§é‡é‡çº§é”çš„æ–¹å¼æ¥è§£é”<br />MarkWordä¸­å¢åŠ é‡é‡çº§é”ï¼Œæ˜¯ä¸ºäº†å”¤é†’é˜»å¡ä¸­çš„çº¿ç¨‹</p>
<pre><code class="language-java">static Object obj = new Object();
public static void method1() {
    synchronized( obj ) { 
        // åŒæ­¥å—
    } 
}
</code></pre>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646029841309-0a32d3b3-ef4f-4408-8fa7-eee7e9b2e834-20220312195458112.png" alt="image.png" loading="lazy"><br>
<a name="bir5r"></a></p>
<h2 id="é‡é‡é”">é‡é‡é”</h2>
<p>é‡é‡çº§é”ç«äº‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è‡ªæ—‹æˆåŠŸ(å³è¿™æ—¶å€™æŒé”çº¿ç¨‹å·²ç»é€€<br />å‡ºäº†åŒæ­¥å—ï¼Œé‡Šæ”¾äº†é”)ï¼Œè¿™æ—¶å½“å‰çº¿ç¨‹å°±å¯ä»¥é¿å…é˜»å¡ã€‚<br />åœ¨ Java 6 ä¹‹åè‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å¯¹è±¡åˆšåˆšçš„ä¸€æ¬¡è‡ªæ—‹æ“ä½œæˆåŠŸè¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹æˆåŠŸçš„å¯èƒ½ æ€§ä¼šé«˜ï¼Œå°±å¤šè‡ªæ—‹å‡ æ¬¡;åä¹‹ï¼Œå°±å°‘è‡ªæ—‹ç”šè‡³ä¸è‡ªæ—‹ï¼Œæ€»ä¹‹ï¼Œæ¯”è¾ƒæ™ºèƒ½ã€‚</p>
<ul>
<li>è‡ªæ—‹ä¼šå ç”¨ CPU æ—¶é—´ï¼Œå•æ ¸ CPU è‡ªæ—‹å°±æ˜¯æµªè´¹ï¼Œå¤šæ ¸ CPU è‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿ã€‚</li>
<li>å¥½æ¯”ç­‰çº¢ç¯æ—¶æ±½è½¦æ˜¯ä¸æ˜¯ç†„ç«ï¼Œä¸ç†„ç«ç›¸å½“äºè‡ªæ—‹(ç­‰å¾…æ—¶é—´çŸ­äº†åˆ’ç®—)ï¼Œç†„ç«äº†ç›¸å½“äºé˜»å¡(ç­‰å¾…æ—¶é—´é•¿äº†åˆ’ç®—)</li>
<li>Java 7 ä¹‹åä¸èƒ½æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹åŠŸèƒ½</li>
</ul>
<p>è‡ªæ—‹é‡è¯•æˆåŠŸçš„æƒ…å†µ<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646029915647-8fd9e65d-8b3f-4e7f-a652-624e33f238bc-20220312195458194.png" alt="image.png" loading="lazy"><br />è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1646030033037-30d2cfb0-3494-4d8a-b26c-bdfb1ed8f1dc-20220312195458290.png" alt="image.png" loading="lazy"><br>
<a name="YdRr4"></a></p>
<h2 id="åå‘é”">åå‘é”</h2>
<p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶(å°±è‡ªå·±è¿™ä¸ªçº¿ç¨‹)ï¼Œæ¯æ¬¡é‡å…¥ä»ç„¶éœ€è¦æ‰§è¡Œ CAS æ“ä½œã€‚Java 6 ä¸­å¼•å…¥äº†åå‘é”æ¥åšè¿›ä¸€æ­¥ä¼˜åŒ–:åªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ IDè®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åå‘ç°è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œä¸ç”¨é‡æ–° CAS.</p>
<ul>
<li>å˜ä¸ºé‡é‡çº§é”æ—¶éœ€è¦æ’¤é”€åå‘é”ï¼Œæ’¤é”€åå‘é”éœ€è¦å°†æŒé”çº¿ç¨‹å‡çº§ä¸ºè½»é‡çº§é”ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹éœ€è¦æš‚åœ(STW)</li>
<li>è®¿é—®å¯¹è±¡çš„ hashCode ä¹Ÿä¼šæ’¤é”€åå‘é”
<ul>
<li>å½“ä¸€ä¸ªå¯¹è±¡å·²ç»è®¡ç®—è¿‡identity hash code(æœªè¢«è¦†å†™çš„ java.lang.Object.hashCode() æˆ–è€… java.lang.System.identityHashCode(Object) æ‰€è¿”å›çš„å€¼)ï¼Œå®ƒå°±æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ï¼›</li>
<li>å½“ä¸€ä¸ªå¯¹è±¡å½“å‰æ­£å¤„äºåå‘é”çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦è®¡ç®—å…¶identity hash codeçš„è¯ï¼Œåˆ™å®ƒçš„åå‘é”ä¼šè¢«æ’¤é”€ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºé‡é‡é”ï¼›</li>
<li>é‡é‡é”çš„å®ç°ä¸­ï¼ŒObjectMonitorç±»é‡Œæœ‰å­—æ®µå¯ä»¥è®°å½•éåŠ é”çŠ¶æ€ä¸‹çš„mark wordï¼Œå…¶ä¸­å¯ä»¥å­˜å‚¨identity hash codeçš„å€¼ã€‚æˆ–è€…ç®€å•è¯´å°±æ˜¯é‡é‡é”å¯ä»¥å­˜ä¸‹identity hash codeã€‚</li>
</ul>
</li>
<li>å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ²¡æœ‰ç«äº‰ï¼Œè¿™æ—¶åå‘äº†çº¿ç¨‹ T1 çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘ T2ï¼Œ é‡åå‘ä¼šé‡ç½®å¯¹è±¡çš„ Thread ID</li>
<li>æ’¤é”€åå‘å’Œé‡åå‘éƒ½æ˜¯æ‰¹é‡è¿›è¡Œçš„ï¼Œä»¥ç±»ä¸ºå•ä½</li>
<li>å¦‚æœæ’¤é”€åå‘åˆ°è¾¾æŸä¸ªé˜ˆå€¼ï¼Œæ•´ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„</li>
<li>å¯ä»¥ä¸»åŠ¨ä½¿ç”¨ -XX:-UseBiasedLocking ç¦ç”¨åå‘é”</li>
</ul>
<p>å¯ä»¥å‚è€ƒè¿™ç¯‡è®ºæ–‡:<a href="https://www.oracle.com/technetwork/java/biasedlocking-oopsla2006-wp-">https://www.oracle.com/technetwork/java/biasedlocking-oopsla2006-wp-</a> 149958.pdf</p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ–¹æ³•åŒæ­¥å—ï¼Œåˆ©ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é”</p>
<pre><code class="language-java">static Object obj = new Object();
public static void method1() {
    synchronized( obj ) { // åŒæ­¥å— A
    	method2(); 
    }
}

public static void method2() {
    synchronized( obj ) { 
        // åŒæ­¥å— B
    }
}
</code></pre>
<p>![image.png](https://cdn.nlark.com/yuque/0/2022/png/26092193/1646030118607-c926f2b8-b980-4c23-a77f-eec29106c721.png#clientId=ufbb25c08-b6bc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=249&amp;id=u81a5b064&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=498&amp;originWidth=994&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=82025&amp;status=done&amp;style=none&amp;taskId=u3c8466fd-b12d-42c7-a3c6-0f8793c0408&amp;title=&amp;width=497)<br>
<a name="coHn0"></a></p>
<h2 id="å…¶ä»–ä¼˜åŒ–">å…¶ä»–ä¼˜åŒ–</h2>
<p><a name="EsZnY"></a></p>
<h3 id="1-å‡å°‘ä¸Šé”æ—¶é—´">1. å‡å°‘ä¸Šé”æ—¶é—´</h3>
<p>åŒæ­¥ä»£ç å—ä¸­å°½é‡çŸ­(å‡å°‘çº¿ç¨‹äº¤é”™æ—¶é—´ï¼Œå°½é‡ä¿æŒä¸ºè½»é‡çº§é”)<br>
<a name="qFcfJ"></a></p>
<h3 id="2-å‡å°‘é”çš„ç²’åº¦">2. å‡å°‘é”çš„ç²’åº¦</h3>
<p>å°†ä¸€ä¸ªé”æ‹†åˆ†ä¸ºå¤šä¸ªé”æé«˜å¹¶å‘åº¦ï¼Œä¾‹å¦‚:</p>
<ul>
<li>ConcurrentHashMap</li>
<li>LongAdder åˆ†ä¸º base å’Œ cells ä¸¤éƒ¨åˆ†ã€‚æ²¡æœ‰å¹¶å‘äº‰ç”¨çš„æ—¶å€™æˆ–è€…æ˜¯ cells æ•°ç»„æ­£åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ CAS æ¥ç´¯åŠ å€¼åˆ° baseï¼Œæœ‰å¹¶å‘äº‰ç”¨ï¼Œä¼šåˆå§‹åŒ– cells æ•°ç»„ï¼Œæ•°ç»„æœ‰å¤šå°‘ä¸ª cellï¼Œå°±å…è®¸æœ‰å¤šå°‘çº¿ç¨‹å¹¶è¡Œä¿®æ”¹ï¼Œæœ€åå°†æ•°ç»„ä¸­æ¯ä¸ª cell ç´¯åŠ ï¼Œå†åŠ ä¸Š base å°±æ˜¯æœ€ç»ˆçš„å€¼</li>
<li>LinkedBlockingQueueå…¥é˜Ÿå’Œå‡ºé˜Ÿä½¿ç”¨ä¸åŒçš„é”ï¼Œç›¸å¯¹äºLinkedBlockingArrayåªæœ‰ä¸€ä¸ªé”æ•ˆç‡è¦é«˜<br>
<a name="UacE1"></a></li>
</ul>
<h3 id="3-é”ç²—åŒ–">3. é”ç²—åŒ–</h3>
<p>å¤šæ¬¡å¾ªç¯è¿›å…¥åŒæ­¥å—ä¸å¦‚åŒæ­¥å—å†…å¤šæ¬¡å¾ªç¯<br />å¦å¤– JVM å¯èƒ½ä¼šåšå¦‚ä¸‹ä¼˜åŒ–ï¼ŒæŠŠå¤šæ¬¡ append çš„åŠ é”æ“ä½œç²—åŒ–ä¸ºä¸€æ¬¡(å› ä¸ºéƒ½æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œ æ²¡å¿…è¦é‡å…¥å¤šæ¬¡)</p>
<pre><code class="language-java">new StringBuffer().append(&quot;a&quot;).append(&quot;b&quot;).append(&quot;c&quot;);
</code></pre>
<p><a name="bIIL2"></a></p>
<h3 id="4-é”æ¶ˆé™¤">4. é”æ¶ˆé™¤</h3>
<p>JVM ä¼šè¿›è¡Œä»£ç çš„é€ƒé€¸åˆ†æï¼Œä¾‹å¦‚æŸä¸ªåŠ é”å¯¹è±¡æ˜¯æ–¹æ³•å†…å±€éƒ¨å˜é‡ï¼Œä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹æ‰€è®¿é—®åˆ°ï¼Œè¿™æ—¶å€™å°±ä¼šè¢«å³æ—¶ç¼–è¯‘å™¨å¿½ç•¥æ‰æ‰€æœ‰åŒæ­¥æ“ä½œã€‚<br>
<a name="ARsKw"></a></p>
<h3 id="5-è¯»å†™åˆ†ç¦»">5. è¯»å†™åˆ†ç¦»</h3>
<p>CopyOnWriteArrayList<br />CopyOnWriteSet<br>
<a name="SOKfG"></a></p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://wiki.openjdk.java.net/display/HotSpot/Synchronization">https://wiki.openjdk.java.net/display/HotSpot/Synchronization</a> <br /><a href="http://luojinping.com/2015/07/09/java%E9%94%81%E4%BC%98%E5%8C%96/">http://luojinping.com/2015/07/09/javaé”ä¼˜åŒ–/</a><br /><a href="https://www.infoq.cn/article/java-se-16-synchronized">https://www.infoq.cn/article/java-se-16-synchronized</a> <br /><a href="https://www.jianshu.com/p/9932047a89be">https://www.jianshu.com/p/9932047a89be</a> <br /><a href="https://www.cnblogs.com/sheeva/p/6366782.html">https://www.cnblogs.com/sheeva/p/6366782.html</a> <a href="https://stackoverflow.com/questions/46312817/does-java-ever-rebias-an-individual-lock">https://stackoverflow.com/questions/46312817/does-java-ever-rebias-an-individual-lock</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVMç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯]]></title>
        <id>https://yeyuan1107.github.io/post/jvm-lei-jia-zai-yu-zi-jie-ma-ji-zhu/</id>
        <link href="https://yeyuan1107.github.io/post/jvm-lei-jia-zai-yu-zi-jie-ma-ji-zhu/">
        </link>
        <updated>2022-02-25T13:15:08.000Z</updated>
        <content type="html"><![CDATA[<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645779030862-32d83d43-fcdf-4762-aa93-7629d55c548c-20220312195348264.png" alt="image.png" loading="lazy"><br>
<a name="Zuwyg"></a></p>
<h1 id="ç±»æ–‡ä»¶ç»“æ„">ç±»æ–‡ä»¶ç»“æ„</h1>
<pre><code class="language-java">package com.yuanye.jvm

public class HelloWorld{
	public static void main(String[] args){
    	System.out.println(&quot;hello world&quot;);
    }
}
</code></pre>
<p>æ‰§è¡Œjavac -parameters -d . HelloWorld.java</p>
<pre><code>[root@localhost ~]# od -t xC HelloWorld.class
0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09
0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07
0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29
0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e
0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63
0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01
0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63
0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f
0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16
0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72
0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13
0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69
0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61
0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46
0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64
0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e
0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64
0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74
0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c
0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61
0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61
0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f
0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72
0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76
0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d
0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a
0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b
0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01
0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01
0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00
0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00
0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00
0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00
0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a
0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b
0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00
0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00
0001120 00 00 02 00 14
</code></pre>
<p>æ ¹æ®JVMè§„èŒƒï¼Œç±»æ–‡ä»¶ç»“æ„å¦‚ä¸‹<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645779563499-251206a7-2758-4eb9-b0b0-d1d12671f40d-20220312195348551.png" alt="image.png" loading="lazy"><br />å·¦ä¾§u4ã€u2ä»£è¡¨å­—èŠ‚æ•°<br /><a href="https://www.cnblogs.com/lilei94/p/9744331.html">å­—èŠ‚ç è¯¦è§£</a><br>
<a name="svSrl"></a></p>
<h2 id="é­”æ•°magic">é­”æ•°(magic)</h2>
<p>u4ï¼Œå››ä¸ªå­—èŠ‚è¡¨ç¤º<br />0-3å­—èŠ‚ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯<code>class</code>ç±»å‹çš„æ–‡ä»¶<br />0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09<br>
<a name="f7NiP"></a></p>
<h2 id="ç‰ˆæœ¬">ç‰ˆæœ¬</h2>
<p>4-7å­—èŠ‚ï¼Œè¡¨ç¤ºç±»çš„ç‰ˆæœ¬<br />0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09<br>
<a name="s1DwY"></a></p>
<h2 id="å¸¸é‡æ± ">å¸¸é‡æ± </h2>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645838051228-413019fc-91ea-431e-9fa7-ab1fb341e88f-20220312195348588.png" alt="image.png" loading="lazy"><br />8-9å­—èŠ‚ï¼Œè¡¨ç¤ºå¸¸é‡æ± é•¿åº¦ï¼Œ0023(35)è¡¨ç¤ºå¸¸é‡æ± æœ‰#1-#34é¡¹ï¼Œæ³¨æ„#0é¡¹ä¸è®¡å…¥ï¼Œä¹Ÿæ²¡æœ‰å€¼<br />0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<p>ç¬¬#1é¡¹0a(æ ¹æ®å¸¸é‡æ± )è¡¨ç¤ºä¸€ä¸ªMethodä¿¡æ¯ï¼Œ0006å’Œ0015è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­#6å’Œ#21é¡¹ï¼Œæ¥è·å–è¿™ä¸ªæ–¹æ³•çš„æ‰€å±ç±»å’Œæ–¹æ³•å<br />0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<p>ç¬¬#2é¡¹09è¡¨ç¤ºä¸€ä¸ªFieldä¿¡æ¯ï¼Œ0016å’Œ0017è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­#22å’Œ#23æ¥è·å¾—è¿™ä¸ªæˆå‘˜å˜é‡çš„æ‰€å±ç±»å’Œæˆå‘˜å˜é‡å<br />0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09<br />0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>ç¬¬#3é¡¹ 08 è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡åç§°ï¼Œ0018è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #24 é¡¹ <br />0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>ç¬¬#4é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ0019å’Œ 001aè¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #25 å’Œ #26 é¡¹æ¥è·å¾—è¿™ä¸ªæ–¹æ³•çš„æ‰€å±ç±»å’Œæ–¹æ³•å<br />0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>ç¬¬#5é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1bè¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #27 é¡¹ <br />0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>ç¬¬#6é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1cè¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #28 é¡¹<br />0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 <br />0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</p>
<p>ç¬¬#7é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 06 è¡¨ç¤ºé•¿åº¦ï¼Œ3c 69 6e 69 74 3e æ˜¯ã€ <init> ã€‘<br />0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29</p>
<p>ç¬¬#8é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œ28 29 56 æ˜¯ã€()Vã€‘å…¶å®å°±æ˜¯è¡¨ç¤ºæ— å‚ã€æ— è¿”å›å€¼ 0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 <br />0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</p>
<p>ç¬¬#9é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ43 6f 64 65 æ˜¯ã€Codeã€‘ <br />0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e</p>
<p>ç¬¬#10é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0f(15) è¡¨ç¤ºé•¿åº¦ï¼Œ4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 æ˜¯ã€LineNumberTableã€‘<br />0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e <br />0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63</p>
<p>ç¬¬#11é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 12(18) è¡¨ç¤ºé•¿åº¦ï¼Œ4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65æ˜¯ã€LocalVariableTableã€‘<br />0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63 <br />0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01</p>
<p>ç¬¬#12é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€thisã€‘ <br />0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01 <br />0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63</p>
<p>ç¬¬#13é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1d(29) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘ <br />0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63 <br />0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f<br />0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16</p>
<p>ç¬¬#14é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€mainã€‘<br />0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16</p>
<p>ç¬¬#15é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 16(22) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€([Ljava/lang/String;)Vã€‘å…¶å®å°±æ˜¯å‚æ•°ä¸º<br />å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ— è¿”å›å€¼<br />0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16 <br />0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 <br />0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13</p>
<p>ç¬¬#16é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€argsã€‘ <br />0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13</p>
<p>ç¬¬#17é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13(19) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘<br />0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 <br />0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 <br />0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61</p>
<p>ç¬¬#18é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10(16) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€MethodParametersã€‘ <br />0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61 <br />0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46</p>
<p>ç¬¬#19é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0a(10) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€SourceFileã€‘ <br />0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46 <br />0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64</p>
<p>ç¬¬#20é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0f(15) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€HelloWorld.javaã€‘ <br />0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64<br />0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e</p>
<p>ç¬¬#21é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 07 00 08 å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #7 #8 ä¸¤é¡¹<br />0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e</p>
<p>ç¬¬#22é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1d(29) å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #29 é¡¹ <br />0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e</p>
<p>ç¬¬#23é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 1e(30) 00 1f (31)å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #30 #31 ä¸¤é¡¹ <br />0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e <br />0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</p>
<p>ç¬¬#24é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0f(15) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€hello worldã€‘ <br />0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</p>
<p>ç¬¬#25é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 20(32) å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #32 é¡¹ <br />0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74</p>
<p>ç¬¬#26é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 21(33) 00 22(34)å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #33 #34 ä¸¤é¡¹ <br />0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74</p>
<p>ç¬¬#27é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1b(27) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€cn/itcast/jvm/t5/HelloWorldã€‘ <br />0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 <br />0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c <br />0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61</p>
<p>ç¬¬#28é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10(16) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Objectã€‘ <br />0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61 <br />0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61</p>
<p>ç¬¬#29é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10(16) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Systemã€‘ <br />0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61 <br />0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f</p>
<p>ç¬¬#30é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€outã€‘ <br />0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f <br />0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72</p>
<p>ç¬¬#31é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15(21) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Ljava/io/PrintStream;ã€‘<br />0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 <br />0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76</p>
<p>ç¬¬#32é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13(19) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/io/PrintStreamã€‘ <br />0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76 <br />0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d</p>
<p>ç¬¬#33é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 07 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€printlnã€‘ <br />0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a</p>
<p>ç¬¬#34é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15(21) è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€(Ljava/lang/String;)Vã€‘ <br />0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a <br />0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01</p>
<p><a name="XlFVJ"></a></p>
<h2 id="è®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯">è®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯</h2>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645839399281-6ed242cb-32e5-43ee-9636-a93f3318421f-20220312195348880.png" alt="image.png" loading="lazy"><br />21 è¡¨ç¤ºè¯¥ class æ˜¯ä¸€ä¸ªç±»ï¼Œå…¬å…±çš„ <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 <br />05 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #5 æ‰¾åˆ°æœ¬ç±»å…¨é™å®šå <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 <br />06 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #6 æ‰¾åˆ°çˆ¶ç±»å…¨é™å®šå <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 <br />01 è¡¨ç¤ºæ¥å£çš„æ•°é‡ï¼Œæœ¬ç±»ä¸º 0 <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01</p>
<p><a name="saSre"></a></p>
<h2 id="fieldä¿¡æ¯">FIeldä¿¡æ¯</h2>
<p>è¡¨ç¤ºæˆå‘˜å˜é‡æ•°é‡ï¼Œæœ¬ç±»ä¸º0<br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645840710764-56f251c7-5bb3-4404-be50-b5253f350531-20220312195348925.png" alt="image.png" loading="lazy"><br>
<a name="Rc4FG"></a></p>
<h3 id="methodä¿¡æ¯">Methodä¿¡æ¯</h3>
<p>è¡¨ç¤ºæ–¹æ³•æ•°é‡ï¼Œæœ¬ç±»ä¸º 2 <br />0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 <br />ä¸€ä¸ªæ–¹æ³•ç”± è®¿é—®ä¿®é¥°ç¬¦ï¼Œåç§°ï¼Œå‚æ•°æè¿°ï¼Œæ–¹æ³•å±æ€§(ä»£ç )æ•°é‡ï¼Œæ–¹æ³•å±æ€§ç»„æˆ</p>
<ul>
<li>çº¢è‰²ä»£è¡¨è®¿é—®ä¿®é¥°ç¬¦(æœ¬ç±»ä¸­æ˜¯ public)</li>
<li>è“è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #07 é¡¹ä½œä¸ºæ–¹æ³•åç§°</li>
<li>ç»¿è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #08 é¡¹ä½œä¸ºæ–¹æ³•å‚æ•°æè¿°</li>
<li>é»„è‰²ä»£è¡¨æ–¹æ³•å±æ€§æ•°é‡ï¼Œæœ¬æ–¹æ³•æ˜¯ 1</li>
<li>çº¢è‰²ä»£è¡¨æ–¹æ³•å±æ€§
<ul>
<li>00 09 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #09 é¡¹ï¼Œå‘ç°æ˜¯ã€Codeã€‘å±æ€§</li>
<li>00 00 00 2f è¡¨ç¤ºæ­¤å±æ€§çš„é•¿åº¦æ˜¯ 47</li>
<li>00 01 è¡¨ç¤ºã€æ“ä½œæ•°æ ˆã€‘æœ€å¤§æ·±åº¦</li>
<li>00 01 è¡¨ç¤ºã€å±€éƒ¨å˜é‡è¡¨ã€‘æœ€å¤§æ§½(slot)æ•°</li>
<li>00 00 00 05 è¡¨ç¤ºå­—èŠ‚ç é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 5</li>
<li>2a b7 00 01 b1 æ˜¯å­—èŠ‚ç æŒ‡ä»¤</li>
<li>00 00 00 02 è¡¨ç¤ºæ–¹æ³•ç»†èŠ‚å±æ€§æ•°é‡ï¼Œæœ¬ä¾‹æ˜¯ 2</li>
<li>00 0a è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #10 é¡¹ï¼Œå‘ç°æ˜¯ã€LineNumberTableã€‘å±æ€§
<ul>
<li>00 00 00 06 è¡¨ç¤ºæ­¤å±æ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 6</li>
<li>00 01 è¡¨ç¤ºã€LineNumberTableã€‘é•¿åº¦</li>
<li>00 00 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå·</li>
<li>00 04 è¡¨ç¤ºã€java æºç ã€‘è¡Œå·</li>
</ul>
</li>
<li>00 0b è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #11 é¡¹ï¼Œå‘ç°æ˜¯ã€LocalVariableTableã€‘å±æ€§
<ul>
<li>00 00 00 0c è¡¨ç¤ºæ­¤å±æ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 12</li>
<li>00 01 è¡¨ç¤ºã€LocalVariableTableã€‘é•¿åº¦</li>
<li>00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œç›¸å¯¹äºå­—èŠ‚ç çš„åç§»é‡</li>
<li>00 05 è¡¨ç¤ºå±€éƒ¨å˜é‡è¦†ç›–çš„èŒƒå›´é•¿åº¦</li>
<li>00 0c è¡¨ç¤ºå±€éƒ¨å˜é‡åç§°ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #12 é¡¹ï¼Œæ˜¯ã€thisã€‘</li>
<li>00 0d è¡¨ç¤ºå±€éƒ¨å˜é‡çš„ç±»å‹ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #13 é¡¹ï¼Œæ˜¯ ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘</li>
<li>00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡å æœ‰çš„æ§½ä½(slot)ç¼–å·ï¼Œæœ¬ä¾‹æ˜¯ 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 <br />0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01 <br />0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00 <br />0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00 <br />0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00</p>
<ul>
<li>çº¢è‰²ä»£è¡¨è®¿é—®ä¿®é¥°ç¬¦(æœ¬ç±»ä¸­æ˜¯ public static)</li>
<li>è“è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #14 é¡¹ä½œä¸ºæ–¹æ³•åç§°</li>
<li>ç»¿è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #15 é¡¹ä½œä¸ºæ–¹æ³•å‚æ•°æè¿°</li>
<li>é»„è‰²ä»£è¡¨æ–¹æ³•å±æ€§æ•°é‡ï¼Œæœ¬æ–¹æ³•æ˜¯ 2</li>
<li>çº¢è‰²ä»£è¡¨æ–¹æ³•å±æ€§(å±æ€§1)
<ul>
<li>00 09 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #09 é¡¹ï¼Œå‘ç°æ˜¯ã€Codeã€‘å±æ€§</li>
<li>00 00 00 37 è¡¨ç¤ºæ­¤å±æ€§çš„é•¿åº¦æ˜¯ 55</li>
<li>00 02 è¡¨ç¤ºã€æ“ä½œæ•°æ ˆã€‘æœ€å¤§æ·±åº¦</li>
<li>00 01 è¡¨ç¤ºã€å±€éƒ¨å˜é‡è¡¨ã€‘æœ€å¤§æ§½(slot)æ•°</li>
<li>00 00 00 05 è¡¨ç¤ºå­—èŠ‚ç é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 9</li>
<li>b2 00 02 12 03 b6 00 04 b1 æ˜¯å­—èŠ‚ç æŒ‡ä»¤</li>
<li>00 00 00 02 è¡¨ç¤ºæ–¹æ³•ç»†èŠ‚å±æ€§æ•°é‡ï¼Œæœ¬ä¾‹æ˜¯ 2</li>
<li>00 0a è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #10 é¡¹ï¼Œå‘ç°æ˜¯ã€LineNumberTableã€‘å±æ€§
<ul>
<li>00 00 00 0a è¡¨ç¤ºæ­¤å±æ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 10</li>
<li>00 02 è¡¨ç¤ºã€LineNumberTableã€‘é•¿åº¦</li>
<li>00 00 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå· 00 06 è¡¨ç¤ºã€java æºç ã€‘è¡Œå·</li>
<li>00 08 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå· 00 07 è¡¨ç¤ºã€java æºç ã€‘è¡Œå·</li>
</ul>
</li>
<li>00 0b è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #11 é¡¹ï¼Œå‘ç°æ˜¯ã€LocalVariableTableã€‘å±æ€§
<ul>
<li>00 00 00 0c è¡¨ç¤ºæ­¤å±æ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 12</li>
<li>00 01 è¡¨ç¤ºã€LocalVariableTableã€‘é•¿åº¦</li>
<li>00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œç›¸å¯¹äºå­—èŠ‚ç çš„åç§»é‡</li>
<li>00 09 è¡¨ç¤ºå±€éƒ¨å˜é‡è¦†ç›–çš„èŒƒå›´é•¿åº¦</li>
<li>00 10 è¡¨ç¤ºå±€éƒ¨å˜é‡åç§°ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #16 é¡¹ï¼Œæ˜¯ã€argsã€‘</li>
<li>00 11 è¡¨ç¤ºå±€éƒ¨å˜é‡çš„ç±»å‹ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #17 é¡¹ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘</li>
<li>00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡å æœ‰çš„æ§½ä½(slot)ç¼–å·ï¼Œæœ¬ä¾‹æ˜¯ 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00 <br />0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00 <br />0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a <br />0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b <br />0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00</p>
<p>çº¢è‰²ä»£è¡¨æ–¹æ³•å±æ€§(å±æ€§2)</p>
<ul>
<li>00 12 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #18 é¡¹ï¼Œå‘ç°æ˜¯ã€MethodParametersã€‘å±æ€§
<ul>
<li>00 00 00 05 è¡¨ç¤ºæ­¤å±æ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 5</li>
<li>01 å‚æ•°æ•°é‡</li>
<li>00 10 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #16 é¡¹ï¼Œæ˜¯ã€argsã€‘</li>
<li>00 00 è®¿é—®ä¿®é¥°ç¬¦</li>
</ul>
</li>
</ul>
<p>0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00 <br />0001120 00 00 02 00 14</p>
<p><a name="HwW77"></a></p>
<h2 id="é™„åŠ å±æ€§">é™„åŠ å±æ€§</h2>
<ul>
<li>00 01 è¡¨ç¤ºé™„åŠ å±æ€§æ•°é‡</li>
<li>00 13 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #19 é¡¹ï¼Œå³ã€SourceFileã€‘</li>
<li>00 00 00 02 è¡¨ç¤ºæ­¤å±æ€§çš„é•¿åº¦</li>
<li>00 14 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #20 é¡¹ï¼Œå³ã€HelloWorld.javaã€‘</li>
</ul>
<p>0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00 <br />0001120 00 00 02 00 14</p>
<p><a name="Jiypc"></a></p>
<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></p>
<p><a name="lNVGb"></a></p>
<h1 id="å­—èŠ‚ç æŒ‡ä»¤">å­—èŠ‚ç æŒ‡ä»¤</h1>
<p><a name="CMU6r"></a></p>
<h2 id="å…¥é—¨">å…¥é—¨</h2>
<p>æ¥ç€ä¸Šä¸€èŠ‚ï¼Œç ”ç©¶ä¸€ä¸‹ä¸¤ç»„å­—èŠ‚ç æŒ‡ä»¤ï¼Œä¸€ä¸ªæ˜¯<br /><code>public cn.itcast.jvm.t5.HelloWorld();</code>æ„é€ æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p>
<pre><code>2a b7 00 01 b1
</code></pre>
<ol>
<li>2a =&gt; aload_0 åŠ è½½ slot 0 çš„å±€éƒ¨å˜é‡ï¼Œå³ thisï¼Œåšä¸ºä¸‹é¢çš„ invokespecial æ„é€ æ–¹æ³•è°ƒç”¨çš„å‚æ•°</li>
<li>b7 =&gt; invokespecial é¢„å¤‡è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ</li>
<li>00 01 å¼•ç”¨å¸¸é‡æ± ä¸­ #1 é¡¹ï¼Œå³ã€ Method java/lang/Object.&quot;&quot;ğŸ˜¦)V ã€‘</li>
<li>b1 è¡¨ç¤ºè¿”å›</li>
</ol>
<p>å¦ä¸€ä¸ªæ˜¯<code>public static void main(java.lang.String[]);</code>ä¸»æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p>
<pre><code>b2 00 02 12 03 b6 00 04 b1
</code></pre>
<ol>
<li>b2 =&gt; getstatic ç”¨æ¥åŠ è½½é™æ€å˜é‡ï¼Œå“ªä¸ªé™æ€å˜é‡å‘¢ï¼Ÿ</li>
<li>00 02 å¼•ç”¨å¸¸é‡æ± ä¸­ #2 é¡¹ï¼Œå³ã€Field java/lang/System.out:Ljava/io/PrintStream;ã€‘</li>
<li>12 =&gt; ldc åŠ è½½å‚æ•°ï¼Œå“ªä¸ªå‚æ•°å‘¢ï¼Ÿ</li>
<li>03 å¼•ç”¨å¸¸é‡æ± ä¸­ #3 é¡¹ï¼Œå³ ã€String hello worldã€‘</li>
<li>b6 =&gt; invokevirtual é¢„å¤‡è°ƒç”¨æˆå‘˜æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ</li>
<li>00 04 å¼•ç”¨å¸¸é‡æ± ä¸­ #4 é¡¹ï¼Œå³ã€Method java/io/PrintStream.println:(Ljava/lang/String;)Vã€‘</li>
<li>b1 è¡¨ç¤ºè¿”å›<br>
<a name="i6fDr"></a></li>
</ol>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a><br>
<a name="D0qmV"></a></p>
<h2 id="javapå·¥å…·">javapå·¥å…·</h2>
<p>è‡ªå·±åˆ†æç±»æ–‡ä»¶ç»“æ„å¤ªéº»çƒ¦äº†ï¼ŒOracle æä¾›äº† javap å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶</p>
<pre><code>Classfile /Users/yy/projects/IdeaProjects/Leetcode/out/production/Leetcode/com/yuanye/jvm/HelloWorld.class
  Last modified 2022å¹´2æœˆ25æ—¥; size 562 bytes
  MD5 checksum 68406ec2a8c4f60b7d40f3d3138c8146
  Compiled from &quot;HelloWorld.java&quot;
public class com.yuanye.jvm.HelloWorld
  minor version: 0
  major version: 55
  flags: (0x0021) ACC_PUBLIC, ACC_SUPER
  this_class: #5                          // com/yuanye/jvm/HelloWorld
  super_class: #6                         // java/lang/Object
  interfaces: 0, fields: 0, methods: 2, attributes: 1
Constant pool:
   #1 = Methodref          #6.#20         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;
   #3 = String             #23            // HelloWorld
   #4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V
   #5 = Class              #26            // com/yuanye/jvm/HelloWorld
   #6 = Class              #27            // java/lang/Object
   #7 = Utf8               &lt;init&gt;
   #8 = Utf8               ()V
   #9 = Utf8               Code
  #10 = Utf8               LineNumberTable
  #11 = Utf8               LocalVariableTable
  #12 = Utf8               this
  #13 = Utf8               Lcom/yuanye/jvm/HelloWorld;
  #14 = Utf8               main
  #15 = Utf8               ([Ljava/lang/String;)V
  #16 = Utf8               args
  #17 = Utf8               [Ljava/lang/String;
  #18 = Utf8               SourceFile
  #19 = Utf8               HelloWorld.java
  #20 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V
  #21 = Class              #28            // java/lang/System
  #22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;
  #23 = Utf8               HelloWorld
  #24 = Class              #31            // java/io/PrintStream
  #25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V
  #26 = Utf8               com/yuanye/jvm/HelloWorld
  #27 = Utf8               java/lang/Object
  #28 = Utf8               java/lang/System
  #29 = Utf8               out
  #30 = Utf8               Ljava/io/PrintStream;
  #31 = Utf8               java/io/PrintStream
  #32 = Utf8               println
  #33 = Utf8               (Ljava/lang/String;)V
{
  public com.yuanye.jvm.HelloWorld();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 3: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       5     0  this   Lcom/yuanye/jvm/HelloWorld;

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: (0x0009) ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=1, args_size=1
         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         3: ldc           #3                  // String HelloWorld
         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
         8: return
      LineNumberTable:
        line 6: 0
        line 7: 8
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       9     0  args   [Ljava/lang/String;
}
</code></pre>
<p><a name="OubPu"></a></p>
<h2 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹">å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h2>
<p><a name="DyqF3"></a></p>
<h3 id="åŸå§‹javaä»£ç ">åŸå§‹javaä»£ç </h3>
<pre><code class="language-java">package cn.itcast.jvm.t3.bytecode;

/** 
 * æ¼”ç¤º å­—èŠ‚ç æŒ‡ä»¤ å’Œ æ“ä½œæ•°æ ˆã€å¸¸é‡æ± çš„å…³ç³»
 */ 
public class Demo3_1 { 
    public static void main(String[] args) {
        int a = 10;
        int b = Short.MAX_VALUE + 1;
        int c = a + b;
        System.out.println(c);
    }
}
</code></pre>
<p><a name="QzE6u"></a></p>
<h3 id="ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶">ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶</h3>
<pre><code>[root@localhost ~]# javap -v Demo3_1.class
Classfile /root/Demo3_1.class
  	Last modified Jul 7, 2019; size 665 bytes
  	MD5 checksum a2c29a22421e218d4924d31e6990cfc5
  	Compiled from &quot;Demo3_1.java&quot;
public class cn.itcast.jvm.t3.bytecode.Demo3_1
  	minor version: 0
  	major version: 52
  	flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   	#1 = Methodref					#7.#26         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   	#2 = Class							#27            // java/lang/Short
   	#3 = Integer						32768
   	#4 = Fieldref						#28.#29        //
java/lang/System.out:Ljava/io/PrintStream;
		#5 = Methodref					#30.#31        // java/io/PrintStream.println:(I)V
 		#6 = Class							#32            // cn/itcast/jvm/t3/bytecode/Demo3_1
 		#7 = Class							#33            // java/lang/Object
 		#8 = Utf8								&lt;init&gt;
 		#9 = Utf8								()V
		#10 = Utf8							Code
		#11 = Utf8							LineNumberTable
		#12 = Utf8							LocalVariableTable
		#13 = Utf8							this
		#14 = Utf8							Lcn/itcast/jvm/t3/bytecode/Demo3_1;
		#15 = Utf8							main
		#16 = Utf8							([Ljava/lang/String;)V
		#17 = Utf8							args
		#18 = Utf8							[Ljava/lang/String;
		#19 = Utf8							a
		#20 = Utf8							I
		#21 = Utf8							b
		#22 = Utf8							c
		#23 = Utf8							MethodParameters
		#24 = Utf8							SourceFile
		#25 = Utf8							Demo3_1.java
		#26 = NameAndType				#8:#9          // &quot;&lt;init&gt;&quot;:()V
		#27 = Utf8							java/lang/Short
		#28 = Class							#34            // java/lang/System
		#29 = NameAndType				#35:#36        // out:Ljava/io/PrintStream;
		#30 = Class							#37            // java/io/PrintStream
		#31 = NameAndType				#38:#39        // println:(I)V
		#32 = Utf8							cn/itcast/jvm/t3/bytecode/Demo3_1
		#33 = Utf8							java/lang/Object
		#34 = Utf8							java/lang/System
		#35 = Utf8							out
		#36 = Utf8							Ljava/io/PrintStream;
		#37 = Utf8							java/io/PrintStream
		#38 = Utf8							println
		#39 = Utf8							(I)V
{
  public cn.itcast.jvm.t3.bytecode.Demo3_1();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1					// Method java/lang/Object.&quot;
         0: aload_0
         1: invokespecial #1						
&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 6: 0
      LocalVariableTable:
      	Start  Length  Slot  Name   Signature
          	0       5     0  this   Lcn/itcast/jvm/t3/bytecode/Demo3_1;
public static void main(java.lang.String[]);
  descriptor: ([Ljava/lang/String;)V
  flags: ACC_PUBLIC, ACC_STATIC
  Code:
		stack=2, locals=4, args_size=1
   		0: bipush        	10
   		2: istore_1				
      3: ldc						#3										// int 32768
   		5: istore_2
   		6: iload_1
   		7: iload_2
   		8: iadd
			9: istore_3
			10: getstatic			#4										// Field
java/lang/System.out:Ljava/io/PrintStream;
			13: iload_3
     	14: invokevirtual #5										// Method
java/io/PrintStream.println:(I)V
      17: return
     LineNumberTable:
      line 8: 0
      line 9: 3
			line 10: 6
      line 11: 10
      line 12: 17
     LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      18     0  args   [Ljava/lang/String;
            3      15     1     a   I
            6      12     2     b   I
           10       8     3     c   I
    MethodParameters:
				Name 												Flags
				args 
}
</code></pre>
<p><a name="VfBYq"></a></p>
<h3 id="å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± ">å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </h3>
<ul>
<li>å½“javaä»£ç è¢«æ‰§è¡Œæ—¶ï¼Œç”±jvmçš„ç±»åŠ è½½å™¨å¯¹main()æ–¹æ³•æ‰€åœ¨çš„ç±»è¿›è¡Œç±»åŠ è½½(å°†.classæ–‡ä»¶çš„å­—èŠ‚æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­)</li>
<li>å°†å¸¸é‡æ± çš„æ•°æ®ä¼šæ”¾å…¥åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± å±äºæ–¹æ³•åŒº</li>
<li>æ¯”è¾ƒå°çš„æ•°å­—å¹¶ä¸å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œä¸æ–¹æ³•çš„å­—èŠ‚ç å­˜æ”¾åœ¨ä¸€èµ·ã€‚ä¸€æ—¦æ•°å­—è¶…è¿‡äº†shortç±»å‹çš„æœ€å¤§å€¼ï¼Œå°±å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645845825715-9770beef-8a62-4af4-8886-a9be7816c00d-20220312195349217.png" alt="image.png" loading="lazy"><br>
<a name="leilE"></a></p>
<h3 id="æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº">æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</h3>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645846131904-b5f3e282-f51f-475b-9395-4c17d3e9465a-20220312195349267.png" alt="image.png" loading="lazy"><br>
<a name="iQpWs"></a></p>
<h3 id="mainçº¿ç¨‹å¼€å§‹è¿è¡Œåˆ†é…æ ˆå¸§å†…å­˜">mainçº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜</h3>
<ul>
<li>ç»¿è‰²ä»£è¡¨å±€éƒ¨å˜é‡æ ‡ï¼Œè“è‰²è¡¨ç¤ºæ“ä½œæ•°æ ˆ</li>
<li>stackè¡¨ç¤ºæ“ä½œæ•°æ ˆæ·±åº¦ï¼Œlocalsè¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨é•¿åº¦</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645846162873-430f7574-fb8f-47ff-a75a-6da88970b9e5-20220312195349549.png" alt="image.png" loading="lazy"><br>
<a name="BjE8m"></a></p>
<h3 id="æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç ">æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </h3>
<p><a name="DLL1T"></a></p>
<h4 id="bipush-10">bipush 10</h4>
<ul>
<li>å°†ä¸€ä¸ªbyteå‹å…¥æ“ä½œæ•°æ ˆ(å…¶é•¿åº¦ä¼šè¡¥é½4ä¸ªå­—èŠ‚)ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰
<ul>
<li>sipushå°†ä¸€ä¸ªshortå‹å…¥æ“ä½œæ•°æ ˆ(å…¶é•¿åº¦ä¼šè¡¥é½4ä¸ªå­—èŠ‚)</li>
<li>ldcå°†ä¸€ä¸ªintå‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>ldc2_wå°†ä¸€ä¸ªlongå‹å…¥æ“ä½œæ•°æ ˆ(åˆ†ä¸¤æ¬¡å‹å…¥ï¼Œå› ä¸ºlongæ˜¯8ä¸ªå­—èŠ‚)</li>
<li>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡shortèŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </li>
</ul>
</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850434229-e3e1c66a-2ea9-44b8-9c04-c326a16ecda4-20220312195349830.png" alt="image.png" loading="lazy"><br>
<a name="IqbI9"></a></p>
<h4 id="istore_1">istore_1</h4>
<ul>
<li>å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„slot 1</li>
<li>å¯¹åº”javaä»£ç ä¸­<code>a=10;</code></li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850624004-8b563621-74b5-492f-b34b-b170d1453dd6-20220312195350225.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850652813-4d8baee7-565a-46c1-a2d3-0ecf0b1c3a36-20220312195350307.png" alt="image.png" loading="lazy"><br>
<a name="aFH5R"></a></p>
<h4 id="ldc3">ldc#3</h4>
<ul>
<li>ä»å¸¸é‡æ± åŠ è½½#3æ•°æ®åˆ°æ“ä½œæ•°æ ˆ</li>
<li>æ³¨æ„ Short.MAX_VALUEæ˜¯32767ï¼Œæ‰€ä»¥32768=Short.MAX_VALUE+1å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850787229-dde4352a-ca73-40c2-b069-d178473a0a3f-20220312195350571.png" alt="image.png" loading="lazy"><br>
<a name="bplmV"></a></p>
<h4 id="istore-2">istore 2</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850818540-25488cbe-4136-43be-b40e-3d4d5014273e-20220312195350861.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850830550-86bbe5ff-d634-48b0-b618-0eb2af3a778d-20220312195351171.png" alt="image.png" loading="lazy"><br>
<a name="G8A1L"></a></p>
<h4 id="iload-1">iload 1</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850860003-8aa26fe5-12cd-46ba-9810-4661eb8fae21-20220312195351493.png" alt="image.png" loading="lazy"><br>
<a name="wr0nQ"></a></p>
<h4 id="iload-2">iload 2</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850879972-3fb306c0-bef3-4797-be02-c4cd2ff8e391-20220312195351914.png" alt="image.png" loading="lazy"><br>
<a name="UT7L4"></a></p>
<h4 id="iadd">iadd</h4>
<ul>
<li>è¿ç®—éœ€è¦åœ¨æ“ä½œæ•°æ ˆä¸­è¿è¡Œï¼Œæ‰€ä»¥éœ€è¦åŠ è½½åˆ°æ ˆä¸­</li>
<li>iaddå¼¹å‡ºä¸¤ä¸ªç»“æœè¿›è¡Œè¿ç®—ï¼Œå°†ç»“æœå‹å…¥åˆ°æ“ä½œæ•°æ ˆä¸­</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645850958769-c20fe0ad-215e-4591-b434-4ee454e50069-20220312195352025.png" alt="image.png" loading="lazy"><br>
<a name="hjkrl"></a></p>
<h4 id="istore-3">istore 3</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851296331-99d1ca1f-0084-4589-af79-77545e50ee2f-20220312195352323.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851426930-26c390c8-1514-4e60-93d7-e2981920be0d-20220312195352705.png" alt="image.png" loading="lazy"><br>
<a name="O65wJ"></a></p>
<h4 id="getstatic-41">getstatic #41</h4>
<ul>
<li>getstaticåˆ°å¸¸é‡æ± ä¸­æ‰¾åˆ°æˆå‘˜å˜é‡çš„å¼•ç”¨</li>
<li>æˆå‘˜å˜é‡å­˜æ”¾åœ¨å †ä¸­ï¼Œé€šè¿‡å¸¸é‡æ± æ‰¾åˆ°å †ä¸­çš„æˆå‘˜å˜é‡</li>
<li>ç„¶åå°†æˆå‘˜å˜é‡çš„å¼•ç”¨æ”¾å…¥åˆ°æ“ä½œæ•°æ ˆä¸­</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851522360-db9438ff-a721-40ce-8737-fa2876843094-20220312195353114.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851694474-b5c51e5b-2070-479f-8ffe-fa71d3bddaf9-20220312195353247.png" alt="image.png" loading="lazy"><br>
<a name="BMF67"></a></p>
<h4 id="iload3">iload3</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851730146-3901f6c6-61ef-4a92-a327-9a7fc4c0880d-20220312195353567.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645851752394-8df2533f-5bf4-4aa8-ba73-839d1b6a3cca-20220312195353874.png" alt="image.png" loading="lazy"><br>
<a name="uWhXa"></a></p>
<h4 id="invokevirtual-5">invokevirtual #5</h4>
<ul>
<li>æ‰¾åˆ°å¸¸é‡æ± #5é¡¹</li>
<li>å®šä½åˆ°æ–¹æ³•åŒºjava/io/PrintStream.println:(I)Væ–¹æ³•</li>
<li>ç”Ÿæˆæ–°çš„æ ˆå¸§(åˆ†é…localsã€stackç­‰)</li>
<li>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </li>
</ul>
<figure data-type="image" tabindex="1"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645852515253-d79039fd-2e0c-47bf-a5db-365002ace170-20220312195354460.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æ‰§è¡Œå®Œæ¯•å¼¹å‡ºæ ˆå¸§</li>
<li>æ¸…é™¤mainæ“ä½œæ•°æ ˆå†…å®¹</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645852591763-d2a434a0-78f9-4f00-9cda-c6ae2ea3ffed-20220312195354564.png" alt="image.png" loading="lazy"><br>
<a name="IGKMF"></a></p>
<h4 id="return">return</h4>
<ul>
<li>å®Œæˆmainæ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡ºmainæ ˆå¸§</li>
<li>ç¨‹åºç»“æŸ<br>
<a name="JEQEn"></a></li>
</ul>
<h3 id="è‡ªå¢è¿ç®—å›¾è§£a-a">è‡ªå¢è¿ç®—å›¾è§£(a++, ++a)</h3>
<ul>
<li>æ³¨æ„iincæŒ‡ä»¤æ˜¯ç›´æ¥åœ¨å±€éƒ¨å˜é‡slotä¸Šè¿›è¡Œè¿ç®—
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹å“ªä¸ªslotåšè‡ªå¢ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè‡ªå¢å¤šå°‘</li>
</ul>
</li>
<li>a++å’Œ++açš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œiloadè¿˜æ˜¯å…ˆæ‰§è¡Œiinc</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645852894998-2d29f519-d608-4406-990d-e1c358b4e4e5-20220312195354823.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645852954122-6ee13d04-74ae-4c6c-91d4-3d2f52bc8827-20220312195355103.png" alt="image.png" loading="lazy"><br>
<a name="ybIXB"></a></p>
<h4 id="a">a++</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645853023370-29d29c2d-b35d-40b3-a487-448f445bb548-20220312195355186.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645853146454-088af3e2-7e44-4193-acc2-66e395400c89-20220312195355451.png" alt="image.png" loading="lazy"><br>
<a name="X5zxI"></a></p>
<h4 id="a-2">++a</h4>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645853129168-47251ae1-9647-4541-93c2-b88c65c2b05e-20220312195355733.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645853535988-843af1c8-0d68-4fde-a778-b951a81b9531-20220312195355829.png" alt="image.png" loading="lazy"><br>
<a name="k84hl"></a></p>
<h2 id="æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤">æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤</h2>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645855218703-d9247847-190c-41ef-aa98-22cc662a7a86-20220312195355888.png" alt="image.png" loading="lazy"><br>
<a name="ixepn"></a></p>
<h3 id="å‡ ç‚¹è¯´æ˜">å‡ ç‚¹è¯´æ˜</h3>
<ul>
<li>byteï¼Œshortï¼Œcharéƒ½ä¼šæŒ‰intæ¯”è¾ƒï¼Œå› ä¸ºæ“ä½œæ•°æ ˆéƒ½æ˜¯4</li>
<li>gotoç”¨æ¥è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šè¡Œå·çš„å­—èŠ‚ç <br>
<a name="tEK73"></a></li>
</ul>
<h3 id="æºç ">æºç </h3>
<pre><code class="language-java">public class Demo3_3 {
    public static void main(String[] args) {
        int a = 0;
        if(a == 0) {
            a = 10;
        } else {
            a = 20; 
        }
    }
}
</code></pre>
<p><a name="AcPw2"></a></p>
<h4 id="å­—èŠ‚ç ">å­—èŠ‚ç </h4>
<ul>
<li>iconst_0å¾—åˆ°ä¸€ä¸ª0çš„å¸¸é‡ä»<code>-1-5</code>ä¹‹é—´çš„æ•°ç”¨iconst</li>
</ul>
<pre><code> 0: iconst_0
 1: istore_1
 2: iload_1
 3: ifne          12
 6: bipush        10
 8: istore_1
 9: goto          15
12: bipush        20
14: istore_1
15: return
</code></pre>
<blockquote>
<p>æ€è€ƒ<br>
ç»†å¿ƒçš„åŒå­¦åº”å½“æ³¨æ„åˆ°ï¼Œä»¥ä¸Šæ¯”è¾ƒæŒ‡ä»¤ä¸­æ²¡æœ‰ longï¼Œfloatï¼Œdouble çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆå®ƒä»¬è¦æ¯”è¾ƒæ€ ä¹ˆåŠ?<br>
å‚è€ƒ <a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp</a></p>
</blockquote>
<p><a name="v7Bsr"></a></p>
<h2 id="å¾ªç¯æ§åˆ¶æ‰§è¡Œ">å¾ªç¯æ§åˆ¶æ‰§è¡Œ</h2>
<p>å…¶å®å¾ªç¯æ§åˆ¶è¿˜æ˜¯æ¡ä»¶åˆ¤æ–­ä¸­çš„é‚£äº›æŒ‡ä»¤<br>
<a name="qe7Qz"></a></p>
<h3 id="whileæºä»£ç ">Whileæºä»£ç </h3>
<pre><code class="language-java">public class Demo3_4 {
    public static void main(String[] args) {
        int a = 0;
        while (a &lt; 10) {
            a++; 
        }
    } 
}
</code></pre>
<p><a name="dZM49"></a></p>
<h4 id="whileå¯¹åº”å­—èŠ‚ç ">Whileå¯¹åº”å­—èŠ‚ç </h4>
<pre><code> 0: iconst_0
 1: istore_1
 2: iload_1
 3: bipush			10
 5: if_icmpge		14
 8: iinc				1, 1
11: goto				2
14: return
</code></pre>
<p><a name="Q7l6W"></a></p>
<h3 id="do-whileæºä»£ç ">Do whileæºä»£ç </h3>
<pre><code class="language-java">public class Demo3_5 {
    public static void main(String[] args) {
        int a = 0; 
        do {
            a++;
        } while (a &lt; 10);
    }
}
</code></pre>
<p><a name="WnKUb"></a></p>
<h4 id="do-whileå­—èŠ‚ç ">Do whileå­—èŠ‚ç </h4>
<pre><code>0: iconst_0 
1: istore_1 		
2: iinc					1, 1
5: iload_1 
6: bipush				10
8: if_icmplt		2
11: return
</code></pre>
<p><a name="OyVS9"></a></p>
<h3 id="forå¾ªç¯æºä»£ç ">Forå¾ªç¯æºä»£ç </h3>
<pre><code class="language-java">public class Demo3_6 {
    public static void main(String[] args) {
        for (int i = 0; i &lt; 10; i++) {
        }
    }
}
</code></pre>
<p><a name="dvjzY"></a></p>
<h4 id="forå¾ªç¯å­—èŠ‚ç ">Forå¾ªç¯å­—èŠ‚ç </h4>
<pre><code> 0: iconst_0
 1: istore_1
 2: iload_1
 3: bipush				10
 5: if_icmpge			14
 8: iinc					1, 1
11: goto					2
14: return
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
æ¯”è¾ƒwhileå’Œforçš„å­—èŠ‚ç ï¼Œä½ å‘ç°ä»–ä»¬æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ®Šé€”åŒå½’</p>
</blockquote>
<p><a name="L3nYZ"></a></p>
<h3 id="ç»ƒä¹ ">ç»ƒä¹ </h3>
<pre><code class="language-java">public class Demo3_6_1 {
    public static void main(String[] args) {
        int i = 0;
        int x = 0;
        while (i &lt; 10) {
			x = x++;//iload_x --&gt; iinc 1,1 --&gt; istore_x(å­˜å›å»çš„x=0è¦†ç›–äº†è‡ªå¢åçš„x=1)
			i++; 
        }
		System.out.println(x); // ç»“æœæ˜¯ 0 
    }
}
</code></pre>
<p><a name="yvQpL"></a></p>
<h2 id="æ„é€ å™¨æ–¹æ³•">æ„é€ å™¨æ–¹æ³•</h2>
<p><a name="Jf0W3"></a></p>
<h3 id="cinitv"><cinit>()V</h3>
<pre><code class="language-java">public class Demo3_8_1 {
    static int i = 10;
    
    static {
        i = 20;
    }
    
    static {
        i = 30;
    } 
}
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹ æ³• <code>&lt;cinit&gt;()V </code></p>
<pre><code> 0: bipush        10
 2: putstatic     #2				//Field i:I
 5: bipush        20
 7: putstatic     #2				//Field i:I
10: bipush        30
12: putstatic     #2				//Field i:I
15: return
</code></pre>
<p><code>&lt;cinit&gt;()V </code>æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨</p>
<blockquote>
<p>ç»ƒä¹ <br>
å¯ä»¥è°ƒæ•´ä¸€ä¸‹staticå˜é‡å’Œé™æ€ä»£ç å—çš„ä½ç½®ï¼Œè§‚å¯Ÿå­—èŠ‚ç çš„æ”¹åŠ¨</p>
</blockquote>
<p><a name="qbO71"></a></p>
<h3 id="initv"><init>()V</h3>
<pre><code class="language-java">public class Demo3_8_2 {
    private String a = &quot;s1&quot;;
    {
        b = 20;
    }
    private int b = 10;
    {
        a = &quot;s2&quot;;
    }
    public Demo3_8_2(String a, int b) {
        this.a = a;
        this.b = b; 
    }
    public static void main(String[] args) {
        Demo3_8_2 d = new Demo3_8_2(&quot;s3&quot;, 30);
        System.out.println(d.a);
        System.out.println(d.b);
    } 
}

</code></pre>
<p>ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œå½¢æˆæ–°çš„æ„é€ æ–¹æ³•ï¼Œä½†åŸå§‹æ„ é€ æ–¹æ³•å†…çš„ä»£ç æ€»æ˜¯åœ¨æœ€å</p>
<ul>
<li>aload_0æŠŠthisåŠ è½½åˆ°æ ˆ</li>
<li>
<br />
</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645858529647-7b17bf1a-fc5a-498f-b072-84be9d54bb6d-20220312195356178.png" alt="image.png" loading="lazy"><br>
<a name="gKCP6"></a></p>
<h2 id="æ–¹æ³•è°ƒç”¨">æ–¹æ³•è°ƒç”¨</h2>
<p>çœ‹ä¸€ä¸‹å‡ ç§ä¸åŒçš„æ–¹æ³•è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤</p>
<pre><code class="language-java">public class Demo3_9 {
    public Demo3_9() { }
    private void test1() { }
    private final void test2() { }
    public void test3() { }
    public static void test4() { }
    public static void main(String[] args) {
        Demo3_9 d = new Demo3_9();
        d.test1();
        d.test2();
    } 
}
</code></pre>
<pre><code> 0: new           #2						//class cn/itcast/jvm/t3/bytecode/Demo3_9
 3: dup
 4: invokespecial #3						//Method &quot;&lt;init&gt;&quot;:()V
 7: astore_1				
 8: aload_1	
 9: invokespecial #4						//Method test1:()V
12: aload_1
13: invokespecial #5						//Method test2:()V
16: aload_1
17: invokevirtual #6						//Method test3:()V
20: aload_1
21: pop
22: invokestatic  #7						//Method test4:()V
25: invokestatic  #7						//Method test4:()V
28: return
</code></pre>
<ul>
<li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘å‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• &quot;<init>&quot;ğŸ˜¦)V (ä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨)ï¼Œå¦ä¸€ä¸ªè¦é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡</li>
<li>æœ€ç»ˆæ–¹æ³•(final)ï¼Œç§æœ‰æ–¹æ³•(private)ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š</li>
<li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äºåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€ ï¼Œå…·ä½“æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶ç¡®å®š</li>
<li>æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘</li>
<li>æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ d.test4(); æ˜¯é€šè¿‡ã€å¯¹è±¡å¼•ç”¨ã€‘è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨ invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠã€å¯¹è±¡å¼•ç”¨ã€‘ä»æ“ä½œæ•°æ ˆå¼¹æ‰äº†ï¼Œå› æ­¤è°ƒç”¨é™æ€æ–¹æ³•æ—¶ä¸è¦ä½¿ç”¨å¯¹è±¡è°ƒç”¨ï¼Œä¼šäº§ç”Ÿä¸¤æ¡æ— ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œç›´æ¥ä½¿ç”¨ç±»æ¥è°ƒç”¨å³å¯</li>
<li>è¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œ invokespecial çš„æƒ…å†µæ˜¯é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹æ³•<br>
<a name="PJeyb"></a></li>
</ul>
<h2 id="å¤šæ€çš„åŸç†">å¤šæ€çš„åŸç†</h2>
<pre><code class="language-java">package cn.itcast.jvm.t3.bytecode;
import java.io.IOException;
/**
* æ¼”ç¤ºå¤šæ€åŸç†ï¼Œæ³¨æ„åŠ ä¸Šä¸‹é¢çš„ JVM å‚æ•°ï¼Œç¦ç”¨æŒ‡é’ˆå‹ç¼©
* -XX:-UseCompressedOops -XX:-UseCompressedClassPointers */
public class Demo3_10 {
    public static void test(Animal animal) {
        animal.eat();
        System.out.println(animal.toString());
    }
    public static void main(String[] args) throws IOException {
        test(new Cat());
        test(new Dog());
        System.in.read();
    }
}

abstract class Animal {
    public abstract void eat();
    @Override
    public String toString() {
        return &quot;æˆ‘æ˜¯&quot; + this.getClass().getSimpleName();
    } 
}

class Dog extends Animal {
    @Override
    public void eat() { 
        System.out.println(&quot;å•ƒéª¨å¤´&quot;);
    } 
}

class Cat extends Animal {
    @Override
    public void eat() { 
        System.out.println(&quot;åƒé±¼&quot;);
    } 
}
</code></pre>
<p><a name="tepZO"></a></p>
<h3 id="è¿è¡Œä»£ç ">è¿è¡Œä»£ç </h3>
<p>åœåœ¨ System.in.read() æ–¹æ³•ä¸Šï¼Œè¿™æ—¶è¿è¡Œ jps è·å–è¿›ç¨‹ id<br>
<a name="HljgA"></a></p>
<h3 id="è¿è¡Œhsdbå·¥å…·">è¿è¡ŒHSDBå·¥å…·</h3>
<p>è¿›å…¥JDKå®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ<br /><code>java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB</code><br>
<a name="xwoAc"></a></p>
<h3 id="æŸ¥æ‰¾æŸä¸ªå¯¹è±¡">æŸ¥æ‰¾æŸä¸ªå¯¹è±¡</h3>
<p>æ‰“å¼€Tools --&gt; Find Object By Query<br />è¾“å…¥<code>select d from cn.itcast.jvm.t3.bytecode.Dog d</code>ç‚¹å‡»Executeæ‰§è¡Œ<br /><code>dä¸ºæŒ‡å®šçš„ç±»å‹åˆ«å</code><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645860895070-01e16056-2661-4c77-b94f-b78417e1bcb6-20220312195356205.png" alt="image.png" loading="lazy"><br>
<a name="PW7mo"></a></p>
<h3 id="æŸ¥çœ‹å¯¹è±¡å†…å­˜ç»“æ„">æŸ¥çœ‹å¯¹è±¡å†…å­˜ç»“æ„</h3>
<p>ç‚¹å‡»è¶…é“¾æ¥å¯ä»¥çœ‹åˆ°å¯¹è±¡çš„å†…å­˜ç»“æ„ï¼Œæ­¤å¯¹è±¡æ²¡æœ‰ä»»ä½•å±æ€§ï¼Œå› æ­¤åªæœ‰å¯¹è±¡å¤´çš„ 16 å­—èŠ‚ï¼Œå‰ 8 å­—èŠ‚æ˜¯<br />MarkWordï¼Œå 8 å­—èŠ‚å°±æ˜¯å¯¹è±¡çš„ Class æŒ‡é’ˆ <br />ä½†ç›®å‰çœ‹ä¸åˆ°å®ƒçš„å®é™…åœ°å€<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645860939528-45eb91c6-9405-4f99-bc64-0f3b92bdcc1a-20220312195356237.png" alt="image.png" loading="lazy"><br>
<a name="HUtyi"></a></p>
<h3 id="æŸ¥çœ‹å¯¹è±¡classçš„å†…å­˜åœ°å€">æŸ¥çœ‹å¯¹è±¡Classçš„å†…å­˜åœ°å€</h3>
<p>é€šè¿‡windows --&gt; console è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œ<br /><code>mem 0x00000001299b4978 2</code><br />memæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•°1æ˜¯å¯¹è±¡åœ°å€ï¼Œå‚æ•°2æ˜¯æŸ¥çœ‹2è¡Œ(å³16å­—èŠ‚)<br />ç»“æœä¸­ç¬¬äºŒè¡Œ 0x000000001b7d4028 å³ä¸º Class çš„å†…å­˜åœ°å€<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645861038408-47c8a77b-3a6e-4c74-90c4-47b4f70297bb-20220312195356282.png" alt="image.png" loading="lazy"><br>
<a name="ElR7V"></a></p>
<h3 id="æŸ¥çœ‹ç±»çš„vtable">æŸ¥çœ‹ç±»çš„vtable</h3>
<ul>
<li>æ–¹æ³•1:Alt+Rè¿›å…¥Inspectorå·¥å…·ï¼Œè¾“å…¥åˆšæ‰çš„Classå†…å­˜åœ°å€ï¼Œçœ‹åˆ°å¦‚ä¸‹æ´é¢</li>
</ul>
<figure data-type="image" tabindex="2"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645861093102-40364e6e-de00-44c6-80b3-92456584fc27-20220312195356598.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æ–¹æ³•2:æˆ–è€… Tools -&gt; Class Browser è¾“å…¥ Dog æŸ¥æ‰¾ï¼Œå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœ</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645861118051-a13134d1-6556-4219-b8ba-061ee6cf2a0f-20220312195356705.png" alt="image.png" loading="lazy"><br />æ— è®ºé€šè¿‡å“ªç§æ–¹æ³•ï¼Œéƒ½å¯ä»¥æ‰¾åˆ° Dog Class çš„ vtable é•¿åº¦ä¸º 6ï¼Œæ„æ€å°±æ˜¯ Dog ç±»æœ‰ 6 ä¸ªè™šæ–¹æ³•(å¤šæ€ç›¸å…³çš„ï¼Œfinalï¼Œstatic ä¸ä¼šåˆ—å…¥)<br />é‚£ä¹ˆè¿™ 6 ä¸ªæ–¹æ³•éƒ½æ˜¯è°å‘¢?ä» Class çš„èµ·å§‹åœ°å€å¼€å§‹ç®—ï¼Œåç§» 0x1b8 å°±æ˜¯ vtable çš„èµ·å§‹åœ°å€ï¼Œè¿›è¡Œè®¡ç®—å¾—åˆ°:</p>
<pre><code>0x000000001b7d4028
               1b8 +
---------------------
0x000000001b7d41e0
</code></pre>
<p>é€šè¿‡windows --&gt; consoleè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œ</p>
<pre><code>mem 0x000000001b7d41e0 6

0x000000001b7d41e0: 0x000000001b3d1b10
0x000000001b7d41e8: 0x000000001b3d15e8
0x000000001b7d41f0: 0x000000001b7d35e8
0x000000001b7d41f8: 0x000000001b3d1540
0x000000001b7d4200: 0x000000001b3d1678
0x000000001b7d4208: 0x000000001b7d3fa8
</code></pre>
<p>å°±å¾—åˆ°äº†6ä¸ªè™šæ–¹æ³•çš„å…¥å£<br>
<a name="Rvr9R"></a></p>
<h3 id="éªŒè¯æ–¹æ³•åœ°å€">éªŒè¯æ–¹æ³•åœ°å€</h3>
<p>é€šè¿‡ Tools -&gt; Class Browser æŸ¥çœ‹æ¯ä¸ªç±»çš„æ–¹æ³•å®šä¹‰ï¼Œæ¯”è¾ƒå¯çŸ¥</p>
<pre><code>Dog - public void eat() @0x000000001b7d3fa8
Animal - public java.lang.String toString() @0x000000001b7d35e8;
Object - protected void finalize() @0x000000001b3d1b10;
Object - public boolean equals(java.lang.Object) @0x000000001b3d15e8;
Object - public native int hashCode() @0x000000001b3d1540;
Object - protected native java.lang.Object clone() @0x000000001b3d1678;
</code></pre>
<p>å¯¹å·å…¥åº§ï¼Œå‘ç°</p>
<ul>
<li>eat() æ–¹æ³•æ˜¯ Dog ç±»è‡ªå·±çš„</li>
<li>toString() æ–¹æ³•æ˜¯ç»§æ‰¿ Animal ç±»çš„</li>
<li>finalize() ï¼Œequals()ï¼ŒhashCode()ï¼Œclone() éƒ½æ˜¯ç»§æ‰¿ Object ç±»çš„<br>
<a name="Gjh9x"></a></li>
</ul>
<h3 id="å°ç»“">å°ç»“</h3>
<p>å½“æ‰§è¡Œ invokevirtual æŒ‡ä»¤æ—¶ï¼Œ</p>
<ol>
<li>å…ˆé€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡çš„å®é™… Class</li>
<li>Class ç»“æ„ä¸­æœ‰ vtableï¼Œå®ƒåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µå°±å·²ç»æ ¹æ®æ–¹æ³•çš„é‡å†™è§„åˆ™ç”Ÿæˆå¥½äº†</li>
<li>æŸ¥è¡¨å¾—åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</li>
<li>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç <br>
<a name="VcWXL"></a></li>
</ol>
<h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h2>
<p><a name="XlU1a"></a></p>
<h3 id="try-catch">try-catch</h3>
<pre><code class="language-java">public class Demo3_11_1 {
    public static void main(String[] args) {
        int i = 0;
        try {
            i = 10;
        } catch (Exception e) {
            i = 20;
        }
    }
}
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
ä¸ºäº†æŠ“ä½é‡ç‚¹ï¼Œä¸‹é¢çš„å­—èŠ‚ç çœç•¥äº†ä¸é‡è¦çš„éƒ¨åˆ†</p>
</blockquote>
<pre><code>public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=3, args_size=1
         0: iconst_0
         1: istore_1
         2: bipush        10
         4: istore_1
         5: goto          12
         8: astore_2
         9: bipush        20
11: istore_1
        12: return
      Exception table:
         from    to  target type
             2     5     8   Class java/lang/Exception
      LineNumberTable: ...
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            9       3     2     e   Ljava/lang/Exception;
            0      13     0  args   [Ljava/lang/String;
            2      11     1     i   I
      StackMapTable: ...
    MethodParameters: ...
}
</code></pre>
<ul>
<li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯å‰é—­åå¼€çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·</li>
<li>8 è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 2 ä½ç½®<br>
<a name="RK1IO"></a></li>
</ul>
<h3 id="å¤šä¸ªsingle-catchå—çš„æƒ…å†µ">å¤šä¸ªsingle-catchå—çš„æƒ…å†µ</h3>
<pre><code class="language-java">public class Demo3_11_2 {
    public static void main(String[] args) {
        int i = 0;
        try {
            i = 10;
        } catch (ArithmeticException e) {
            i = 30;
        } catch (NullPointerException e) {
            i = 40;
        } catch (Exception e) {
            i = 50; 
        }
    }
}
</code></pre>
<pre><code>public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=3, args_size=1
         0: iconst_0
         1: istore_1
         2: bipush        10
         4: istore_1
         5: goto          26
         8: astore_2
         9: bipush        30
        11: istore_1
        12: goto          26
        15: astore_2
        16: bipush        40
        18: istore_1
        19: goto          26
        22: astore_2
        23: bipush        50
        25: istore_1
        26: return
      Exception table:
         from    to  target type
258 2 5 15 2 5 22
LineNumberTable: ...
LocalVariableTable:
Class java/lang/ArithmeticException
Class java/lang/NullPointerException
Class java/lang/Exception
    Start  Length  Slot  Name   Signature
        9       3     2     e   Ljava/lang/ArithmeticException;
       16       3     2     e   Ljava/lang/NullPointerException;
       23       3     2     e   Ljava/lang/Exception;
        0      27     0  args   [Ljava/lang/String;
        2      25     1     i   I
  StackMapTable: ...
MethodParameters: ...
</code></pre>
<ul>
<li>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œåªèƒ½è¿›å…¥Exception tableä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨slot2ä½ç½®è¢«å…±ç”¨<br>
<a name="P5WAt"></a></li>
</ul>
<h3 id="multi-catchçš„æƒ…å†µ">multi-catchçš„æƒ…å†µ</h3>
<pre><code class="language-java">public class Demo3_11_3 {
    public static void main(String[] args) {
        try {
            Method test = Demo3_11_3.class.getMethod(&quot;test&quot;);
            test.invoke(null);
        } catch (NoSuchMethodException | 
                 IllegalAccessException |
                 InvocationTargetException e) {
            e.printStackTrace();
        } 
    }
    public static void test() {
        System.out.println(&quot;ok&quot;);
    } 
}
</code></pre>
<pre><code>public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=3, locals=2, args_size=1
         0: ldc           #2
         2: ldc           #3
         4: iconst_0
         5: anewarray     #4
         8: invokevirtual #5
        11: astore_1
        12: aload_1
        13: aconst_null
        14: iconst_0
        15: anewarray     #6
        18: invokevirtual #7
        21: pop
        22: goto          30
        25: astore_1
        26: aload_1
        27: invokevirtual #11 // e.printStackTrace:()V
        30: return
      Exception table:
         from    to  target type
       0    22    25
       0    22    25
       0    22    25
LineNumberTable: ...
LocalVariableTable:
Class java/lang/NoSuchMethodException
Class java/lang/IllegalAccessException
Class java/lang/reflect/InvocationTargetException
    Start  Length  Slot  Name   Signature
       12      10     1  test   Ljava/lang/reflect/Method;
       26       4     1     e   Ljava/lang/ReflectiveOperationException;
        0      31     0  args   [Ljava/lang/String;
  StackMapTable: ...
MethodParameters: ...
</code></pre>
<p><a name="x1uES"></a></p>
<h3 id="finally">finally</h3>
<pre><code class="language-java">public class Demo3_11_4 {
    public static void main(String[] args) {
        int i = 0;
        try {
            i = 10;
        } catch (Exception e) {
            i = 20;
        } finally {
            i = 30;
        } 
    }
}
</code></pre>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645863188002-c36058a0-22f9-4098-b174-d256178f659d-20220312195357006.png" alt="image.png" loading="lazy"><br />å¯ä»¥çœ‹åˆ° finally ä¸­çš„ä»£ç è¢«å¤åˆ¶äº† 3 ä»½ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catch å‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹<br>
<a name="VVP60"></a></p>
<h4 id="finallyé¢è¯•é¢˜">finallyé¢è¯•é¢˜</h4>
<p><a name="g4F1n"></a></p>
<h5 id="finallyå‡ºç°äº†return">finallyå‡ºç°äº†return</h5>
<pre><code class="language-java">public class Demo3_12_2 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        try {
            return 10;
        } finally {
            return 20; 
        }
    }
}
</code></pre>
<pre><code>public static int test();
  descriptor: ()I
  flags: ACC_PUBLIC, ACC_STATIC
  Code:
    stack=1, locals=2, args_size=0
    	0: bipush				10		//&lt;--10æ”¾å…¥æ ˆé¡¶
			2: istore_0						//10--&gt;slot0(ä»æ ˆé¡¶ç§»é™¤äº†)
			3: bipush				20    //&lt;--20æ”¾å…¥æ ˆé¡¶
			5: ireturn						//è¿”å›æ ˆé¡¶ int(20)
			6: astore_1						//catch any --&gt; slot 1
			7: bipush				20		//&lt;--20æ”¾å…¥æ ˆé¡¶
			9: ireturn						//è¿”å›æ ˆé¡¶ int(20)
    Exception table
  from    to  target type
     0     3     6   any
	LineNumberTable: ...
	StackMapTable: ... 
</code></pre>
<ul>
<li>ç”±äº finally ä¸­çš„ ireturn è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ finally çš„ä¸ºå‡† è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­</li>
<li>è·Ÿä¸Šä¾‹ä¸­çš„ finally ç›¸æ¯”ï¼Œå‘ç°æ²¡æœ‰ athrow äº†ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬:å¦‚æœåœ¨ finally ä¸­å‡ºç°äº† returnï¼Œä¼šåæ‰å¼‚å¸¸ğŸ˜±ğŸ˜±ğŸ˜±ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ä¸‹é¢çš„ä»£ç </li>
</ul>
<pre><code class="language-java">public class Demo3_12_1 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        try {
            int i = 1/0;
    		return 10;
		} finally {
            return 20; 
        }
    }
}
</code></pre>
<p><a name="B7qd6"></a></p>
<h4 id="finallyå¯¹è¿”å›å€¼çš„å½±å“">finallyå¯¹è¿”å›å€¼çš„å½±å“</h4>
<pre><code class="language-java">public class Demo3_12_2 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        int i = 10;
        try {
            return i;
        } finally {
            i = 20;
        } 
    }
}
</code></pre>
<pre><code>public static int test();
  descriptor: ()I
  flags: ACC_PUBLIC, ACC_STATIC
  Code:
    stack=1, locals=3, args_size=0
    	0: bipush				10		// &lt;- 10 æ”¾å…¥æ ˆé¡¶
			2: istore_0						// 10-&gt;i
			3: iload_0						// &lt;- i(10)
			4: istore_1						// 10 -&gt; slot 1ï¼Œæš‚å­˜è‡³ slot 1ï¼Œç›®çš„æ˜¯ä¸ºäº†å›ºå®šè¿”å›å€¼
			5: bipush				20		// &lt;- 20 æ”¾å…¥æ ˆé¡¶
			7: istore_0						// 20-&gt;i
			8: iload_1						// &lt;- slot 1(10) è½½å…¥ slot 1 æš‚å­˜çš„å€¼
			9: ireturn						// è¿”å›æ ˆé¡¶çš„ int(10)
      10: astore_2
  		11: bipush    	20
  		13: istore_0
  		14: aload_2
  		15: athrow
    Exception table:
   	from    to  target type
       3     5    10   any
		LineNumberTable: ...
		LocalVariableTable:
  	Start  Length  Slot  Name   Signature
				3 			13 		0 		i 					I
    StackMapTable: ...
</code></pre>
<p><a name="ZHWkF"></a></p>
<h2 id="synchronized">synchronized</h2>
<pre><code class="language-java">public class Demo3_13 {
    public static void main(String[] args) {
        Object lock = new Object();
        synchronized (lock) {
            System.out.println(&quot;ok&quot;);
        }
    }
}
</code></pre>
<figure data-type="image" tabindex="3"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645867124693-fa8cddde-949a-468d-88cc-d16f860c9d1e-20220312195357240.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>monitorenteråŠ é”ï¼Œmonitorexitè§£é”</li>
</ul>
<blockquote>
<p>æ³¨æ„<br>
æ–¹æ³•çº§åˆ«çš„synchronizedä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“ç°</p>
</blockquote>
<p><a name="K44Uv"></a></p>
<h1 id="ç¼–è¯‘æœŸå¤„ç†">ç¼–è¯‘æœŸå¤„ç†</h1>
<p>è¯­æ³•ç³– ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ å’Œè½¬æ¢çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©(ç»™ç³–åƒå˜›)<br />æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚<br>
<a name="iBUE2"></a></p>
<h2 id="é»˜è®¤æ„é€ å™¨">é»˜è®¤æ„é€ å™¨</h2>
<pre><code class="language-java">public class Candy1 {
}
</code></pre>
<p><a name="ccKZe"></a></p>
<h3 id="ç¼–è¯‘æˆclassåçš„ä»£ç ">ç¼–è¯‘æˆclassåçš„ä»£ç </h3>
<pre><code class="language-java">public class Candy1 {
	// è¿™ä¸ªæ— å‚æ„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„ 
    public Candy1() {
		super(); // å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot; &lt;init&gt;&quot;:()V
	} 
}
</code></pre>
<p><a name="Eo7mg"></a></p>
<h2 id="è‡ªåŠ¨æ‹†è£…ç®±">è‡ªåŠ¨æ‹†è£…ç®±</h2>
<p>è¿™ä¸ªç‰¹æ€§æ˜¯<code>JDK 5</code>å¼€å§‹åŠ å…¥çš„</p>
<pre><code class="language-java">public class Candy2 {
    public static void main(String[] args) {
		Integer x = 1;
		int y = x; 
    }
}
</code></pre>
<p>è¿™æ®µä»£ç åœ¨<code>JDK 5</code>ä¹‹å‰æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå¿…é¡»æ”¹å†™ä¸º:</p>
<pre><code class="language-java">public class Candy2 {
    public static void main(String[] args) {
        Integer x = Integer.valueOf(1);
        int y = x.intValue();
    }
}
</code></pre>
<p>æ˜¾ç„¶ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç å¤ªéº»çƒ¦äº†ï¼Œéœ€è¦åœ¨åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´æ¥å›è½¬æ¢(å°¤å…¶æ˜¯é›†åˆç±»ä¸­æ“ä½œçš„éƒ½æ˜¯ åŒ…è£…ç±»å‹)ï¼Œå› æ­¤è¿™äº›è½¬æ¢çš„äº‹æƒ…åœ¨ JDK 5 ä»¥åéƒ½ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆã€‚å³ <code>ä»£ç ç‰‡æ®µ1</code> éƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸º <code>ä»£ç ç‰‡æ®µ2</code><br>
<a name="lG6Ur"></a></p>
<h2 id="æ³›å‹é›†åˆå–å€¼">æ³›å‹é›†åˆå–å€¼</h2>
<p>æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›å‹ä»£ç åä¼šæ‰§è¡Œ <code>æ³›å‹æ“¦é™¤</code> çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯<br />åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±ä¸¢å¤±äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† Object ç±»å‹æ¥å¤„ç†:</p>
<pre><code class="language-java">public class Candy3 {
    public static void main(String[] args) {
        List&lt;Integer&gt; list = new ArrayList&lt;&gt;();
        list.add(10); // å®é™…è°ƒç”¨çš„æ˜¯ List.add(Object e)
        Integer x = list.get(0); // å®é™…è°ƒç”¨çš„æ˜¯ Object obj = List.get(int index);
    }
}
</code></pre>
<p>æ‰€ä»¥åœ¨å–å€¼æ—¶ï¼Œç¼–è¯‘å™¨çœŸæ­£ç”Ÿæˆçš„å­—èŠ‚ç ä¸­ï¼Œè¿˜è¦é¢å¤–åšä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ</p>
<pre><code class="language-java">// éœ€è¦å°† Object è½¬ä¸º Integer 
Integer x = (Integer)list.get(0);
</code></pre>
<p>å¦‚æœå‰é¢çš„xå˜é‡ç±»å‹ä¿®æ”¹ä¸ºintåŸºæœ¬ç±»å‹é‚£ä¹ˆæœ€ç»ˆç”Ÿæˆçš„å­—èŠ‚ç æ˜¯</p>
<pre><code class="language-java">// éœ€è¦å°† Object è½¬ä¸º Integer, å¹¶æ‰§è¡Œæ‹†ç®±æ“ä½œ 
int x = ((Integer)list.get(0)).intValue();
</code></pre>
<p>æ“¦é™¤çš„æ˜¯å­—èŠ‚ç ä¸Šçš„æ³›å‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ° LocalVariableTypeTable ä»ç„¶ä¿ç•™äº†æ–¹æ³•å‚æ•°æ³›å‹çš„ä¿¡æ¯</p>
<pre><code>LocalVariableTable:
  Start  Length  Slot  Name   Signature
  		0      32     0  args   [Ljava/lang/String;
      8      24     1  list   Ljava/util/List;
LocalVariableTypeTable:
  Start  Length  Slot  Name   Signature
      8      24     1  list   Ljava/util/List&lt;Ljava/lang/Integer;&gt;;
</code></pre>
<p>ä½¿ç”¨åå°„ï¼Œä»ç„¶èƒ½å¤Ÿè·å¾—è¿™äº›ä¿¡æ¯</p>
<pre><code class="language-java">public Set&lt;Integer&gt; test(List&lt;String&gt; list, Map&lt;Integer, Object&gt; map) {
}
</code></pre>
<pre><code class="language-java">Method test = Candy3.class.getMethod(&quot;test&quot;, List.class, Map.class);
Type[] types = test.getGenericParameterTypes();
for (Type type : types) {
    if (type instanceof ParameterizedType) {
        ParameterizedType parameterizedType = (ParameterizedType) type; 
        System.out.println(&quot;åŸå§‹ç±»å‹ - &quot; + parameterizedType.getRawType()); 
        Type[] arguments = parameterizedType.getActualTypeArguments(); 
        for (int i = 0; i &lt; arguments.length; i++) {
            System.out.printf(&quot;æ³›å‹å‚æ•°[%d] - %s\n&quot;, i, arguments[i]); 
        }
    }
}
</code></pre>
<pre><code class="language-java">//è¾“å‡ºç»“æœ
åŸå§‹ç±»å‹ - interface java.util.List 
æ³›å‹å‚æ•°[0] - class java.lang.String 
åŸå§‹ç±»å‹ - interface java.util.Map 
æ³›å‹å‚æ•°[0] - class java.lang.Integer 
æ³›å‹å‚æ•°[1] - class java.lang.Object
</code></pre>
<p><a name="HUhIk"></a></p>
<h2 id="å¯å˜å‚æ•°">å¯å˜å‚æ•°</h2>
<p>å¯å˜å‚æ•°ä¹Ÿæ˜¯JDK 5å¼€å§‹åŠ å…¥çš„æ–°ç‰¹æ€§</p>
<pre><code class="language-java">public class Candy4 {
    public static void foo(String... args) {
		String[] array = args; // ç›´æ¥èµ‹å€¼
        System.out.println(array);
    }
    public static void main(String[] args) {
        foo(&quot;hello&quot;, &quot;world&quot;);
	} 
}
</code></pre>
<p>å¯å˜å‚æ•° String... args å…¶å®æ˜¯ä¸€ä¸ª String[] args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒæ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸º:</p>
<pre><code class="language-java">public class Candy4 {
    public static void foo(String[] args) {
		String[] array = args; // ç›´æ¥èµ‹å€¼
        System.out.println(array);
    }
    public static void main(String[] args) {
        foo(new String[]{&quot;hello&quot;, &quot;world&quot;});
	} 
}
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
å¦‚æœè°ƒç”¨äº†foo()åˆ™ç­‰ä»·ä»£ç ä¸ºfoo(new String[]{})ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè€Œä¸ä¼šä¼ é€’nullè¿›å»</p>
</blockquote>
<p><a name="tDpcp"></a></p>
<h2 id="foreachå¾ªç¯">foreachå¾ªç¯</h2>
<p>ä»æ˜¯JDK5å¼€å§‹å¼•å…¥çš„è¯­æ³•ç³–ï¼Œ<br>
<a name="N939v"></a></p>
<h3 id="æ•°ç»„çš„å¾ªç¯">æ•°ç»„çš„å¾ªç¯ï¼š</h3>
<pre><code class="language-java">public class Candy5_1 {
    public static void main(String[] args) {
        int[] array = {1, 2, 3, 4, 5}; // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦ 
        for (int e : array) {
            System.out.println(e);
        }
    }
}
</code></pre>
<p>ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸º</p>
<pre><code class="language-java">public class Candy5_1 {
    public Candy5_1() {
    }
    public static void main(String[] args) {
        int[] array = new int[]{1, 2, 3, 4, 5};
        for(int i = 0; i &lt; array.length; ++i) {
            int e = array[i];
            System.out.println(e);
        }
    }
}
</code></pre>
<p><a name="lD1Zs"></a></p>
<h3 id="é›†åˆçš„å¾ªç¯">é›†åˆçš„å¾ªç¯</h3>
<pre><code class="language-java">public class Candy5_2 {
    public static void main(String[] args) {
        List&lt;Integer&gt; list = Arrays.asList(1,2,3,4,5);
        for (Integer i : list) {
            System.out.println(i);
        }
    }
}
</code></pre>
<p>å®é™…è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå¯¹è¿­ä»£å™¨çš„è°ƒç”¨</p>
<pre><code class="language-java">public class Candy5_2 {
   public Candy5_2() {
   }
   public static void main(String[] args) {
       List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5);
       Iterator iter = list.iterator();
       while(iter.hasNext()) {
           Integer e = (Integer)iter.next();
           System.out.println(e);
       }
   }
}
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
foreachå¾ªç¯å†™æ³•ï¼Œèƒ½å¤Ÿé…åˆæ•°ç»„ï¼Œä»¥åŠæ‰€æœ‰å®ç°äº†iterableæ¥å£çš„é›†åˆç±»ä¸€èµ·é£Ÿç”¨ï¼Œå…¶ä¸­Iterableç”¨æ¥è·å–é›†åˆçš„è¿­ä»£å™¨</p>
</blockquote>
<p><a name="fzgxG"></a></p>
<h2 id="switchå­—ç¬¦ä¸²">switchå­—ç¬¦ä¸²</h2>
<p>ä» JDK 7 å¼€å§‹ï¼Œswitch å¯ä»¥ä½œç”¨äºå­—ç¬¦ä¸²å’Œæšä¸¾ç±»ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®ä¹Ÿæ˜¯è¯­æ³•ç³–</p>
<pre><code class="language-java">public class Candy6_1 {
    public static void choose(String str) {
        switch (str) {
            case &quot;hello&quot;: {
                System.out.println(&quot;h&quot;);
				break; 
            }
            case &quot;world&quot;: {
                System.out.println(&quot;w&quot;);
                break;
			} 
        }
    } 
}
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
switch é…åˆ String å’Œæšä¸¾ä½¿ç”¨æ—¶ï¼Œå˜é‡ä¸èƒ½ä¸ºnullï¼ŒåŸå› åˆ†æå®Œè¯­æ³•ç³–è½¬æ¢åçš„ä»£ç åº”å½“è‡ªç„¶æ¸…æ¥š</p>
</blockquote>
<pre><code class="language-java">public class Candy6_1 {
    public Candy6_1() {
    }
    public static void choose(String str) {
		byte x = -1; 
        switch(str.hashCode()) {
            case 99162322: // hello çš„ hashCode
                if (str.equals(&quot;hello&quot;)) {
                    x = 0; 
                }
				break;
            case 113318802: // world çš„ hashCode
                if (str.equals(&quot;world&quot;)) {
                    x = 1;
                } 
        }
		switch(x) {
            case 0:
                System.out.println(&quot;h&quot;);
                break;
            case 1:
                System.out.println(&quot;w&quot;);
        }
    }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†ä¸¤é switchï¼Œç¬¬ä¸€éæ˜¯æ ¹æ®å­—ç¬¦ä¸²çš„ hashCode å’Œ equals å°†å­—ç¬¦ä¸²çš„è½¬æ¢ä¸ºç›¸åº” byte ç±»å‹ï¼Œç¬¬äºŒéæ‰æ˜¯åˆ©ç”¨ byte æ‰§è¡Œè¿›è¡Œæ¯”è¾ƒã€‚<br />ä¸ºä»€ä¹ˆç¬¬ä¸€éæ—¶å¿…é¡»æ—¢æ¯”è¾ƒ hashCodeï¼Œåˆåˆ©ç”¨ equals æ¯”è¾ƒå‘¢?<br />hashCode æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‡å°‘å¯ èƒ½çš„æ¯”è¾ƒ;<br />è€Œ equals æ˜¯ä¸ºäº†é˜²æ­¢ hashCode å†²çªï¼Œä¾‹å¦‚ BM å’Œ C. è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashCodeå€¼éƒ½æ˜¯2123 ï¼Œå¦‚æœæœ‰å¦‚ä¸‹ä»£ç :</p>
<pre><code class="language-java">public class Candy6_2 {
    public static void choose(String str) {
        switch (str) {
            case &quot;BM&quot;: {
                System.out.println(&quot;h&quot;);
                break; 
            }
            case &quot;C.&quot;: {
                System.out.println(&quot;w&quot;);
                break;
            } 
        }
    } 
}
</code></pre>
<p>ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸º</p>
<pre><code class="language-java">public class Candy6_2 {
    public Candy6_2() {
    }
    public static void choose(String str) {
        byte x = -1;
		switch(str.hashCode()) {
            case 2123: // hashCode å€¼å¯èƒ½ç›¸åŒï¼Œéœ€è¦è¿›ä¸€æ­¥ç”¨ equals æ¯”è¾ƒ
            if (str.equals(&quot;C.&quot;)){
                x = 1;
            } else if (str.equals(&quot;BM&quot;)) {
                x = 0;
            } default:
                switch(x) {
                    case 0:
                        System.out.println(&quot;h&quot;);
                        break;
                    case 1:
                        System.out.println(&quot;w&quot;);
                }
        }
    }
}
</code></pre>
<p><a name="UyRSa"></a></p>
<h2 id="switchæšä¸¾">switchæšä¸¾</h2>
<p>switchæšä¸¾çš„ä¾‹å­ï¼ŒåŸå§‹ä»£ç ï¼š</p>
<pre><code class="language-java">enum Sex {
    MALE, FEMALE
}
</code></pre>
<pre><code class="language-java">public class Candy7 {
    public static void foo(Sex sex) {
        switch (sex) {
            case MALE:
                System.out.println(&quot;ç”·&quot;); 
                break; 
            case FEMALE:
                System.out.println(&quot;å¥³&quot;); 
                break;
        }
    }
}
</code></pre>
<p>è½¬æ¢åä»£ç </p>
<pre><code class="language-java">public class Candy7 {
    /**
    * å®šä¹‰ä¸€ä¸ªåˆæˆç±»(ä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§)
    * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»
    * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹
    * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1 
    */
    static class $MAP {
        // æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­— 
        static int[] map = new int[2];
        static {
            map[Sex.MALE.ordinal()] = 1;
            map[Sex.FEMALE.ordinal()] = 2;
        }
    }
    
    public static void foo(Sex sex) {
        int x = $MAP.map[sex.ordinal()];
        switch (x) {
            case 1: 
                System.out.println(&quot;ç”·&quot;); 
                break;
            case 2:
                System.out.println(&quot;å¥³&quot;); 
                break;
        }
    }
}
</code></pre>
<p><a name="E7zMF"></a></p>
<h2 id="æšä¸¾ç±»">æšä¸¾ç±»</h2>
<p>JDK 7 æ–°å¢äº†æšä¸¾ç±»ï¼Œä»¥å‰é¢çš„æ€§åˆ«æšä¸¾ä¸ºä¾‹:</p>
<pre><code class="language-java">enum Sex {
    MALE, FEMALE
}
</code></pre>
<p>è½¬æ¢åä»£ç </p>
<pre><code class="language-java">public final class Sex extends Enum&lt;Sex&gt; {
    public static final Sex MALE;
    public static final Sex FEMALE;
    private static final Sex[] $VALUES;
    static {
        MALE = new Sex(&quot;MALE&quot;, 0);
        FEMALE = new Sex(&quot;FEMALE&quot;, 1);
        $VALUES = new Sex[]{MALE, FEMALE};
    }
    /**
     * Sole constructor.  Programmers cannot invoke this constructor.
     * It is for use by code emitted by the compiler in response to
     * enum type declarations.
     *
     * @param name    - The name of this enum constant, which is the identifier
     *                used to declare it.
     * @param ordinal - The ordinal of this enumeration constant (its position
     *                in the enum declaration, where the initial constant is assigned 
     */
    private Sex(String name, int ordinal) {
        super(name, ordinal);
    }
    public static Sex[] values() {
        return $VALUES.clone();
    }
    public static Sex valueOf(String name) {
        return Enum.valueOf(Sex.class, name);
    } 
}
</code></pre>
<p><a name="qwEYk"></a></p>
<h2 id="try-with-resources">try-with-resources</h2>
<p>JDK 7å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³•try-with-resources:</p>
<pre><code class="language-java">try(èµ„æºå˜é‡ = åˆ›å»ºèµ„æºå¯¹è±¡){ 
    
} catch( ) {
    
}
</code></pre>
<p>å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç°<code>AutoCloseable</code>æ¥å£ï¼Œä¾‹å¦‚<code>InputStreamã€OutStreamã€Connectionã€Statementã€ResultSet</code>ç­‰æ¥å£éƒ½å®ç°äº†<code>AutoCloseable</code>ä½¿ç”¨<code>try-with-resources</code>å¯ä»¥ä¸ç”¨å†™finallyè¯­æ³•å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç </p>
<pre><code class="language-java">public class Candy9 {
    public static void main(String[] args) {
        try(InputStream is = new FileInputStream(&quot;d:\\1.txt&quot;)) {
            System.out.println(is);
        } catch (IOException e) {
            e.printStackTrace();
        } 
    }
}
</code></pre>
<p>ä¼šè¢«è½¬æ¢ä¸º</p>
<pre><code class="language-java">public class Candy9 {
    public Candy9() {
    }
    public static void main(String[] args) {
        try {
            InputStream is = new FileInputStream(&quot;d:\\1.txt&quot;);
            Throwable t = null;
            try {
                System.out.println(is);
            } catch (Throwable e1) {
                // t æ˜¯æˆ‘ä»¬ä»£ç å‡ºç°çš„å¼‚å¸¸ 
                t = e1;
                throw e1;
            } finally {
                // åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º 
                if (is != null) {
                	// å¦‚æœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸ 
                    if (t != null) {
                        try {
                            is.close();
                        } catch (Throwable e2) {
                            // å¦‚æœ close å‡ºç°å¼‚å¸¸ï¼Œä½œä¸ºè¢«å‹åˆ¶å¼‚å¸¸æ·»åŠ  
                            t.addSuppressed(e2);
                        }
                    } else {
                        // å¦‚æœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºç°çš„å¼‚å¸¸å°±æ˜¯æœ€å catch å—ä¸­çš„ e
                        is.close();
                    }
                } 
            }
        } catch (IOException e) {
            e.printStackTrace();
        } 
    }
}
</code></pre>
<p>ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ª<code>addSuppressed(Throwable e)</code>(æ·»åŠ è¢«å‹åˆ¶å¼‚å¸¸)çš„æ–¹æ³•ï¼š</p>
<ul>
<li>æ˜¯ä¸ºäº†é˜²æ­¢å¼‚å¸¸ä¿¡æ¯çš„ä¸¢å¤±(æƒ³æƒ³ <code>try-with-resources</code> ç”Ÿæˆçš„ fianlly ä¸­å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸)</li>
</ul>
<pre><code class="language-java">public class Test6 {
    public static void main(String[] args) {
        try (MyResource resource = new MyResource()) {
            int i = 1/0;
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
class MyResource implements AutoCloseable {
    public void close() throws Exception {
        throw new Exception(&quot;close å¼‚å¸¸&quot;); 
    }
}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>java.lang.ArithmeticException: / by zero
at test.Test6.main(Test6.java:7) Suppressed: java.lang.Exception: close å¼‚å¸¸
        at test.MyResource.close(Test6.java:18)
        at test.Test6.main(Test6.java:6)
</code></pre>
<p>å¦‚ä»¥ä¸Šä»£ç æ‰€ç¤ºï¼Œä¸¤ä¸ªå¼‚å¸¸ä¿¡æ¯éƒ½ä¸ä¼šä¸¢å¤±<br>
<a name="uSvAb"></a></p>
<h2 id="æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•">æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•</h2>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ–¹æ³•é‡å†™æ—¶å¯¹è¿”å›å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>çˆ¶å­ç±»çš„è¿”å›å€¼å®Œå…¨ä¸€è‡´</li>
<li>å­ç±»è¿”å›å€¼å¯ä»¥æ˜¯å¤«ç±»è¿”å›å€¼çš„å­ç±»</li>
</ul>
<pre><code class="language-java">class A {
    public Number m() {
        return 1; 
    }
}

class B extends A {
    @Override
    // å­ç±» m æ–¹æ³•çš„è¿”å›å€¼æ˜¯ Integer æ˜¯çˆ¶ç±» m æ–¹æ³•è¿”å›å€¼ Number çš„å­ç±» 
    public Integer m() {
        return 2; 
    }
}
</code></pre>
<p>å¯¹äºå­ç±»ï¼Œjavaç¼–è¯‘å™¨ä¼šåšå¦‚ä¸‹å¤„ç†</p>
<pre><code class="language-java">class B extends A {
    public Integer m() {
        return 2; 
    }
    // æ­¤æ–¹æ³•æ‰æ˜¯çœŸæ­£é‡å†™äº†çˆ¶ç±» public Number m() æ–¹æ³• 
    public synthetic bridge Number m() {
        // è°ƒç”¨ public Integer m()
        return m(); 
    }
}
</code></pre>
<p>å…¶ä¸­æ¡¥æ¥æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œä»…å¯¹ java è™šæ‹Ÿæœºå¯è§ï¼Œå¹¶ä¸”ä¸åŸæ¥çš„ public Integer m() æ²¡æœ‰å‘½åå†²çªï¼Œå¯ä»¥ç”¨ä¸‹é¢åå°„ä»£ç æ¥éªŒè¯</p>
<pre><code class="language-java">for (Method m : B.class.getDeclaredMethods()) {
    System.out.println(m);
}
</code></pre>
<pre><code class="language-java">public java.lang.Integer test.candy.B.m()
public java.lang.Number test.candy.B.m()
</code></pre>
<p><a name="BB6iR"></a></p>
<h2 id="åŒ¿åå†…éƒ¨ç±»">åŒ¿åå†…éƒ¨ç±»</h2>
<pre><code class="language-java">public class Candy11 {
    public static void main(String[] args) {
        Runnable runnable = new Runnable() {
            @Override
            public void run() {
                System.out.println(&quot;ok&quot;);
            } 
        };
    } 
}
</code></pre>
<p>è½¬æ¢åçš„ä»£ç </p>
<pre><code class="language-java">// é¢å¤–ç”Ÿæˆçš„ç±»
final class Candy11$1 implements Runnable {
    Candy11$1() {
    }
    public void run() {
        System.out.println(&quot;ok&quot;);
    }
}

public class Candy11 {
    public static void main(String[] args) {
        Runnable runnable = new Candy11$1();
    }
}
</code></pre>
<p>å¼•ç”¨å±€éƒ¨å˜é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œæºä»£ç ï¼š</p>
<pre><code class="language-java">public class Candy11 {
    public static void test(final int x) {
        Runnable runnable = new Runnable() {
            @Override
            public void run() {
                System.out.println(&quot;ok:&quot; + x);
            } 
        };
    } 
}
</code></pre>
<p>è½¬æ¢åçš„ä»£ç </p>
<pre><code class="language-java">// é¢å¤–ç”Ÿæˆçš„ç±»
final class Candy11$1 implements Runnable {
    int val$x;
    Candy11$1(int x) {
        this.val$x = x;
    }
    public void run() {
        System.out.println(&quot;ok:&quot; + this.val$x);
    } 
}

public class Candy11 {
    public static void test(final int x) {
        Runnable runnable = new Candy11$1(x);
    }
} 
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
è¿™åŒæ—¶è§£é‡Šäº†ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»å¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œå±€éƒ¨å˜é‡å¿…é¡»æ˜¯ final çš„:å› ä¸ºåœ¨åˆ›å»º Candy11$1 å¯¹è±¡æ—¶ï¼Œå°† x çš„å€¼èµ‹å€¼ç»™äº† Candy11<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mi mathvariant="normal">å¯¹</mi><mi mathvariant="normal">è±¡</mi><mi mathvariant="normal">çš„</mi><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">1 å¯¹è±¡çš„ val</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord cjk_fallback">å¯¹</span><span class="mord cjk_fallback">è±¡</span><span class="mord cjk_fallback">çš„</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span>x å±æ€§ï¼Œæ‰€ä»¥ x ä¸åº”è¯¥å†å‘ç”Ÿå˜åŒ–äº†ï¼Œå¦‚æœå˜åŒ–ï¼Œé‚£ä¹ˆ val$x å±æ€§æ²¡æœ‰æœºä¼šå†è·Ÿç€ä¸€èµ·å˜åŒ–</p>
</blockquote>
<p><a name="qbnE6"></a></p>
<h1 id="ç±»åŠ è½½é˜¶æ®µ">ç±»åŠ è½½é˜¶æ®µ</h1>
<p><a name="LjtrV"></a></p>
<h2 id="åŠ è½½">åŠ è½½</h2>
<ul>
<li>å°†ç±»çš„å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒºä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ field æœ‰:
<ul>
<li>_java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´ éœ²ç»™ java ä½¿ç”¨</li>
<li>_super å³çˆ¶ç±»</li>
<li>_fields å³æˆå‘˜å˜é‡</li>
<li>_methods å³æ–¹æ³•</li>
<li>_constants å³å¸¸é‡æ± </li>
<li>_class_loader å³ç±»åŠ è½½å™¨</li>
<li>_vtable è™šæ–¹æ³•è¡¨</li>
<li>_itable æ¥å£æ–¹æ³•è¡¨</li>
</ul>
</li>
<li>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±»</li>
<li>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯äº¤æ›¿è¿è¡Œçš„</li>
</ul>
<blockquote>
<p>æ³¨æ„<br>
instanceKlassè¿™æ ·çš„ã€å…ƒæ•°æ®ã€‘æ˜¯å­˜å‚¨åœ¨æ–¹æ³•åŒº(1.8åçš„å…ƒç©ºé—´å†…)ï¼Œä½†_java_mirroræ˜¯å­˜å‚¨åœ¨å †ä¸­çš„<br>
å¯ä»¥é€šè¿‡HSDBå·¥å…·æ¥æŸ¥çœ‹</p>
</blockquote>
<figure data-type="image" tabindex="4"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645887896636-54eb1b6f-2abc-4a08-9b68-699d374b2b65-20220312195357603.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>Person.classæœ‰instanceKlassçš„åœ°å€ä¿¡æ¯ï¼Œ_java_mirrorä¸­æœ‰Person.classçš„åœ°å€ä¿¡æ¯</li>
<li>å¯¹è±¡å®ä¾‹åŒ–åï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡å¤´ï¼Œå…¶ä¸­åŒ…å«äº†classåœ°å€ï¼Œå¦‚æœæƒ³è·å–classä¿¡æ¯é‚£å°±ä¼šæ ¹æ®å¯¹è±¡å¤´ä¸­çš„classåœ°å€æ¥è·å–person.classå†é—´æ¥åˆ°å…ƒç©ºé—´æ‰¾åˆ°instanceKlassï¼Œä»å…ƒç©ºé—´ä¸­æ‰¾methodç­‰ä¿¡æ¯<br>
<a name="XqSCX"></a></li>
</ul>
<h2 id="é“¾æ¥">é“¾æ¥</h2>
<p><a name="Cf47b"></a></p>
<h3 id="éªŒè¯">éªŒè¯</h3>
<p>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆJVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥<br />ç”¨ UE ç­‰æ”¯æŒäºŒè¿›åˆ¶çš„ç¼–è¾‘å™¨ä¿®æ”¹ HelloWorld.class çš„é­”æ•°ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œ</p>
<pre><code>E:\git\jvm\out\production\jvm&gt;java cn.itcast.jvm.t5.HelloWorld
Error: A JNI error has occurred, please check your installation and try again
Exception in thread &quot;main&quot; java.lang.ClassFormatError: Incompatible magic value
3405691578 in class file cn/itcast/jvm/t5/HelloWorld
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)
				at java.security.AccessController.doPrivileged(Native Method)
				at java.net.URLClassLoader.findClass(URLClassLoader.java:361)
				at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
				at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
				at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
				at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:495)
</code></pre>
<p><a name="YNnzr"></a></p>
<h3 id="å‡†å¤‡">å‡†å¤‡</h3>
<ul>
<li>ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼
<ul>
<li>static å˜é‡åœ¨ JDK 7 ä¹‹å‰å­˜å‚¨äº instanceKlass æœ«å°¾ï¼Œä» JDK 7 å¼€å§‹ï¼Œå­˜å‚¨äº _java_mirror æœ«å°¾</li>
<li>static å˜é‡åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li>
<li>å¦‚æœ static å˜é‡æ˜¯ final çš„åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</li>
<li>å¦‚æœ static å˜é‡æ˜¯ final çš„ï¼Œä½†å±äºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ<br>
<a name="khjyD"></a></li>
</ul>
</li>
</ul>
<h3 id="è§£æ">è§£æ</h3>
<p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨(ç›´æ¥å¼•ç”¨å¯ä»¥çŸ¥é“åœ¨å†…å­˜ä¸­çš„ä½ç½®)</p>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;
/**
* è§£æçš„å«ä¹‰ */
public class Load2 {
    public static void main(String[] args) throws ClassNotFoundException,
IOException {
    	ClassLoader classloader = Load2.class.getClassLoader();
    	// loadClass æ–¹æ³•ä¸ä¼šå¯¼è‡´ç±»çš„è§£æå’Œåˆå§‹åŒ–
    	Class&lt;?&gt; c = classloader.loadClass(&quot;cn.itcast.jvm.t3.load.C&quot;);
    	
    	//ä¼šè¿›è¡Œç±»çš„è§£æå’Œåˆå§‹åŒ–
    	// new C();

    	System.in.read();
    }
}

class C {
    D d = new D();
}

class D { 

}
</code></pre>
<p><a name="WeYIm"></a></p>
<h2 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h2>
<p><cinit>()Væ–¹æ³•<br />åˆå§‹åŒ–å³è°ƒç”¨<code>&lt;cinit&gt;()Væ–¹æ³•</code>ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€‘çš„çº¿ç¨‹å®‰å…¨<br>
<a name="mn12B"></a></p>
<h3 id="å‘ç”Ÿçš„æ—¶æœº">å‘ç”Ÿçš„æ—¶æœº</h3>
<ul>
<li>æ¦‚æ‹¬å¾—è¯´ï¼Œç±»åˆå§‹åŒ–æ˜¯ã€æ‡’æƒ°çš„ã€‘
<ul>
<li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</li>
<li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç±»çš„åˆå§‹åŒ–</li>
<li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>Class.forName</li>
<li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li>
</ul>
</li>
<li>ä¸ä¼šå¯¼è‡´ç±»åˆå§‹åŒ–çš„æƒ…å†µ
<ul>
<li>è®¿é—®ç±»çš„ static final é™æ€å¸¸é‡(åŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²)ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li>
<li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li>
<li>åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li>
<li>ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</li>
<li>Class.forName çš„å‚æ•° 2 ä¸º false æ—¶<br>
<a name="peYbL"></a></li>
</ul>
</li>
</ul>
<h3 id="å®éªŒ">å®éªŒ</h3>
<pre><code class="language-java">class A {
    static int a = 0;
    static {
        System.out.println(&quot;a init&quot;);
    }
}
class B extends A {
    final static double b = 5.0;
    static boolean c = false;
    static {
        System.out.println(&quot;b init&quot;);
    }
}
</code></pre>
<p>éªŒè¯(å®éªŒæ—¶è¯·å…ˆå…¨éƒ¨æ³¨é‡Šï¼Œæ¯æ¬¡åªæ‰§è¡Œå…¶ä¸­ä¸€ä¸ª)</p>
<pre><code class="language-java">public class Load3 {
    static {
        System.out.println(&quot;main init&quot;);
    }
	public static void main(String[] args) throws ClassNotFoundException { 
        
        // 1. é™æ€å¸¸é‡(åŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²)ä¸ä¼šè§¦å‘åˆå§‹åŒ–
		System.out.println(B.b);
		// 2. ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–
		System.out.println(B.class);
		// 3. åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–
		System.out.println(new B[0]);
		// 4. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A
		ClassLoader cl = Thread.currentThread().getContextClassLoader();
        cl.loadClass(&quot;cn.itcast.jvm.t3.B&quot;);
		// 5. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A
		ClassLoader c2 = Thread.currentThread().getContextClassLoader(); 
        Class.forName(&quot;cn.itcast.jvm.t3.B&quot;, false, c2);
		// 1. é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶ 
        System.out.println(A.a);
		// 2. å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘ 
        System.out.println(B.c);
		// 3. å­ç±»è®¿é—®çˆ¶ç±»é™æ€å˜é‡ï¼Œåªè§¦å‘çˆ¶ç±»åˆå§‹åŒ– 
        System.out.println(B.a);
		// 4. ä¼šåˆå§‹åŒ–ç±» Bï¼Œå¹¶å…ˆåˆå§‹åŒ–ç±» A 
        Class.forName(&quot;cn.itcast.jvm.t3.B&quot;);
    }
}
</code></pre>
<p><a name="AmR2B"></a></p>
<h2 id="ç»ƒä¹ -2">ç»ƒä¹ </h2>
<p>ä»å­—èŠ‚ç åˆ†æï¼Œä½¿ç”¨aï¼Œbï¼Œcè¿™ä¸‰ä¸ªå¸¸é‡æ˜¯å¦ä¼šå¯¼è‡´Eåˆå§‹åŒ–</p>
<pre><code class="language-java">public class Load4 {
    public static void main(String[] args) {
        System.out.println(E.a);
        System.out.println(E.b);
        System.out.println(E.c);
    } 
}
class E {
    //ä¸ä¼š
    public static final int a = 10;
    //ä¸ä¼š
    public static final String b = &quot;hello&quot;;
    //ä¼š
    //Integer.valueOf(20)
    public static final Integer c = 20;
}
</code></pre>
<p>å…¸å‹åº”ç”¨-å®Œæˆæ‡’æƒ°åˆå§‹åŒ–å•ä¾‹æ¨¡å¼</p>
<pre><code class="language-java">public final class Singleton { 
    private Singleton() { }
    // å†…éƒ¨ç±»ä¸­ä¿å­˜å•ä¾‹
    private static class LazyHolder {
        static final Singleton INSTANCE = new Singleton();
    }
    //å¦‚æœåªè°ƒç”¨å¤–éƒ¨ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œä¼šå¯¼è‡´å¤–éƒ¨ç±»çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸ä¼šå¯¼è‡´å†…éƒ¨ç±»çš„åˆå§‹åŒ–
	// ç¬¬ä¸€æ¬¡è°ƒç”¨ getInstance æ–¹æ³•ï¼Œæ‰ä¼šå¯¼è‡´å†…éƒ¨ç±»åŠ è½½å’Œåˆå§‹åŒ–å…¶é™æ€æˆå‘˜ 
    public static Singleton getInstance() {
        return LazyHolder.INSTANCE;
    }
}
</code></pre>
<p>ä»¥ä¸Šçš„å®ç°ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ‡’æƒ°å®ä¾‹åŒ–</li>
<li>åˆå§‹åŒ–æ—¶çš„çº¿ç¨‹å®‰å…¨æ˜¯æœ‰ä¿éšœçš„<br>
<a name="mG2G8"></a></li>
</ul>
<h1 id="ç±»åŠ è½½å™¨">ç±»åŠ è½½å™¨</h1>
<p>ä»¥JDK8ä¸ºä¾‹ï¼š</p>
<ul>
<li>ç±»åŠ è½½å™¨å„è‡ªåŠ è½½å¯¹åº”ä½ç½®çš„ç±»</li>
<li>æœ‰å±‚çº§å…³ç³»ï¼Œä½çº§åŠ è½½å™¨åŠ è½½ç±»æ—¶ä¼šé—®ä¸Šçº§åŠ è½½å™¨æ˜¯å¦åŠ è½½è¿‡è¯¥ç±»(ä¾‹å¦‚ï¼ŒApplication ClassLoaderè¯¢é—®Extension ClassLoaderæ˜¯å¦åŠ è½½ï¼Œç„¶åExtension ClassLoader è¯¢é—® Bootstrap ClassLoader)</li>
<li>å¦‚æœä¸Šçº§å‡æœªåŠ è½½ï¼Œé‚£ä¹ˆæ‰è®©ä½çº§åŠ è½½å™¨åŠ è½½è¯¥ç±»</li>
<li>è¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å‹</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645957908084-4f81f0be-a643-4df7-a3e8-bd1f81c40030-20220312195357653.png" alt="image.png" loading="lazy"><br>
<a name="XA4xA"></a></p>
<h2 id="å¯åŠ¨ç±»åŠ è½½å™¨bootstrap-classloader">å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)</h2>
<p>ç”¨Bootstrapç±»åŠ è½½å™¨åŠ è½½ç±»</p>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;
public class F {
    static {
        System.out.println(&quot;bootstrap F init&quot;);
    }
}
</code></pre>
<p>æ‰§è¡Œ</p>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;
public class Load5_1 {
    public static void main(String[] args) throws ClassNotFoundException {
        Class&lt;?&gt; aClass = Class.forName(&quot;cn.itcast.jvm.t3.load.F&quot;);
        //è·å–åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨
        System.out.println(aClass.getClassLoader());
    } 
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code>E:\git\jvm\out\production\jvm&gt;java -Xbootclasspath/a:. cn.itcast.jvm.t3.load.Load5
bootstrap F init
null
</code></pre>
<ul>
<li>-Xbootclasspathè¡¨ç¤ºè®¾ç½®bootclasspath</li>
<li>å…¶ä¸­/a:.è¡¨ç¤ºå°†å½“å‰ç›®å½•è¿½åŠ è‡³bootclasspathä¹‹å</li>
<li>å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•æ›¿æ¢æ ¸å¿ƒç±»
<ul>
<li><code>java -Xbootclasspath:&lt;new bootclasspath&gt;</code></li>
<li><code>java -Xbootclasspath/a:&lt;è¿½åŠ è·¯å¾„&gt;</code> /aä¸ºåè¿½åŠ </li>
<li><code>java -Xbootclasspath/p:&lt;è¿½åŠ è·¯å¾„&gt;</code> /pä¸ºå‰è¿½åŠ ï¼Œå¯ä»¥ç”¨æ¥æ›¿æ¢ä¸€äº›æ ¸å¿ƒç±»<br>
<a name="VlKvq"></a></li>
</ul>
</li>
</ul>
<h2 id="æ‰©å±•ç±»åŠ è½½å™¨">æ‰©å±•ç±»åŠ è½½å™¨</h2>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;
public class G {
    static {
        System.out.println(&quot;classpath G init&quot;);
    }
}
</code></pre>
<p>æ‰§è¡Œ</p>
<pre><code class="language-java">public class Load5_2 {
    public static void main(String[] args) throws ClassNotFoundException {
        Class&lt;?&gt; aClass = Class.forName(&quot;cn.itcast.jvm.t3.load.G&quot;);
        System.out.println(aClass.getClassLoader());
    }
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code>classpath G init
sun.misc.Launcher$AppClassLoader@18b4aac2
</code></pre>
<p>å†™ä¸€ä¸ªåŒåçš„ç±»</p>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;
public class G {
    static {
        System.out.println(&quot;ext G init&quot;);
    }
}
</code></pre>
<p>æ‰“ä¸ªjaråŒ…</p>
<pre><code>E:\git\jvm\out\production\jvm&gt;jar -cvf my.jar cn/itcast/jvm/t3/load/G.class
å·²æ·»åŠ æ¸…å•
æ­£åœ¨æ·»åŠ : cn/itcast/jvm/t3/load/G.class(è¾“å…¥ = 481) (è¾“å‡º = 322)(å‹ç¼©äº† 33%)
</code></pre>
<p>å°†jaråŒ…æ‹·è´åˆ° JAVA_HOME/jre/lib/ext<br />é‡æ–°æ‰§è¡ŒLoad5_2<br />è¾“å‡º</p>
<pre><code>ext G init
sun.misc.Launcher$ExtClassLoader@29453f44
</code></pre>
<p><a name="d6tvW"></a></p>
<h2 id="åŒäº²å§”æ´¾æ¨¡å‹">åŒäº²å§”æ´¾æ¨¡å‹</h2>
<p>æ‰€è°“çš„åŒäº²å§”æ´¾ï¼Œå°±æ˜¯æŒ‡è°ƒç”¨ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</p>
<ul>
<li>å§”æ´¾ä¸Šçº§åšç±»çš„åŠ è½½</li>
<li>å¦‚æœä¸Šçº§æ²¡æœ‰ï¼Œé‚£ä¹ˆç”±æœ¬çº§çš„ç±»åŠ è½½å™¨åŠ è½½</li>
</ul>
<blockquote>
<p>æ³¨æ„<br>
è¿™é‡Œçš„åŒäº²ï¼Œç¿»è¯‘ä¸ºä¸Šçº§ä¼¼ä¹æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºå®ƒä»¬å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»</p>
</blockquote>
<pre><code class="language-java">protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException {
    synchronized (getClassLoadingLock(name)) { 
        // 1. æ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½
        Class&lt;?&gt; c = findLoadedClass(name);
        if (c == null) {
            long t0 = System.nanoTime();
            try {
                if (parent != null) {
                    // 2. æœ‰ä¸Šçº§çš„è¯ï¼Œå§”æ´¾ä¸Šçº§ 
                    loadClass c = parent.loadClass(name, false);
                } else {
                    // 3. å¦‚æœæ²¡æœ‰ä¸Šçº§äº†(ExtClassLoader)ï¼Œåˆ™å§”æ´¾BootstrapClassLoader
                    c = findBootstrapClassOrNull(name);
                }
            } catch (ClassNotFoundException e) {
            }
            if (c == null) {
                long t1 = System.nanoTime();
                // 4. æ¯ä¸€å±‚æ‰¾ä¸åˆ°ï¼Œè°ƒç”¨ findClass æ–¹æ³•(æ¯ä¸ªç±»åŠ è½½å™¨è‡ªå·±æ‰©å±•)æ¥åŠ è½½ 
                c = findClass(name);
                // 5. è®°å½•è€—æ—¶ 
                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); 
                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); 
                sun.misc.PerfCounter.getFindClasses().increment();
            } 
        }
        if (resolve) {
            resolveClass(c);
        }
        return c; 
    }
}
</code></pre>
<p>ä¾‹å¦‚</p>
<pre><code class="language-java">public class Load5_3 {
    public static void main(String[] args) throws ClassNotFoundException {
        Class&lt;?&gt; aClass = Load5_3.class.getClassLoader()
            .loadClass(&quot;cn.itcast.jvm.t3.load.H&quot;);
        System.out.println(aClass.getClassLoader());
    } 
}
</code></pre>
<p>æ‰§è¡Œæµç¨‹ä¸º</p>
<pre><code>1. sun.misc.Launcher$AppClassLoader //1 å¤„ï¼Œ å¼€å§‹æŸ¥çœ‹å·²åŠ è½½çš„ç±»ï¼Œç»“æœæ²¡æœ‰
2. sun.misc.Launcher$AppClassLoader // 2 å¤„ï¼Œå§”æ´¾ä¸Šçº§
   sun.misc.Launcher$ExtClassLoader.loadClass()
3. sun.misc.Launcher$ExtClassLoader // 1 å¤„ï¼ŒæŸ¥çœ‹å·²åŠ è½½çš„ç±»ï¼Œç»“æœæ²¡æœ‰
4. sun.misc.Launcher$ExtClassLoader // 3 å¤„ï¼Œæ²¡æœ‰ä¸Šçº§äº†ï¼Œåˆ™å§”æ´¾ BootstrapClassLoaderæŸ¥æ‰¾
5. BootstrapClassLoader æ˜¯åœ¨ JAVA_HOME/jre/lib ä¸‹æ‰¾ H è¿™ä¸ªç±»ï¼Œæ˜¾ç„¶æ²¡æœ‰
6. sun.misc.Launcher$ExtClassLoader // 4 å¤„ï¼Œè°ƒç”¨è‡ªå·±çš„ findClass æ–¹æ³•ï¼Œæ˜¯åœ¨
	 JAVA_HOME/jre/lib/ext ä¸‹æ‰¾ H è¿™ä¸ªç±»ï¼Œæ˜¾ç„¶æ²¡æœ‰ï¼Œå›åˆ° sun.misc.Launcher$AppClassLoader
	 çš„ // 2 å¤„
7. ç»§ç»­æ‰§è¡Œåˆ° sun.misc.Launcher$AppClassLoader // 4 å¤„ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„ findClass æ–¹æ³•ï¼Œåœ¨
	 classpath ä¸‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†
</code></pre>
<p><a name="MfxPE"></a></p>
<h2 id="çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨">çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</h2>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨JDBCæ—¶ï¼Œéƒ½éœ€è¦åŠ è½½Driveré©±åŠ¨ï¼Œä½†æ˜¯ï¼Œä¸å†™</p>
<pre><code class="language-java">Class.forName(&quot;com.mysql.jdbc.Driver&quot;)
</code></pre>
<p>ä¹Ÿæ˜¯å¯ä»¥è®©<code>com.mysql.jdbc.Driver</code>æ­£ç¡®åŠ è½½çš„</p>
<pre><code class="language-java">public class DriverManager {
// æ³¨å†Œé©±åŠ¨çš„é›†åˆ
private final static CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers
        = new CopyOnWriteArrayList&lt;&gt;();
	// åˆå§‹åŒ–é©±åŠ¨ 
    static {
        loadInitialDrivers();
        println(&quot;JDBC DriverManager initialized&quot;);
    }
</code></pre>
<p>å…ˆä¸çœ‹åˆ«çš„ï¼Œçœ‹çœ‹DriverManagerçš„ç±»åŠ è½½å™¨</p>
<pre><code class="language-java">System.out.println(DriverManager.class.getClassLoader());
</code></pre>
<p>æ‰“å° nullï¼Œè¡¨ç¤ºå®ƒçš„ç±»åŠ è½½å™¨æ˜¯ Bootstrap ClassLoaderï¼Œä¼šåˆ° JAVA_HOME/jre/lib ä¸‹æœç´¢ç±»ï¼Œä½† JAVA_HOME/jre/lib ä¸‹æ˜¾ç„¶æ²¡æœ‰ mysql-connector-java-5.1.47.jar åŒ…ï¼Œè¿™æ ·é—®é¢˜æ¥äº†ï¼Œåœ¨ DriverManager çš„é™æ€ä»£ç å—ä¸­ï¼Œæ€ä¹ˆèƒ½æ­£ç¡®åŠ è½½ com.mysql.jdbc.Driver å‘¢?<br />ç»§ç»­çœ‹loadInitialDrivers()æ–¹æ³•</p>
<pre><code class="language-java">private static void loadInitialDrivers() {
    String drivers;
    try {
        drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;(){
            public String run() {
                return System.getProperty(&quot;jdbc.drivers&quot;);
            }
        });
    } catch (Exception ex) {
        drivers = null;
    }
    // 1)ä½¿ç”¨ ServiceLoader æœºåˆ¶åŠ è½½é©±åŠ¨ï¼Œå³ SPI 
    AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
        public Void run() {
            ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class);
            Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator();
            try{
                while(driversIterator.hasNext()) {
                    //ä¹Ÿç ´åäº†åŒäº²å§”æ´¾æ¨¡å‹
                    driversIterator.next();
                }
            } catch(Throwable t) {
                // Do nothing
            }
            return null;
        }
    });
    println(&quot;DriverManager.initialize: jdbc.drivers = &quot; + drivers);
    // 2)ä½¿ç”¨ jdbc.drivers å®šä¹‰çš„é©±åŠ¨ååŠ è½½é©±åŠ¨
    if (drivers == null || drivers.equals(&quot;&quot;)) {
        return; 
    }
    String[] driversList = drivers.split(&quot;:&quot;);
    println(&quot;number of Drivers:&quot; + driversList.length);
    for (String aDriver : driversList) {
        try {
            println(&quot;DriverManager.Initialize: loading &quot; + aDriver);
            // è¿™é‡Œçš„ ClassLoader.getSystemClassLoader() å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ 
            Class.forName(aDriver, true, ClassLoader.getSystemClassLoader());
        } catch (Exception ex) {
            println(&quot;DriverManager.Initialize: load failed: &quot; + ex);
        } 
    } 
}
</code></pre>
<ul>
<li>å…ˆçœ‹ 2)å‘ç°å®ƒæœ€åæ˜¯ä½¿ç”¨ Class.forName å®Œæˆç±»çš„åŠ è½½å’Œåˆå§‹åŒ–ï¼Œå…³è”çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå› æ­¤ å¯ä»¥é¡ºåˆ©å®Œæˆç±»åŠ è½½ï¼Œæ‰“ç ´äº†åŒäº²å§”æ´¾æ¨¡å‹</li>
<li>å†çœ‹ 1)å®ƒå°±æ˜¯å¤§åé¼é¼çš„ Service Provider Interface (SPI) çº¦å®šå¦‚ä¸‹ï¼Œåœ¨ jar åŒ…çš„ META-INF/services åŒ…ä¸‹ï¼Œä»¥æ¥å£å…¨é™å®šåä¸ºæ–‡ä»¶åï¼Œæ–‡ä»¶å†…å®¹æ˜¯å®ç°ç±»åç§°</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645962350246-d25040bf-1b06-4517-9270-0a555a778d88-20220312195357777.png" alt="image.png" loading="lazy"><br />è¿™æ ·å°±å¯ä»¥ä½¿ç”¨</p>
<pre><code class="language-java">//æ‰¾åˆ°æ¥å£çš„æ‰€æœ‰å®ç°ç±»
ServiceLoader&lt;æ¥å£ç±»å‹&gt; allImpls = ServiceLoader.load(æ¥å£ç±»å‹.class); 
Iterator&lt;æ¥å£ç±»å‹&gt; iter = allImpls.iterator();
while(iter.hasNext()) {
    //æ¯æ¬¡è°ƒç”¨äº†è¿­ä»£å™¨ï¼Œå°±å¯ä»¥è¿”å›å®ç°ç±»çš„å®ä¾‹
    iter.next();
}
</code></pre>
<p>æ¥å¾—åˆ°å®ç°ç±»ï¼Œä½“ç°çš„æ˜¯ã€é¢å‘æ¥å£ç¼–ç¨‹+è§£è€¦ã€‘çš„æ€æƒ³ï¼Œåœ¨ä¸‹é¢ä¸€äº›æ¡†æ¶ä¸­éƒ½è¿ç”¨äº†æ­¤æ€æƒ³:</p>
<ul>
<li>JDBC</li>
<li>Servlet åˆå§‹åŒ–å™¨</li>
<li>Spring å®¹å™¨</li>
<li>Dubbo(å¯¹ SPI è¿›è¡Œäº†æ‰©å±•)</li>
</ul>
<p>æ¥ç€çœ‹ ServiceLoader.load æ–¹æ³•:</p>
<pre><code class="language-java">public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) {
	// è·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨(é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)
    // åœ¨çº¿ç¨‹å¯åŠ¨æ—¶ï¼Œjvmä¼šæŠŠåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å¤åˆ¶ç»™å½“å‰çº¿ç¨‹
	ClassLoader cl = Thread.currentThread().getContextClassLoader(); 
    return ServiceLoader.load(service, cl);
}
</code></pre>
<p>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å½“å‰çº¿ç¨‹ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œé»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå®ƒå†…éƒ¨åˆæ˜¯ç”± Class.forName è°ƒç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½ï¼Œå…·ä½“ä»£ç åœ¨ ServiceLoader çš„å†…éƒ¨ç±» LazyIterator ä¸­:</p>
<pre><code class="language-java">private S nextService() {
    if (!hasNextService())
        throw new NoSuchElementException();
    String cn = nextName;
    nextName = null;
    Class&lt;?&gt; c = null;
    try {
        c = Class.forName(cn, false, loader);
    } catch (ClassNotFoundException x) {&quot;Provider &quot; + cn + &quot; not found&quot;);
    }
    if (!service.isAssignableFrom(c)) {
        fail(service, 
             &quot;Provider &quot; + cn  + &quot; not a subtype&quot;);
    } try {
        S p = service.cast(c.newInstance());
        providers.put(cn, p);
        return p;
    } catch (Throwable x) {
        fail(service,
             &quot;Provider &quot; + cn + &quot; could not be instantiated&quot;,
             x);
    }
    throw new Error();          // This cannot happen
}
</code></pre>
<p><a name="Ym5It"></a></p>
<h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h2>
<p>ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨</p>
<ol>
<li>æƒ³åŠ è½½éclasspathéšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶</li>
<li>éƒ½æ˜¯é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡</li>
<li>è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äºtomcatå®¹å™¨</li>
</ol>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>ç»§æ‰¿ ClassLoader çˆ¶ç±»</li>
<li>è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ findClass æ–¹æ³•
<ol>
<li>æ³¨æ„ä¸æ˜¯é‡å†™ loadClass æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶</li>
</ol>
</li>
<li>è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç </li>
<li>è°ƒç”¨çˆ¶ç±»çš„ defineClass æ–¹æ³•æ¥åŠ è½½ç±»</li>
<li>ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</li>
</ol>
<p>ç¤ºä¾‹: <br />å‡†å¤‡å¥½ä¸¤ä¸ªç±»æ–‡ä»¶æ”¾å…¥ E:\myclasspathï¼Œå®ƒå®ç°äº† java.util.Map æ¥å£ï¼Œå¯ä»¥å…ˆåç¼–è¯‘çœ‹ä¸€ä¸‹:<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645969043336-fdc5d884-e9c1-4eeb-9a8c-fb0b0db0094e-20220312195358048.png" alt="image.png" loading="lazy"></p>
<pre><code class="language-java">package cn.itcast.jvm.t3.load;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

public class Load7 {
    public static void main(String[] args) throws Exception {
        MyClassLoader classLoader = new MyClassLoader();
        Class&lt;?&gt; c1 = classLoader.loadClass(&quot;MapImpl1&quot;);
        Class&lt;?&gt; c2 = classLoader.loadClass(&quot;MapImpl1&quot;);
        
        //true
        System.out.println(c1 == c2);

        MyClassLoader classLoader2 = new MyClassLoader();
        Class&lt;?&gt; c3 = classLoader2.loadClass(&quot;MapImpl1&quot;);
        
        //falseï¼ŒåŒ…åç±»åç›¸åŒï¼Œä¸”ç±»åŠ è½½å™¨å¯¹è±¡ç›¸åŒï¼Œæ‰è®¤ä¸ºè¿™æ˜¯åŒä¸€ä¸ªç±»ï¼Œä¸ç„¶è®¤ä¸ºæ˜¯ç›¸äº’éš”ç¦»çš„
        System.out.println(c1 == c3);

        c1.newInstance();
    }
}

//ç»§æ‰¿ClassLoaderå¹¶é‡å†™findClassæ–¹æ³•
class MyClassLoader extends ClassLoader {

    @Override // name å°±æ˜¯ç±»åç§°
    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException {
        String path = &quot;e:\\myclasspath\\&quot; + name + &quot;.class&quot;;

        try {
            ByteArrayOutputStream os = new ByteArrayOutputStream();
            Files.copy(Paths.get(path), os);

            // å¾—åˆ°å­—èŠ‚æ•°ç»„
            byte[] bytes = os.toByteArray();

            // byte[] -&gt; *.class
            return defineClass(name, bytes, 0, bytes.length);

        } catch (IOException e) {
            e.printStackTrace();
            throw new ClassNotFoundException(&quot;ç±»æ–‡ä»¶æœªæ‰¾åˆ°&quot;, e);
        }
    }
}

</code></pre>
<p><a name="W2Wqr"></a></p>
<h1 id="è¿è¡ŒæœŸä¼˜åŒ–">è¿è¡ŒæœŸä¼˜åŒ–</h1>
<p><a name="RyZ3t"></a></p>
<h2 id="å³æ—¶ç¼–è¯‘">å³æ—¶ç¼–è¯‘</h2>
<p><a name="Nflf0"></a></p>
<h3 id="åˆ†å±‚ç¼–è¯‘tieredcompilation">åˆ†å±‚ç¼–è¯‘(TieredCompilation)</h3>
<pre><code class="language-java">public class JIT1 {
    public static void main(String[] args) {
        for (int i = 0; i &lt; 200; i++) {
            long start = System.nanoTime();
            for (int j = 0; j &lt; 1000; j++) {
                new Object();
            }
            long end = System.nanoTime();
            System.out.printf(&quot;%d\t%d\n&quot;,i,(end - start));
        }
    }
}
</code></pre>
<pre><code>0   96426
1   52907
2   44800
3   119040
4   65280
5   47360
6   45226
7   47786
8   48640
9   60586
10  42667
11  48640
12  70400
13  49920
14  49493
15  45227
16  45653
17  60160
18  58880
19  46080
20  47787
21  49920
22  54187
23  57173
24  50346
25  52906
26  50346
27  47786
28  49920
29  64000
30  49067
31  63574
32  63147
33  56746
34  49494
35  64853
36  107520
37  46933
38  51627
39  45653
40  103680
41  51626
42  60160
43  49067
44  45653
45  49493
46  51626
47  49066
48  47360
49  50774
50  70827
51  64000
52  72107
53  49066
54  46080
55  44800
56  46507
57  73813
58  61013
59  57600
60  83200
61  7024204
62  49493
63  20907
64  20907
65  20053
66  20906
67  20907
68  21333
69  22187
70  20480
71  21760
72  19200
73  15360
74  18347
75  19627
76  17067
77  34134
78  19200
79  18347
80  17493
81  15360
82  18774
83  17067
84  21760
85  23467
86  17920
87  17920
88  18774
89  18773
90  19200
91  20053
92  18347
93  22187
94  17920
95  18774
96  19626
97  33280
98  20480
99  20480
100 18773
101 47786
102 17493
103 22614
104 64427
105 18347
106 19200
107 26027
108 21333
109 20480
110 24747
111 32426
112 21333
113 17920
114 17920
115 19200
116 18346
117 15360
118 24320
119 19200
120 20053
121 17920
122 18773
123 20053
124 18347
125 18347
126 22613
127 18773
128 19627
129 20053
130 20480
131 19627
132 20053
133 15360
134 136533
135 43093
136 853
137 853
138 853
139 853
140 854
141 853
142 853
143 853
144 853
145 853
146 853
147 854
148 853
149 853
150 854
151 853
152 853
153 853
154 1280
155 853
156 853
157 854
158 853
159 853
160 854
161 854
162 853
163 854
164 854
165 854
166 854
167 853
168 853
169 854
170 853
171 853
172 853
173 1280
174 853
175 1280
176 853
177 854
178 854
179 427
180 853
181 854
182 854
183 854
184 853
185 853
186 854
187 853
188 853
189 854
190 1280
191 853
192 853
193 853
194 853
195 854
196 853
197 853
198 853
199 854
</code></pre>
<p>åŸå› æ˜¯ä»€ä¹ˆå‘¢?<br />JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡:</p>
<ul>
<li>0 å±‚ï¼Œè§£é‡Šæ‰§è¡Œ(Interpreter)
<ul>
<li>å­—èŠ‚ç åŠ è½½åˆ°è™šæ‹Ÿæœºï¼Œè§£é‡Šå™¨å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç </li>
<li>å­—èŠ‚ç è¢«åå¤è°ƒç”¨ï¼Œåˆ°è¾¾ä¸€å®šé˜ˆå€¼ï¼Œå°±ä¼šå¯ç”¨ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ‰§è¡Œ</li>
</ul>
</li>
<li>1 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ(ä¸å¸¦ profiling)</li>
<li>2 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ(å¸¦åŸºæœ¬çš„ profiling)</li>
<li>3 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ(å¸¦å®Œå…¨çš„ profiling)</li>
<li>4 å±‚ï¼Œä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ
<ul>
<li>æ¯”C1ä¼˜åŒ–ç¨‹åº¦æ›´é«˜</li>
</ul>
</li>
</ul>
<blockquote>
<p>profiling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„ å›è¾¹æ¬¡æ•°ã€‘ç­‰</p>
</blockquote>
<p>å³æ—¶ç¼–è¯‘å™¨(JIT)ä¸è§£é‡Šå™¨çš„åŒºåˆ«</p>
<ul>
<li>è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š</li>
<li>JIT æ˜¯å°†ä¸€äº›å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜å…¥ Code Cacheï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘</li>
<li>è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç </li>
<li>JIT ä¼šæ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç </li>
</ul>
<p>å¯¹äºå æ®å¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿ è¡Œ;å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1(æå‡5å€å·¦å³é«˜) &lt; C2(æå‡10-100å€)ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç (hotspotåç§°çš„ç”±æ¥)ï¼Œå¹¶ä¼˜åŒ–ä¹‹</p>
<p>åˆšæ‰çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µç§°ä¹‹ä¸ºã€é€ƒé€¸åˆ†æã€‘ï¼Œå‘ç°æ–°å»ºçš„å¯¹è±¡æ˜¯å¦é€ƒé€¸(å¤–å±‚æ˜¯å¦ä¼šç”¨åˆ°è¯¥å¯¹è±¡)ã€‚å¯ä»¥ä½¿ç”¨ -XX:- DoEscapeAnalysis å…³é—­é€ƒé€¸åˆ†æï¼Œå†è¿è¡Œåˆšæ‰çš„ç¤ºä¾‹è§‚å¯Ÿç»“æœ</p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://docs.oracle.com/en/java/javase/12/vm/java-hotspot-virtual-machine-performance-enhancements.html#GUID-D2E3DC58-D18B-4A6C-8167-4A1DFB4888E4">https://docs.oracle.com/en/java/javase/12/vm/java-hotspot-virtual-machine-performance-enhancements.html#GUID-D2E3DC58-D18B-4A6C-8167-4A1DFB4888E4</a></p>
<p><a name="D6YlW"></a></p>
<h3 id="æ–¹æ³•å†…è”inlining">æ–¹æ³•å†…è”(Inlining)</h3>
<pre><code class="language-java">private static int square(final int i) {
    return i * i;
}
</code></pre>
<pre><code class="language-java">System.out.println(square(9));
</code></pre>
<p>å¦‚æœå‘ç° square æ˜¯çƒ­ç‚¹æ–¹æ³•ï¼Œå¹¶ä¸”é•¿åº¦ä¸å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡Œå†…è”ï¼Œæ‰€è°“çš„å†…è”å°±æ˜¯æŠŠæ–¹æ³•å†…ä»£ç æ‹·è´ã€ ç²˜è´´åˆ°è°ƒç”¨è€…çš„ä½ç½®:</p>
<pre><code class="language-java">//System.out.println(square(9))è¿›è¡Œæ–¹æ³•å†…è”å
//å˜ä¸º
System.out.println(9 * 9);
</code></pre>
<p>è¿˜èƒ½å¤Ÿè¿›è¡Œå¸¸é‡æŠ˜å (constant folding)çš„ä¼˜åŒ–</p>
<pre><code class="language-java">//9å›ºå®šä¸å˜ï¼Œå¯ä»¥è¿›è¡Œå¸¸é‡æŠ˜å çš„ä¼˜åŒ–
System.out.println(81);
</code></pre>
<p>å®éªŒï¼š</p>
<pre><code class="language-java">public class JIT2 {
    // -XX:+UnlockDiagnosticVMOptions -XX:+PrintInlining (è§£é”éšè—å‚æ•°)æ‰“å°inlining ä¿¡æ¯
    // -XX:CompileCommand=dontinline,*JIT2.square ç¦æ­¢æŸä¸ªæ–¹æ³• inlining *è¡¨ç¤ºæŠ¥åï¼ŒJIT2ä¸ºç±»åç„¶åä¸ºæ–¹æ³•å
    // -XX:+PrintCompilation æ‰“å°ç¼–è¯‘ä¿¡æ¯
    public static void main(String[] args) {
        int x = 0;
        for (int i = 0; i &lt; 500; i++) {
            long start = System.nanoTime();
            for (int j = 0; j &lt; 1000; j++) {
                x = square(9);
            }
        	long end = System.nanoTime();
        	System.out.printf(&quot;%d\t%d\t%d\n&quot;,i,x,(end - start));
    	}
	}
    private static int square(final int i) {
        return i * i;
    } 
}
</code></pre>
<p><a name="y6x4j"></a></p>
<h3 id="å­—æ®µä¼˜åŒ–">å­—æ®µä¼˜åŒ–</h3>
<p>å­—æ®µä¼˜åŒ–ä¸ºå¯¹æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡è¿›è¡Œä¼˜åŒ–<br />JMHåŸºå‡†æµ‹è¯•è¯·å‚è€ƒ<a href="http://openjdk.java.net/projects/code-tools/jmh/">http://openjdk.java.net/projects/code-tools/jmh/</a><br />åˆ›å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ ä¾èµ–å¦‚ä¸‹</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
    &lt;artifactId&gt;jmh-core&lt;/artifactId&gt;
    &lt;version&gt;${jmh.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
    &lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt;
    &lt;version&gt;${jmh.version}&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>ç¼–å†™åŸºå‡†æµ‹è¯•ä»£ç </p>
<pre><code class="language-java">package test;
import org.openjdk.jmh.annotations.*;
import org.openjdk.jmh.runner.Runner;
import org.openjdk.jmh.runner.RunnerException;
import org.openjdk.jmh.runner.options.Options;
import org.openjdk.jmh.runner.options.OptionsBuilder;
import java.util.Random;
import java.util.concurrent.ThreadLocalRandom;
// çƒ­èº«ï¼Œè®©ç¨‹åºé¢„çƒ­ä¸€æ®µæ—¶é—´ï¼Œè®©JITå¯¹å…¶è¿›è¡Œå……åˆ†çš„ä¼˜åŒ–
@Warmup(iterations = 2, time = 1)
// è¿›è¡Œå‡ è½®æµ‹è¯•
@Measurement(iterations = 5, time = 1)
@State(Scope.Benchmark)
public class Benchmark1 {
    int[] elements = randomInts(1_000);
    private static int[] randomInts(int size) {
        Random random = ThreadLocalRandom.current();
        int[] values = new int[size];
        for (int i = 0; i &lt; size; i++) {
            values[i] = random.nextInt();
        }
        return values;
    }
    
	@Benchmark
    public void test1() {
        for (int i = 0; i &lt; elements.length; i++) {
            doSum(elements[i]);
        }
	}
    
	@Benchmark
    public void test2() {
        int[] local = this.elements;
        for (int i = 0; i &lt; local.length; i++) {
            doSum(local[i]);
        }
	}
    
	@Benchmark
    public void test3() {
        for (int element : elements) {
            doSum(element);
        }
    }
    
    static int sum = 0;
    
    // æ§åˆ¶æ˜¯å¦è¿›è¡Œå†…è”
    @CompilerControl(CompilerControl.Mode.INLINE)
    static void doSum(int x) {
        sum += x; 
    }
    
    public static void main(String[] args) throws RunnerException {
        Options opt = new OptionsBuilder()
                .include(Benchmark1.class.getSimpleName())
                .forks(1)
                .build();
        new Runner(opt).run();
    }
}
</code></pre>
<p>é¦–å…ˆå¯ç”¨doSumçš„æ–¹æ³•å†…è”ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹(æ¯ç§’ååé‡ï¼Œåˆ†æ•°è¶Šé«˜è¶Šå¥½)</p>
<pre><code>Benchmark              Mode  	Samples        Score  Score error  Units
t.Benchmark1.test1    thrpt					5  2420286.539   390747.467  ops/s
t.Benchmark1.test2    thrpt					5  2544313.594    91304.136  ops/s
t.Benchmark1.test3    thrpt					5  2469176.697   450570.647  ops/s
</code></pre>
<p>æ¥ä¸‹æ¥ç¦ç”¨doSumæ–¹æ³•å†…è”</p>
<pre><code class="language-java">//ç¦ç”¨å†…è”
@CompilerControl(CompilerControl.Mode.DONT_INLINE)
static void doSum(int x) {
    sum += x; 
}
</code></pre>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p>
<pre><code>Benchmark              Mode  	Samples       Score  Score error  Units
t.Benchmark1.test1    thrpt					5  296141.478    63649.220  ops/s
t.Benchmark1.test2    thrpt					5  371262.351    83890.984  ops/s
t.Benchmark1.test3    thrpt					5  368960.847    60163.391  ops/s
</code></pre>
<p>åˆ†æï¼š<br />åœ¨åˆšæ‰çš„ç¤ºä¾‹ä¸­ï¼ŒdoSum æ–¹æ³•æ˜¯å¦å†…è”ä¼šå½±å“ elements æˆå‘˜å˜é‡è¯»å–çš„ä¼˜åŒ–: å¦‚æœ doSum æ–¹æ³•å†…è”äº†ï¼Œåˆšæ‰çš„ test1 æ–¹æ³•ä¼šè¢«ä¼˜åŒ–æˆä¸‹é¢çš„æ ·å­(ä¼ªä»£ç ):</p>
<pre><code class="language-java">@Benchmark
public void test1() {
    // elements.length é¦–æ¬¡è¯»å–ä¼šç¼“å­˜èµ·æ¥ -&gt; int[] local
    for (int i = 0; i &lt; elements.length; i++) { // åç»­ 999 æ¬¡ æ±‚é•¿åº¦ &lt;- local
		sum += elements[i]; // 1000 æ¬¡å–ä¸‹æ ‡ i çš„å…ƒç´  &lt;- local 
    }	
}
</code></pre>
<p>å¯ä»¥èŠ‚çœ1999æ¬¡Fieldè¯»å–æ“ä½œ<br />ä½†å¦‚æœdoSumæ–¹æ³•æ²¡æœ‰å†…è”ï¼Œåˆ™ä¸ä¼šè¿›è¡Œä¸Šé¢çš„ä¼˜åŒ–</p>
<p>ç»ƒä¹ :åœ¨å†…è”æƒ…å†µä¸‹å°† elements æ·»åŠ  volatile ä¿®é¥°ç¬¦ï¼Œè§‚å¯Ÿæµ‹è¯•ç»“æœ</p>
<p><a name="wGyBB"></a></p>
<h2 id="åå°„ä¼˜åŒ–">åå°„ä¼˜åŒ–</h2>
<pre><code class="language-java">package cn.itcast.jvm.t3.reflect;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
public class Reflect1 {
    public static void foo() {
        System.out.println(&quot;foo...&quot;);
    }
    public static void main(String[] args) throws Exception {
        Method foo = Reflect1.class.getMethod(&quot;foo&quot;);
        for (int i = 0; i &lt;= 16; i++) {
            System.out.printf(&quot;%d\t&quot;, i);
            foo.invoke(null);
        }
        System.in.read();
    }
}
</code></pre>
<p>foo.invokeå‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç°</p>
<pre><code class="language-java">package sun.reflect;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import sun.reflect.misc.ReflectUtil;
class NativeMethodAccessorImpl extends MethodAccessorImpl {
    private final Method method;
    private DelegatingMethodAccessorImpl parent;
    private int numInvocations;
    NativeMethodAccessorImpl(Method method) {
        this.method = method;
	}
    public Object invoke(Object target, Object[] args) 
        throws IllegalArgumentException, InvocationTargetException {
        // inflationThreshold è†¨èƒ€é˜ˆå€¼ï¼Œé»˜è®¤ 15
        if (++this.numInvocations &gt; ReflectionFactory.inflationThreshold()
            &amp;&amp; !ReflectUtil.isVMAnonymousClass(this.method.getDeclaringClass())){
            // ä½¿ç”¨ ASM åŠ¨æ€ç”Ÿæˆçš„æ–°å®ç°ä»£æ›¿æœ¬åœ°å®ç°ï¼Œé€Ÿåº¦è¾ƒæœ¬åœ°å®ç°å¿« 20 å€å·¦å³ 
            MethodAccessorImpl generatedMethodAccessor =
                (MethodAccessorImpl)
                    (new MethodAccessorGenerator())
                        .generateMethod(
                            this.method.getDeclaringClass(),
                            this.method.getName(),
                            this.method.getParameterTypes(),
                            this.method.getReturnType(),
                            this.method.getExceptionTypes(),
                            this.method.getModifiers()
                        );
            this.parent.setDelegate(generatedMethodAccessor);
        }
        // è°ƒç”¨æœ¬åœ°å®ç°
    	return invoke0(this.method, target, args);
    }
    
    void setParent(DelegatingMethodAccessorImpl parent) {
        this.parent = parent;
    }
    private static nat ive Object invoke0(Method method, Object target, Object[] args);
}
</code></pre>
<p>å½“è°ƒç”¨åˆ°ç¬¬ 16 æ¬¡(ä»0å¼€å§‹ç®—)æ—¶ï¼Œä¼šé‡‡ç”¨è¿è¡Œæ—¶ç”Ÿæˆçš„ç±»ä»£æ›¿æ‰æœ€åˆçš„å®ç°ï¼Œå¯ä»¥é€šè¿‡ debug å¾—åˆ° ç±»åä¸º sun.reflect.GeneratedMethodAccessor1<br />å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„ arthas å·¥å…·:</p>
<pre><code>java -jar arthas-boot.jar
[INFO] arthas-boot version: 3.1.1
[INFO] Found existing java process, please choose one and hit RETURN.
* [1]: 13065 cn.itcast.jvm.t3.reflect.Reflect1
</code></pre>
<p>é€‰æ‹©1å›è½¦è¡¨ç¤ºåˆ†æè¯¥è¿›ç¨‹</p>
<pre><code>1
[INFO] arthas home: /root/.arthas/lib/3.1.1/arthas
[INFO] Try to attach process 13065
[INFO] Attach process 13065 success.
[INFO] arthas-client connect 127.0.0.1 3658

wiki      https://alibaba.github.io/arthas
tutorials https://alibaba.github.io/arthas/arthas-tutorials
version   3.1.1
pid       13065
time      2019-06-10 12:23:54
</code></pre>
<p>åœ¨è¾“å…¥ã€jad+ç±»åã€‘æ¥è¿›è¡Œåç¼–è¯‘</p>
<pre><code class="language-java">$ jad sun.reflect.GeneratedMethodAccessor1
ClassLoader:
+-sun.reflect.DelegatingClassLoader@15db9742
  +-sun.misc.Launcher$AppClassLoader@4e0e2f2a
    +-sun.misc.Launcher$ExtClassLoader@2fdb006e
Location:
/*
 * Decompiled with CFR 0_132.
 *
 * Could not load the following classes:
 *  cn.itcast.jvm.t3.reflect.Reflect1
 */
package sun.reflect;
import cn.itcast.jvm.t3.reflect.Reflect1;
import java.lang.reflect.InvocationTargetException;
import sun.reflect.MethodAccessorImpl;
public class GeneratedMethodAccessor1
extends MethodAccessorImpl {
    /*
     * Loose catch block
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     * Lifted jumps to return sites
     */
  public Object invoke(Object object, Object[] arrobject) 
    throws InvocationTargetException {
    // æ¯”è¾ƒå¥‡è‘©çš„åšæ³•ï¼Œå¦‚æœæœ‰å‚æ•°ï¼Œé‚£ä¹ˆæŠ›éæ³•å‚æ•°å¼‚å¸¸ 
    block4 : {
      if (arrobject == null || arrobject.length == 0) break block4;
      throw new IllegalArgumentException();
    }
    try {
      // å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æ˜¯ç›´æ¥è°ƒç”¨äº†ğŸ˜±ğŸ˜±ğŸ˜± 
      Reflect1.foo();
      // å› ä¸ºæ²¡æœ‰è¿”å›å€¼
      return null;
    }
    catch (Throwable throwable) {
      throw new InvocationTargetException(throwable);
    }
    catch (ClassCastException | NullPointerException runtimeException) {
      throw new IllegalArgumentException(Object.super.toString());
    } 
  }
}
Affect(row-cnt:1) cost in 1540 ms.
</code></pre>
<blockquote>
<p>æ³¨æ„<br>
é€šè¿‡æŸ¥çœ‹ ReflectionFactory æºç å¯çŸ¥</p>
<ul>
<li>sun.reflect.noInflation å¯ä»¥ç”¨æ¥ç¦ç”¨è†¨èƒ€(ç›´æ¥ç”Ÿæˆ GeneratedMethodAccessor1ï¼Œä½†é¦–æ¬¡ç”Ÿæˆæ¯”è¾ƒè€—æ—¶ï¼Œå¦‚æœä»…åå°„è°ƒç”¨ä¸€æ¬¡ï¼Œä¸åˆ’ç®—)</li>
<li>sun.reflect.inflationThreshold å¯ä»¥ä¿®æ”¹è†¨èƒ€é˜ˆå€¼</li>
</ul>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVMåƒåœ¾å›æ”¶]]></title>
        <id>https://yeyuan1107.github.io/post/jvm-la-ji-hui-shou/</id>
        <link href="https://yeyuan1107.github.io/post/jvm-la-ji-hui-shou/">
        </link>
        <updated>2022-02-22T13:10:23.000Z</updated>
        <content type="html"><![CDATA[<p><a name="Dee1j"></a></p>
<h1 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶">å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h1>
<p><a name="KDBNf"></a></p>
<h2 id="å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³•</h2>
<p>åªè¦ä¸€ä¸ªå¯¹è±¡è¢«å…¶ä»–å˜é‡æ‰€å¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡çš„è®¡æ•°åŠ ä¸€ï¼Œå¦åˆ™å‡ä¸€ã€‚å½“è¯¥å¯¹è±¡å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ²¡æœ‰å˜é‡å¼•ç”¨ï¼Œå¯ä»¥å½“ä½œåƒåœ¾å›æ”¶<br>
<a name="GVYSe"></a></p>
<h3 id="å­˜åœ¨é—®é¢˜">å­˜åœ¨é—®é¢˜</h3>
<figure data-type="image" tabindex="1"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645603195966-317f5292-8997-4090-a195-d02fb97e6015-20220312195236110.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>å¾ªç¯å¼•ç”¨é€ æˆå†…å­˜æ³„æ¼</li>
<li>å½“æ²¡æœ‰å˜é‡å¼•ç”¨Aå¯¹è±¡ï¼Œä¹Ÿæ²¡æœ‰å˜é‡å¼•ç”¨Bå¯¹è±¡ï¼Œä½†æ˜¯Aå’ŒBç›¸äº’å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°å™¨ä¸º1ï¼Œæ— æ³•å¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼<br>
<a name="LQ6se"></a></li>
</ul>
<h2 id="å¯è¾¾æ€§åˆ†æç®—æ³•">å¯è¾¾æ€§åˆ†æç®—æ³•</h2>
<ul>
<li>Javaæ‰€ä½¿ç”¨çš„æ–¹æ³•</li>
<li>ç¡®å®šä¸€ç³»åˆ—æ ¹å¯¹è±¡(è‚¯å®šä¸èƒ½å½“ä½œåƒåœ¾å›æ”¶çš„å¯¹è±¡)ï¼Œåƒåœ¾å›æ”¶å‰é¦–å…ˆå¯¹å †ä¸­æ‰€æœ‰å¯¹è±¡è¿›è¡Œæ‰«æï¼Œçœ‹çœ‹æ¯ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«æ ¹å¯¹è±¡ç›´æ¥æˆ–è€…é—´æ¥çš„å¼•ç”¨ã€‚å¦‚æœæ²¡æœ‰è¢«æ ¹å¯¹è±¡ç›´æ¥æˆ–é—´æ¥çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥å½“ä½œåƒåœ¾å›æ”¶</li>
<li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿæ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œæ‰¾ä¸åˆ°ï¼Œè¡¨ç¤ºå¯ä»¥å›æ”¶</li>
<li>å¯ä»¥è¢«ä½œä¸ºGC Rootçš„å¯¹è±¡(å·¥å…·Memory Analyzer å¯è§†åŒ–Javaå †åˆ†æå·¥å…·)
<ul>
<li>System Classï¼šç³»ç»Ÿç±»ã€æ ¸å¿ƒç±»</li>
<li>Native Stackï¼šæœ¬åœ°æ–¹æ³•å¼•ç”¨çš„ä¸€äº›å¯¹è±¡</li>
<li>Busy Monitorï¼šåŠ é”çš„å¯¹è±¡</li>
<li>Threadï¼šæ´»åŠ¨çº¿ç¨‹ä¸­çš„å¯¹è±¡<br>
<a name="CkjCo"></a></li>
</ul>
</li>
</ul>
<h2 id="å››ç§å¼•ç”¨">å››ç§å¼•ç”¨</h2>
<ol>
<li>å¼ºå¼•ç”¨
<ol>
<li>åªæœ‰æ‰€æœ‰GC Roots å¯¹è±¡éƒ½ä¸é€šè¿‡ã€å¼ºå·1ç”¨1å¼•1ç”¨è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«åƒåœ¾å›æ”¶</li>
</ol>
</li>
<li>è½¯å¼•ç”¨ (SoftReference)
<ol>
<li>ä»…æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶åï¼Œå†…å­˜ä»ä¸è¶³æ—¶ä¼šå†æ¬¡å‡ºå‘åƒåœ¾å›æ”¶ï¼Œå›æ”¶è½¯å¼•ç”¨å¯¹è±¡</li>
<li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾è½¯å¼•ç”¨è‡ªèº«</li>
</ol>
</li>
<li>å¼±å¼•ç”¨ (WeakReference)
<ol>
<li>ä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡</li>
<li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼±å¼•1ç”¨è‡ªèº«</li>
</ol>
</li>
<li>è™›å¼•ç”¨ (PhantomReference)
<ol>
<li>å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¸»è¦é…åˆ ByteBuffer ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›æ”¶æ—¶ï¼Œä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿï¼Œç”±<br />Reference Handler çº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ol>
</li>
<li>ç»ˆç»“å™¨å¼•ç”¨ (FinalReference)
<ol>
<li>æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œä½†å…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œç»ˆç»“å™¨å¼•1ç”¨å…¥é˜Ÿï¼ˆè¢«å¼•1ç”¨å¯¹è±¡æš‚æ—¶æ²¡æœ‰<br />è¢«å›æ”¶ï¼‰ï¼Œå†ç”± Finalizer çº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•1ç”¨æ‰¾åˆ°è¢«å¼•1ç”¨å¯¹è±¡å¹¶è°ƒç”¨å®ƒçš„finalize æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡GC æ—¶æ‰èƒ½å›æ”¶è¢«å¼•ç”¨å¯¹è±¡</li>
</ol>
</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645604622637-56b774e8-e033-4af2-b34d-81ce05d26bab-20220312195236455.png" alt="image.png" loading="lazy"><br />å®çº¿è¡¨ç¤ºå¼ºå¼•ç”¨<br>
<a name="cNooy"></a></p>
<h3 id="å¼ºå¼•ç”¨">å¼ºå¼•ç”¨</h3>
<ul>
<li>æ—¥å¸¸å¼•ç”¨åŸºæœ¬éƒ½ä¸ºå¼ºå¼•ç”¨ï¼Œæ¯”å¦‚ï¼šnewä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é€šè¿‡èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¯¥å˜é‡å¼ºå¼•ç”¨è¿™ä¸ªå¯¹è±¡</li>
<li>åªè¦æ²¿ç€GC Rootçš„å¼•ç”¨é“¾å¯ä»¥æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶</li>
<li>GC Rootå¯¹ä»–çš„å¼•ç”¨éƒ½æ–­å¼€æ—¶ï¼Œå½“åƒåœ¾å›æ”¶å‘ç”Ÿæ—¶ï¼Œè¯¥å¯¹è±¡è¢«å›æ”¶<br>
<a name="labEX"></a></li>
</ul>
<h3 id="è½¯-å¼±å¼•ç”¨">è½¯ã€å¼±å¼•ç”¨</h3>
<ul>
<li>åªè¦å¯¹è±¡æ²¡æœ‰æ²¡æœ‰è¢«ç›´æ¥çš„å¼ºå¼•ç”¨æ‰€å¼•ç”¨ï¼Œå½“åƒåœ¾å›æ”¶å‘ç”Ÿæ—¶ï¼Œéƒ½æœ‰å¯èƒ½è¢«å›æ”¶</li>
</ul>
<figure data-type="image" tabindex="2"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645606649699-466a5547-db23-4e24-ba9e-b444bfd7b86e-20220312195236779.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>è½¯å¼•ç”¨ï¼šæ²¡æœ‰å¼ºå¼•ç”¨å¼•ç”¨ä»–ï¼Œå‘ç”Ÿåƒåœ¾å›æ”¶ä¸”åƒåœ¾å›æ”¶åå†…å­˜ä¸è¶³ï¼Œå°±ä¼šå›æ”¶è½¯å¼•ç”¨å¼•ç”¨çš„å¯¹è±¡</li>
<li>å¼±å¼•ç”¨ï¼šæ²¡æœ‰å¼ºå¼•ç”¨å¼•ç”¨ä»–ï¼Œå‘ç”Ÿåƒåœ¾å›æ”¶ï¼Œä¸ç®¡å†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¼•ç”¨çš„å¯¹è±¡</li>
<li>è½¯ã€å¼±å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶åï¼Œè½¯ã€å¼±å¼•ç”¨å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæƒ³è¦é‡Šæ”¾è½¯ã€å¼±å¼•ç”¨ï¼Œéœ€è¦ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—è¿›è¡Œé‡Šæ”¾</li>
<li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨<br>
<a name="AIm45"></a></li>
</ul>
<h4 id="è½¯å¼•ç”¨çš„åº”ç”¨">è½¯å¼•ç”¨çš„åº”ç”¨</h4>
<pre><code class="language-java">//byte[]ä½¿ç”¨å¼ºå¼•ç”¨ï¼Œå¯èƒ½é€ æˆOutOfMemoryError
//list å¼ºå¼•ç”¨--&gt; byte[]
List&lt;byte[]&gt; list;

//list å¼ºå¼•ç”¨--&gt; SoftReference è½¯å¼•ç”¨--&gt; byte[]
//ä¸ä¼šé€ æˆOutOfMemoryErrorï¼Œå½“å†…å­˜ä¸è¶³æ—¶byte[]ä¼šè¢«åƒåœ¾å›æ”¶
List&lt;SoftReference&lt;byte[]&gt;&gt; list
</code></pre>
<p><a name="ThDRd"></a></p>
<h4 id="è½¯å¼•ç”¨å¼•ç”¨é˜Ÿåˆ—">è½¯å¼•ç”¨å¼•ç”¨é˜Ÿåˆ—</h4>
<pre><code class="language-java">ReferenceQueue&lt;byte[]&gt; queue
//å¸Œæœ›åœ¨byte[]è¢«æ¸…ç†æ—¶ï¼Œå¯¹åº”çš„SoftReference&lt;byte[]&gt;ä¹Ÿè¢«æ¸…ç†
List&lt;SoftReference&lt;byte[]&gt;&gt; list
//è½¯å¼•ç”¨å¯¹è±¡å…³è”äº†è½¯å¼•ç”¨é˜Ÿåˆ—ï¼Œå½“è½¯å¼•ç”¨æ‰€å…³è”çš„byte[]è¢«å›æ”¶æ—¶ï¼Œè½¯å¼•ç”¨ä¼šåŠ å…¥åˆ°queueä¸­å»
SoftReference&lt;byte[]&gt; ref = new SoftReference&lt;&gt;(new byte[], queue);
//ä»é˜Ÿåˆ—ä¸­è·å–æ— ç”¨çš„è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¹¶ç§»é™¤
Referecne&lt;? extends byte[]&gt; poll = queue.poll();
while(poll != null){
    //ç§»é™¤åˆ—è¡¨ä¸­çš„è½¯å¼•ç”¨å¯¹è±¡
    list.remove(poll);
    poll = queue.poll();
}
</code></pre>
<p><a name="IGTJN"></a></p>
<h4 id="å¼±å¼•ç”¨çš„åº”ç”¨">å¼±å¼•ç”¨çš„åº”ç”¨</h4>
<pre><code class="language-java">//byte[]ä½¿ç”¨å¼ºå¼•ç”¨ï¼Œå¯èƒ½é€ æˆOutOfMemoryError
//list å¼ºå¼•ç”¨--&gt; byte[]
List&lt;byte[]&gt; list;

//list å¼ºå¼•ç”¨--&gt; WeakReference å¼±å¼•ç”¨--&gt; byte[]
//ä¸ä¼šé€ æˆOutOfMemoryErrorï¼Œbyte[]æ²¡æœ‰è¢«å¼ºå¼•ç”¨æ—¶ï¼Œä¼šè¢«åƒåœ¾å›æ”¶
//åœ¨åƒåœ¾å›æ”¶æ—¶ä¼šè¿›è¡Œåƒåœ¾å›æ”¶
//å¼±å¼•ç”¨çš„å¼•ç”¨é˜Ÿåˆ—ä¸è½¯å¼•ç”¨ç±»ä¼¼
List&lt;WeakReference&lt;byte[]&gt;&gt; list
</code></pre>
<p><a name="NSHeJ"></a></p>
<h3 id="è™šå¼•ç”¨">è™šå¼•ç”¨</h3>
<ol>
<li>å½“ByteBufferå¯¹è±¡åˆ›å»ºï¼Œä¼šäº§ç”Ÿä¸€ä¸ªCleanerçš„è™šå¼•ç”¨å¯¹è±¡ï¼ŒByteBufferä¼šäº§ç”Ÿä¸€å—ç›´æ¥å†…å­˜ï¼Œå¹¶æŠŠç›´æ¥å†…å­˜åœ°å€ä¼ é€’ç»™è™šå¼•ç”¨å¯¹è±¡</li>
</ol>
<figure data-type="image" tabindex="3"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645605803852-3bc4837a-4519-4c8f-83d5-4794b885e43e-20220312195237090.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>å½“ByteBufferæ²¡æœ‰è¢«å¼ºå¼•ç”¨ï¼ŒByteBufferå¯ä»¥è¢«åƒåœ¾å›æ”¶æ‰</li>
</ol>
<figure data-type="image" tabindex="4"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645605918244-b702c4b9-14bc-4ecc-879d-7840d277686d-20220312195237416.png" alt="image.png" loading="lazy"></figure>
<ol start="3">
<li>ByteBufferè¢«åƒåœ¾å›æ”¶åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerè¿›å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ã€‚</li>
<li>ReferenceHandlerä¼šå®šæ—¶æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—æ˜¯å¦æœ‰è™šå¼•ç”¨å¯¹è±¡Cleanerï¼Œå¦‚æœæœ‰å°±è°ƒç”¨å…¶ä¸­çš„cleanæ–¹æ³•ï¼Œä»è€Œé‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ol>
<figure data-type="image" tabindex="5"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645606114585-c64711bb-e14d-433c-ba62-9551d5bc4dd1-20220312195237744.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>ä¸è½¯ã€å¼±å¼•ç”¨ä¸åŒï¼Œè™šå¼•ç”¨å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨<br>
<a name="Tcntl"></a></li>
</ul>
<h3 id="ç»ˆç»“å™¨å¼•ç”¨">ç»ˆç»“å™¨å¼•ç”¨</h3>
<ol>
<li>å½“ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼ºå¼•ç”¨ï¼Œä¸”é‡å†™äº†finalize()æ–¹æ³•ï¼ŒJVMä¼šåˆ›å»ºç»ˆç»“å™¨å¼•ç”¨</li>
</ol>
<figure data-type="image" tabindex="6"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645606418844-28eed4aa-ec58-48b1-9886-212b1dd29359-20220312195237873.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>å½“è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå°†ç»ˆç»“å™¨å¼•ç”¨æ”¾å…¥é˜Ÿåˆ—</li>
</ol>
<figure data-type="image" tabindex="7"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645606440872-e3eda565-e279-4c96-ba33-8cbd3b33019b-20220312195238154.png" alt="image.png" loading="lazy"></figure>
<ol start="3">
<li>å†ç”±ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹FinalizeHandlerçš„çº¿ç¨‹æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç»ˆç»“å™¨å¼•ç”¨ï¼Œå¦‚æœæœ‰å°±æ‰¾åˆ°å¯¹è±¡è°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œå°±æŠŠè¯¥å¯¹è±¡å ç”¨çš„å†…å­˜çœŸæ­£å›æ”¶æ‰äº†<br>
<a name="PI68T"></a></li>
</ol>
<h1 id="åƒåœ¾å›æ”¶ç®—æ³•">åƒåœ¾å›æ”¶ç®—æ³•</h1>
<p>JVMä¼šæ ¹æ®å…·ä½“æƒ…å†µåœ¨ä¸‹é¢ä¸‰ç§æ–¹æ³•ä¸­é€‰æ‹©é€‚å½“çš„åƒåœ¾å›æ”¶ç®—æ³•æ¥è¿›è¡Œåƒåœ¾å›æ”¶<br>
<a name="BvQek"></a></p>
<h2 id="æ ‡è®°æ¸…é™¤ç®—æ³•mark-sweep">æ ‡è®°æ¸…é™¤ç®—æ³•(Mark Sweep)</h2>
<ol>
<li>æ ‡è®°ï¼Œå°†æ²¡æœ‰è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡æ ‡è®°å‡ºæ¥</li>
</ol>
<figure data-type="image" tabindex="8"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645614249994-b3ca2518-99b8-4bb5-a74b-3395fb22246f-20220312195238191.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>æ¸…é™¤ï¼Œå°†æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼Œå°†å¯¹åº”å†…å­˜çš„å¼€å§‹å’Œç»“æŸåœ°å€æ”¾å…¥ç©ºé—²åœ°å€åˆ—è¡¨å³å¯</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645614336971-9345a045-21c1-4380-b001-dc111958a874-20220312195238907.png" alt="image.png" loading="lazy"><br>
<a name="kHn3e"></a></p>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<p>é€Ÿåº¦å¿«<br>
<a name="QnOO4"></a></p>
<h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3>
<p>ä¼šé€ æˆå†…å­˜ç¢ç‰‡<br>
<a name="Z2EjA"></a></p>
<h2 id="æ ‡è®°æ•´ç†ç®—æ³•mark-compact">æ ‡è®°æ•´ç†ç®—æ³•(Mark Compact)</h2>
<ol>
<li>æ ‡è®°ï¼Œå°†æ²¡æœ‰è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡æ ‡è®°å‡ºæ¥</li>
</ol>
<figure data-type="image" tabindex="9"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645614514893-91de49b5-c9c8-4849-ac6a-dfd654563c2a-20220312195238966.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>æ•´ç†ï¼Œå°†æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼ŒåŒæ—¶è¿›è¡Œæ•´ç†</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645614584722-79908789-bffb-46f3-965f-112d57eb6b5d-20220312195239019.png" alt="image.png" loading="lazy"><br>
<a name="AWOOl"></a></p>
<h3 id="ä¼˜ç‚¹-2">ä¼˜ç‚¹</h3>
<p>è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜<br>
<a name="I7DzR"></a></p>
<h3 id="ç¼ºç‚¹-2">ç¼ºç‚¹</h3>
<p>ç”±äºæ•´ç†æ¶‰åŠåˆ°å¯¹è±¡çš„ç§»åŠ¨ï¼Œå¯¼è‡´æ•ˆç‡è¾ƒä½<br>
<a name="NESOw"></a></p>
<h2 id="å¤åˆ¶ç®—æ³•copy">å¤åˆ¶ç®—æ³•(Copy)</h2>
<ol>
<li>å°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—åŒºåŸŸï¼Œä¸€å—ä¸ºFROMå¦ä¸€å—ä¸ºTO</li>
<li>æ ‡è®°ï¼Œå°†æ²¡æœ‰è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡æ ‡è®°å‡ºæ¥</li>
</ol>
<figure data-type="image" tabindex="10"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645614944342-0e6ea7d4-650e-40fc-8f5c-ceb16d98183f-20220312195239068.png" alt="image.png" loading="lazy"></figure>
<ol start="3">
<li>æŠŠFROMä¸­å­˜æ´»çš„å¯¹è±¡å¤åˆ¶(å¤åˆ¶è¿‡ç¨‹ä¸­ä¹Ÿä¼šè¿›è¡Œæ•´ç†)åˆ°TOä¸­ï¼Œç„¶åæ¸…é™¤FROMä¸­çš„å¯¹è±¡</li>
</ol>
<figure data-type="image" tabindex="11"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645615121705-e0866db1-3d26-4356-a562-cce9979e69b3-20220312195239360.png" alt="image.png" loading="lazy"></figure>
<ol start="4">
<li>TOå˜ä¸ºFROMï¼ŒFROMå˜TO</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645615197185-3b1414e9-4d30-4f85-9ab3-eee572d91525-20220312195239427.png" alt="image.png" loading="lazy"><br>
<a name="iFMBG"></a></p>
<h3 id="ä¼˜ç‚¹-3">ä¼˜ç‚¹</h3>
<p>ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡<br>
<a name="gx36P"></a></p>
<h3 id="ç¼ºç‚¹-3">ç¼ºç‚¹</h3>
<p>å ç”¨åŒå€çš„å†…å­˜ç©ºé—´<br>
<a name="XGUe7"></a></p>
<h1 id="åˆ†ä»£å›æ”¶">åˆ†ä»£å›æ”¶</h1>
<figure data-type="image" tabindex="12"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645615499390-3d20ec05-fb67-4115-b640-21a13ea7e9f9-20220312195239483.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ›´ä¸ºé¢‘ç¹ï¼Œå›æ”¶ä¸€æ¬¡è€—æ—¶è¾ƒå°‘</li>
<li>è€å¹´ä»£åƒåœ¾å›æ”¶é¢‘ç‡è¾ƒä½ï¼Œå›æ”¶ä¸€æ¬¡è€—æ—¶è¾ƒå¤š</li>
</ul>
<ol>
<li>æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå­˜æ”¾åœ¨ä¼Šç”¸å›­å½“ä¸­</li>
<li>å½“ç»§ç»­åˆ›å»ºå¯¹è±¡æ—¶å‘ç°ä¼Šç”¸å›­å†…çš„å†…å­˜ç©ºé—´ä¸è¶³ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶(Minor GC)
<ol>
<li>Minor GCæ ¹æ®å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œå¯¹å¯¹è±¡è¿›è¡Œæ ‡è®°</li>
<li>ä½¿ç”¨å¤åˆ¶ç®—æ³•æŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ï¼ŒåŒæ—¶å°†è¿™äº›å¯¹è±¡çš„å¯¿å‘½+1</li>
<li>å¹¸å­˜åŒºFROMå˜ä¸ºTOï¼ŒTOå˜æˆFROM</li>
</ol>
</li>
<li>ç»§ç»­å‘ä¼Šç”¸å›­å­˜æ”¾å¯¹è±¡ï¼Œå½“ä¼Šç”¸å›­å†æ¬¡å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘ç¬¬äºŒæ¬¡åƒåœ¾å›æ”¶(Minor GC)
<ol>
<li>Minor GCæ ¹æ®å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œå¯¹ä¼Šç”¸å›­ä¸­å’Œå¹¸å­˜åŒºä¸­å¯¹è±¡è¿›è¡Œæ ‡è®°</li>
<li>ä½¿ç”¨å¤åˆ¶ç®—æ³•æŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ï¼ŒåŒæ—¶å°†è¿™äº›å¯¹è±¡çš„å¯¿å‘½+1
<ol>
<li>å½“å¹¸å­˜åŒºå¯¹è±¡ä¸­çš„å¯¿å‘½è¾¾åˆ°äº†é˜ˆå€¼(æœ€å¤§å¯¿å‘½ä¸º15)ï¼Œå°†å…¶æ™‹å‡åˆ°è€å¹´ä»£ä¸­</li>
</ol>
</li>
<li>å¹¸å­˜åŒºFROMå˜ä¸ºTOï¼ŒTOå˜æˆFROM</li>
<li>Minor GCä¼šå¼•å‘stop the world(åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæš‚åœå…¶ä»–çš„ç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶åŠ¨ä½œç»“æŸï¼Œå…¶ä»–çš„ç”¨æˆ·çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­è¿›è¡Œ)</li>
</ol>
</li>
<li>å½“è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œå…ˆå°è¯•è§¦å‘Minor GCï¼Œå¦‚æœä¹‹åç©ºé—´ä»ä¸è¶³ï¼Œè§¦å‘ä¸€æ¬¡Full GC(Full GCåŒæ ·ä¼šè§¦å‘stop the worldï¼Œä¸”æ—¶é—´æ›´é•¿ï¼Œé‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†æˆ–æ ‡è®°æ¸…é™¤ç®—æ³•)
<ol>
<li>å½“è€å¹´ä»£ç©ºé—´è¶³å¤Ÿï¼Œæ–°ç”Ÿä»£ç©ºé—´ä¸€å®šä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¤§å¯¹è±¡ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£</li>
</ol>
</li>
<li>å¦‚æœä»æ—§åˆ†é…å¤±è´¥ï¼Œè§¦å‘OutOfMemoryError
<ol>
<li>ä¸€ä¸ªçº¿ç¨‹çš„OutOfMemoryErrorä¸ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹ç»“æŸ<br>
<a name="Trz34"></a></li>
</ol>
</li>
</ol>
<h2 id="ç›¸å…³vmå‚æ•°">ç›¸å…³VMå‚æ•°</h2>
<table>
<thead>
<tr>
<th>å«ä¹‰</th>
<th>å‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>å †åˆå§‹å¤§å°</td>
<td>-Xms</td>
</tr>
<tr>
<td>å †æœ€å¤§å¤§å°</td>
<td>-Xmxæˆ–-XX:MaxHeapSize=size</td>
</tr>
<tr>
<td>æ–°ç”Ÿä»£å¤§å°</td>
<td>-Xmnæˆ–(-XX:NewSize=size+ -XX:MaxNewSize=size)</td>
</tr>
<tr>
<td>å¹¸å­˜åŒºæ¯”ä¾‹(åŠ¨æ€)</td>
<td>-XX:InitialSurvivorRatio=ratioå’Œ-XX:+UseAdaptiveSizePolicy</td>
</tr>
<tr>
<td>å¹¸å­˜åŒºæ¯”ä¾‹</td>
<td>-XX:SurvivorRatio=ratio</td>
</tr>
<tr>
<td>æ™‹å‡é˜ˆå€¼</td>
<td>-XX:MaxTenuringThreshold=threshold</td>
</tr>
<tr>
<td>æ™‹å‡è¯¦æƒ…</td>
<td>-XX:+PrintTenuringDistribution</td>
</tr>
<tr>
<td>GCè¯¦æƒ…</td>
<td>-XX:+PrintGCDetails -verbose:gc</td>
</tr>
<tr>
<td>FullGCå‰MinorGC</td>
<td>-XX:+ScavengeBeforeFullGC</td>
</tr>
</tbody>
</table>
<p><a name="ry4E1"></a></p>
<h2 id="åˆ†ä»£åƒåœ¾å›æ”¶è¯¦æƒ…">åˆ†ä»£åƒåœ¾å›æ”¶è¯¦æƒ…</h2>
<ol>
<li>åˆå§‹æƒ…å†µ</li>
</ol>
<figure data-type="image" tabindex="13"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645672461032-8452a2f1-0f4b-46cb-a573-630ab6c1e7bb-20220312195239790.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>æ‰§è¡Œåæƒ…å†µ</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645672435742-05da2772-9f32-4a00-8d82-004f0e8acf3a-20220312195240083.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645672510315-4c6b0fb4-6052-47fe-a49b-71d608e05b48-20220312195240427.png" alt="image.png" loading="lazy"></p>
<ol start="3">
<li>è§¦å‘ç¬¬äºŒæ¬¡GC</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645673297389-f9f77314-6614-4d08-8d5c-2f6d531f725e-20220312195241234.png" alt="image.png" loading="lazy"><br>
<a name="u03OF"></a></p>
<h1 id="åƒåœ¾å›æ”¶å™¨">åƒåœ¾å›æ”¶å™¨</h1>
<p><a name="ET8h1"></a></p>
<h2 id="ä¸²è¡Œçš„åƒåœ¾å›æ”¶å™¨">ä¸²è¡Œçš„åƒåœ¾å›æ”¶å™¨</h2>
<ul>
<li>å•çº¿ç¨‹(å…¶ä»–çº¿ç¨‹éƒ½æš‚åœ)</li>
<li>å †å†…å­˜è¾ƒå°æ—¶ï¼Œé€‚åˆä¸ªäººç”µè„‘</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645685403294-22290a4b-316b-43ef-a214-dd1f1691903e-20220312195241322.png" alt="image.png" loading="lazy"><br />Serialï¼šå·¥ä½œåœ¨æ–°ç”Ÿä»£ï¼Œé‡‡ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•<br />SerialOldï¼šå·¥ä½œåœ¨è€å¹´ä»£ï¼Œé‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†ç®—æ³•<br>
<a name="r2P99"></a></p>
<h2 id="ååé‡ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨">ååé‡ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨</h2>
<ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§çš„åœºæ™¯ï¼Œéœ€è¦å¤šæ ¸cpuæ¥æ”¯æŒ</li>
<li>è®©å•ä½æ—¶é—´å†…ï¼Œstop the worldçš„æ—¶é—´æœ€çŸ­ï¼Œé™ä½åƒåœ¾å›æ”¶æ—¶é—´åœ¨å·¥ä½œæ—¶é—´çš„å æ¯”</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645685722473-d75e6551-6e3c-48d6-a754-acd786439173-20220312195241655.png" alt="image.png" loading="lazy"><br />å¹¶è¡Œçš„ï¼Œå¤šä¸ªåƒåœ¾å›æ”¶å™¨å¹¶è¡Œè¿è¡Œï¼Œä½†æ˜¯åƒåœ¾å›æ”¶æœŸé—´ä¸å…è®¸ç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œ<br />UseParallelGCï¼šä½œç”¨åœ¨æ–°ç”Ÿä»£ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•<br />UseParallelOldGCï¼šä½œç”¨åœ¨è€å¹´ä»£ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³•<br />ParallelGCThreadsï¼šæ§åˆ¶ParallelGCçº¿ç¨‹æ•°<br />UseAdaptiveSizePolicyï¼šé‡‡ç”¨è‡ªé€‚åº”çš„å¤§å°è°ƒæ•´ç­–ç•¥ï¼Œè°ƒæ•´æ–°ç”Ÿä»£å¤§å°(åŠ¨æ€è°ƒæ•´ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºæ¯”ä¾‹ï¼Œä»¥åŠæ™‹å‡é˜ˆå€¼)<br />GCTimeRatio ï¼šè°ƒæ•´åƒåœ¾å›æ”¶ä¸æ€»æ—¶é—´çš„å æ¯”(1/(1+ratio))(ratioé»˜è®¤ä¸º99)åƒåœ¾å›æ”¶æ—¶é—´å æ€»æ—¶é—´çš„æœ€å¤§æ¯”ä¾‹ï¼Œä¸€èˆ¬ä¿®æ”¹ä¸º19<br />MaxGCPauseMillisï¼šé»˜è®¤å€¼ä¸º200msï¼Œå•æ¬¡åƒåœ¾å›æ”¶æš‚åœæœ€å¤§æ—¶é—´ï¼Œä¸GCTimeRatioæˆåæ¯”éœ€è¦æŠ˜ä¸­(å½“å †å˜å¤§ï¼Œå•è¯å›æ”¶æ—¶é—´å˜é•¿ï¼Œå½“å †å˜å°ï¼Œåƒåœ¾å›æ”¶å æ¯”å¢åŠ ï¼Œå‡å°‘ååé‡)</p>
<p><a name="XMz8F"></a></p>
<h2 id="å“åº”æ—¶é—´ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨">å“åº”æ—¶é—´ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨</h2>
<ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§çš„åœºæ™¯ï¼Œéœ€è¦å¤šæ ¸cpuæ¥æ”¯æŒ</li>
<li>è®©å•æ¬¡çš„stop the worldçš„æ—¶é—´å°½å¯èƒ½çš„çŸ­ï¼Œé™ä½æ¯æ¬¡åƒåœ¾å›æ”¶æ‰€éœ€è¦çš„æ—¶é—´</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645756703388-0ef82847-33ee-402b-b29e-d6de5b6ded3c-20220312195242020.png" alt="image.png" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645778356967-b6ffad86-4926-4aff-8312-e8ffb0054ff8-20220312195242421.png" alt="image.png" loading="lazy"><br />ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•çš„åƒåœ¾å›æ”¶å™¨ï¼Œä¸”ä¸ºå¹¶å‘çš„ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶å‘è¿›è¡Œ<br />UseConMarkSweepGCï¼šå·¥ä½œåœ¨è€å¹´ä»£ï¼Œä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå¦‚æœå‡ºç°å¹¶å‘å¤±è´¥çš„é—®é¢˜ä½¿ç”¨SerialOldæ¥è¿›è¡Œè¡¥æ•‘ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†çš„æ–¹æ³•<br />UseParNewGCï¼šå·¥ä½œåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å™¨ï¼šå¤åˆ¶ç®—æ³•<br />ParallelGCThreadsï¼šå¹¶è¡Œçš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°<br />ConGCThreadsï¼šå¹¶å‘çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼Œä¸€èˆ¬ä¸ºParallelGCThreadsçš„å››åˆ†ä¹‹ä¸€<br />CMSInitiatingOccupancyFractionï¼šå†…å­˜å æ¯”åˆ°å¤šå°‘ç™¾åˆ†æ¯”æ—¶æ¥è¿›è¡Œåƒåœ¾å›æ”¶<br />CMSScavengeBeforeRemarkï¼šåœ¨é‡æ–°æ ‡è®°å‰å¯¹æ–°ç”Ÿä»£è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œå‡å°‘é‡æ–°æ ‡è®°æ—¶åƒåœ¾å›æ”¶å™¨æ‰«æçš„æ•°é‡ï¼Œå‡å°‘æ—¶é—´</p>
<ol>
<li>è€å¹´ä»£å‘ç”Ÿäº†å†…å­˜ä¸è¶³ï¼Œçº¿ç¨‹åˆ°è¾¾å®‰å…¨ç‚¹æš‚åœ</li>
<li>CMS(ConcMarkSweepGC)è¿›è¡Œåˆå§‹æ ‡è®°ï¼Œä¾ç„¶éœ€è¦stop the world</li>
<li>ç”¨æˆ·çº¿ç¨‹å¯ä»¥å›å¤è¿è¡Œï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å¹¶å‘æ ‡è®°</li>
<li>å¹¶å‘æ ‡è®°åï¼Œstop the world é‡æ–°æ ‡è®°(çº¿ç¨‹ä¸­çš„èµ„æºå¯èƒ½å‘ç”Ÿæ”¹å˜)</li>
<li>ç”¨æˆ·çº¿ç¨‹æ¢å¤è¿è¡Œï¼Œåƒåœ¾å›æ”¶å™¨è¿›è¡Œå¹¶å‘çš„æ¸…ç†</li>
<li>è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½äº§ç”Ÿæ–°çš„åƒåœ¾ï¼Œæˆä¸ºæµ®åŠ¨åƒåœ¾ï¼Œéœ€è¦åœ¨ä¸‹æ¬¡åƒåœ¾å›æ”¶æ—¶è¿›è¡Œå›æ”¶</li>
<li>éœ€è¦é¢„ç•™ç©ºé—´ä¿ç•™æµ®åŠ¨åƒåœ¾æ¥ä¿è¯ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œ</li>
<li>ç¢ç‰‡å¤ªå¤šæ—¶ï¼Œæ— æ³•ç»§ç»­å­˜æ”¾å¯¹è±¡ï¼Œè¿›è¡Œä¸€æ¬¡SerialGC<br>
<a name="KF0BV"></a></li>
</ol>
<h2 id="g1garbage-one">G1(garbage one)</h2>
<p><a name="faPGe"></a></p>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>Garbage First<br />JDK9é»˜è®¤ï¼ŒåºŸå¼ƒäº†CMSåƒåœ¾å›æ”¶å™¨<br>
<a name="fB32P"></a></p>
<h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼Œé»˜è®¤çš„æš‚åœç›®æ ‡ä¸º200ms</li>
<li>è¶…å¤§å †å†…å­˜ï¼Œä¼šå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Region</li>
<li>æ•´ä½“ä¸Šæ˜¯æ ‡è®°+æ•´ç†ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•<br>
<a name="kJcmM"></a></li>
</ul>
<h3 id="ç›¸å…³jvmå‚æ•°">ç›¸å…³JVMå‚æ•°</h3>
<p>-XXï¼š+UseG1GCï¼šJDK9ä»¥åé»˜è®¤å¼€å¯ï¼Œæ— éœ€æ˜¾å¼å¯ç”¨<br />-XXï¼šG1HeapRegionSize=sizeï¼šè®¾å®šRegionå¤§å°<br />-XXï¼šMaxGCPauseMillis=timeï¼šè®¾å®šæš‚åœç›®æ ‡</p>
<p><a name="D2p5U"></a></p>
<h3 id="g1åƒåœ¾å›æ”¶é˜¶æ®µ">G1åƒåœ¾å›æ”¶é˜¶æ®µ</h3>
<figure data-type="image" tabindex="14"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645758891985-f7372bfc-c0ac-46ea-b3e9-18b333c31042-20220312195242727.png" alt="image.png" loading="lazy"></figure>
<ol>
<li>æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†</li>
<li>è€å¹´ä»£å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼Œåœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶çš„åŒæ—¶è¿›è¡Œå¹¶å‘çš„æ ‡è®°</li>
<li>æ··åˆæ”¶é›†ï¼šå¯¹æ–°ç”Ÿä»£å’Œè€å¹´ä»£éƒ½è¿›è¡Œåƒåœ¾æ”¶é›†<br>
<a name="GtQOD"></a></li>
</ol>
<h3 id="youngcollection">YoungCollection</h3>
<ul>
<li>ä¼šSTW</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645759075130-53932929-d02f-4752-aa31-7f6841210f0b-20220312195243029.png" alt="image.png" loading="lazy"><br />æ¯ä¸ªæ–¹æ ¼ä»£è¡¨ä¸€ä¸ªRegion(è¯¥Regionå¯ä»¥ä¸ºä¼Šç”¸å›­æˆ–å¹¸å­˜åŒºæˆ–è€å¹´ä»£)ï¼Œç©ºç™½è¡¨ç¤ºä¸ºç©ºé—²åŒºåŸŸï¼ŒEä»£è¡¨ä¼Šç”¸å›­åŒºåŸŸï¼ŒSä»£è¡¨å¹¸å­˜åŒºï¼ŒOä»£è¡¨è€å¹´ä»£<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645759217710-9c726b97-87eb-4040-9189-5f05a88bb190-20220312195243103.png" alt="image.png" loading="lazy"><br />å½“ä¼Šç”¸å›­å°†è¦è¢«å æ»¡è§¦å‘æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶(YoungCollectionä¹Ÿä¼šSTW)ï¼Œé€šè¿‡å¤åˆ¶ç®—æ³•æ”¾å…¥å¹¸å­˜åŒº<br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645759347346-c12fbed2-184b-473b-acb7-df48fb78b5fb-20220312195243172.png" alt="image.png" loading="lazy"><br />å¹¸å­˜åŒºçš„å¯¹è±¡è¾ƒå¤šï¼Œæˆ–å¹´é¾„è¶…è¿‡é˜ˆå€¼ï¼Œå†æ¬¡è§¦å‘æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œä¸€éƒ¨åˆ†å¯¹è±¡è¿›å…¥åˆ°è€å¹´ä»£ï¼Œå¦ä¸€éƒ¨åˆ†è¢«åƒåœ¾å›æ”¶æˆ–è€…æ‹·è´åˆ°å¦ä¸€ä¸ªå¹¸å­˜åŒº</p>
<p><a name="NvKHq"></a></p>
<h3 id="youngcollection-concurrentmark">YoungCollection + ConcurrentMark</h3>
<ul>
<li>åœ¨YoungGCæ—¶ä¼šè¿›è¡ŒGCRootçš„åˆå§‹æ ‡è®°</li>
<li>è€å¹´ä»£å ç”¨å †ç©ºé—´æ¯”ä¾‹è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œå¹¶å‘æ ‡è®°(ä¸ä¼šSTW)ï¼Œæ¯”ä¾‹ç”±<code>-XX:InitiatingHeapOccupancyPersent=percent</code>ç¡®å®šé»˜è®¤ä¸º45%</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645759737735-56ebe5da-e2a7-4428-a6b9-aa807c61da04-20220312195243887.png" alt="image.png" loading="lazy"><br>
<a name="wkh3j"></a></p>
<h3 id="mixed-collection">Mixed Collection</h3>
<p>ä¼šå¯¹Eã€Sã€Oè¿›è¡Œå…¨é¢çš„åƒåœ¾å›æ”¶</p>
<ul>
<li>æœ€ç»ˆæ ‡è®°(Remark)ä¼šSTWï¼Œå¹¶å‘æ ‡è®°ä¸­å¯èƒ½æ¼æ‰çš„å¯¹è±¡ï¼Œæµ®åŠ¨åƒåœ¾</li>
<li>æ‹·è´å­˜æ´»(Evacuation)ä¼šSTW</li>
<li>æ–°ç”Ÿä»£ï¼šå¤åˆ¶ç®—æ³•(é»‘è‰²ç®­å¤´)</li>
<li>è€å¹´ä»£ï¼šå¤åˆ¶ç®—æ³•(çº¢è‰²ç®­å¤´ï¼ŒG1æ ¹æ®æœ€å¤§æš‚åœæ—¶é—´é€‰æ‹©æ€§åœ°è¿›è¡Œä¸€ä¸ªåƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥ä¸æ˜¯æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé€‰æ‹©åƒåœ¾æœ€å¤šçš„è€å¹´ä»£åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶)</li>
<li>-XX:MaxGCPauseMillis=ms</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645768341109-c20906fb-1d57-4b54-b551-052363331770-20220312195243963.png" alt="image.png" loading="lazy"><br>
<a name="Jadtx"></a></p>
<h3 id="fullgc">FullGC</h3>
<ul>
<li>SerialGC
<ul>
<li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -Minor GC</li>
<li>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -FullGC</li>
</ul>
</li>
<li>ParallelGC
<ul>
<li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -Minor GC</li>
<li>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -FullGC</li>
</ul>
</li>
<li>CMS
<ul>
<li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -Minor GC</li>
<li>è€å¹´ä»£å†…å­˜ä¸è¶³
<ul>
<li>å¹¶å‘æ”¶é›†é˜¶æ®µï¼Œä¸ä¸ºFullGC</li>
<li>å¹¶å‘å¤±è´¥ï¼Œé€€åŒ–ä¸ºä¸²è¡Œåƒåœ¾æ”¶é›†ï¼ŒFullGC</li>
</ul>
</li>
</ul>
</li>
<li>G1
<ul>
<li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† -Minor GC</li>
<li>è€å¹´ä»£å†…å­˜ä¸è¶³
<ul>
<li>å½“è€å¹´ä»£å†…å­˜å æ¯”è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘å¹¶å‘æ ‡è®°é˜¶æ®µåŠæ··åˆæ”¶é›†çš„é˜¶æ®µ
<ul>
<li>å¦‚æœå›æ”¶é€Ÿåº¦é«˜äºçº¿ç¨‹åƒåœ¾äº§ç”Ÿé€Ÿåº¦æ—¶ï¼Œä¸ºå¹¶å‘åƒåœ¾æ”¶é›†</li>
<li>å¦‚æœåƒåœ¾å›æ”¶é€Ÿåº¦ä½äºçº¿ç¨‹åƒåœ¾äº§ç”Ÿé€Ÿåº¦ï¼Œå¹¶å‘æ”¶é›†å¤±è´¥ï¼Œé€€åŒ–ä¸ºå¤šçº¿ç¨‹çš„åƒåœ¾æ”¶é›†-FullGC<br>
<a name="LkYRq"></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="young-collectionè·¨ä»£å¼•ç”¨">Young Collectionè·¨ä»£å¼•ç”¨</h3>
<ul>
<li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨(è€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£)é—®é¢˜</li>
</ul>
<figure data-type="image" tabindex="15"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645769997915-ad60690c-0fbc-4d0c-a9b8-5fac3e907641-20220312195244039.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æŠŠè€å¹´ä»£åˆ†ä¸ºå†æ¬¡æˆåˆ†ä¸ºcardï¼Œå¦‚æœcardä¸­çš„å¯¹è±¡å¼•ç”¨äº†æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥cardè¢«æ ‡è®°ä¸ºè„card</li>
</ul>
<figure data-type="image" tabindex="16"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645770208668-d8f55fad-847d-4aef-b505-5badfbb92038-20220312195244379.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æ–°ç”Ÿä»£ä¸­ç”±Remembered Setè®°å½•Incoming Reference(è®°å½•å¤–éƒ¨å¯¹ä»–çš„å¼•ç”¨)ï¼Œè®°å½•éƒ½æœ‰å“ªäº›è„card</li>
<li>åœ¨å¯¹æ–°ç”Ÿä»£æ ‡è®°æ—¶ï¼Œå…ˆæ ¹æ®Remembered Setæ‰¾åˆ°å¯¹åº”è„cardï¼Œå†ä»è„cardè¿›è¡ŒGCRoot</li>
<li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡post-write barrier + dirty card queueï¼Œæ¥æ ‡è®°è„card(å¼‚æ­¥æ“ä½œï¼Œå…ˆå°†æŒ‡ä»¤æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œä¹‹åç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆè„å¡çš„æ›´æ–°æ“ä½œ)</li>
<li>concurrent refinement threadsæ›´æ–°Remembered Set<br>
<a name="UIARk"></a></li>
</ul>
<h3 id="remarké‡æ–°æ ‡è®°é˜¶æ®µéœ€è¦å¯¹ç€ä¹¦é‡æ–°æ•´ç†">Remark(é‡æ–°æ ‡è®°é˜¶æ®µ)(éœ€è¦å¯¹ç€ä¹¦é‡æ–°æ•´ç†)</h3>
<ul>
<li>pre-write barrier + satb_mark_queue</li>
</ul>
<figure data-type="image" tabindex="17"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645770641393-cb09f5c6-852b-4004-ac69-ca1a3dd1f4d3-20220312195244431.png" alt="image.png" loading="lazy"></figure>
<blockquote>
<p>ä¸Šå›¾è¡¨ç¤ºå¹¶å‘æ ‡è®°é˜¶æ®µæ—¶çš„å¯¹è±¡å¤„ç†çŠ¶æ€ï¼Œ<br>
é»‘è‰²çš„æŒ‡æ ‡è®°å®Œæˆï¼Œä¸”æœ‰å¯¹è±¡å¼•ç”¨çš„ã€‚<br>
ç°è‰²è¡¨ç¤ºæ­£åœ¨æ ‡è®°å¤„ç†çš„<br>
ç™½è‰²è¡¨ç¤ºè¿˜æ²¡æœ‰è¿›è¡Œæ ‡è®°å¤„ç†çš„</p>
</blockquote>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645770970758-e0cbb02c-3920-464d-94c7-3b68bafc079e-20220312195244489.png" alt="image.png" loading="lazy"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645771025992-f5a0b2e2-73a0-4205-bd2d-432523a34291-20220312195244772.png" alt="image.png" loading="lazy"></p>
<ol>
<li>Bæ­£åœ¨å¤„ç†ä¸­ï¼Œåœ¨å¤„ç†åå˜ä¸ºé»‘è‰²</li>
</ol>
<figure data-type="image" tabindex="18"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645771070059-f17553a0-9763-45c6-8653-b050f34b00c2-20220312195244810.png" alt="image.png" loading="lazy"></figure>
<ol start="2">
<li>å¦‚æœAå¼•ç”¨äº†Cï¼Œä½†æ˜¯Aå·²ç»å®Œæˆæ ‡è®°ï¼Œä¸ä¼šå†å¯¹Aè¿›è¡Œæ ‡è®°ï¼Œæ‰€ä»¥æ— æ³•å¯¹Cè¿›è¡Œæ ‡è®°</li>
<li>ä½†æ˜¯Cä¾ç„¶æ˜¯è¢«å¼•ç”¨çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¢«åƒåœ¾å›æ”¶æ‰</li>
</ol>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645771297668-1bb2a57b-1a6c-4a81-8407-9e64d6bf37e9-20220312195244845.png" alt="image.png" loading="lazy"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645771355493-66fd4e17-f307-447a-b4b6-2f1b3221f8ac-20220312195244905.png" alt="image.png" loading="lazy"></p>
<ol start="4">
<li>å½“å¯¹è±¡çš„å¼•ç”¨å‘ç”Ÿæ”¹å˜ï¼Œè§¦å‘å†™å±éšœä»£ç ï¼Œå°†è¯¥å¯¹è±¡æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç½®ä¸ºç°è‰²ã€‚åœ¨è¿›å…¥åˆ°é‡æ–°æ ‡è®°é˜¶æ®µæ—¶ï¼Œå¯¹è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°è¿›è¡Œä¸€ä¸ªæ£€æŸ¥<br>
<a name="I1ekJ"></a></li>
</ol>
<h3 id="jdk8u20å­—ç¬¦ä¸²å»é‡">JDK8u20å­—ç¬¦ä¸²å»é‡</h3>
<ul>
<li>ä¼˜ç‚¹ï¼šèŠ‚çœå¤§é‡å†…å­˜</li>
<li>ç¼ºç‚¹ï¼šç•¥å¾®å¤šå ç”¨äº†CPUæ—¶é—´ï¼Œæ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ </li>
</ul>
<p>-XX:+UseStringDeduplication</p>
<pre><code class="language-java">String s1 = new String(&quot;hello&quot;);//char[]{'h','e','l','l','o'}
String s2 = new String(&quot;hello&quot;);//char[]{'h','e','l','l','o'}
</code></pre>
<ul>
<li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li>
<li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦ä¸²é‡å¤</li>
<li>å¦‚æœå®ƒä»¬å€¼ä¸€æ ·ï¼Œè®©å®ƒä»¬å¼•ç”¨åŒä¸€ä¸ªchar[]</li>
<li>æ³¨æ„ï¼Œä¸String.intern()ä¸ä¸€æ ·
<ul>
<li>String.intern()å…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li>
<li>è€Œå­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char<a href="String%E5%AF%B9%E8%B1%A1%E5%86%85%E7%9A%84char%5B%5D%E6%95%B0%E7%BB%84%E5%BC%95%E7%94%A8%E6%94%B9%E5%8F%98%EF%BC%8CString%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8%E4%B8%8D%E5%8F%98"></a></li>
<li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²è¡¨<br>
<a name="fLgOO"></a></li>
</ul>
</li>
</ul>
<h3 id="jdk8u40å¹¶å‘æ ‡è®°ç±»å¸è½½">JDK8u40å¹¶å‘æ ‡è®°ç±»å¸è½½</h3>
<p>æ‰€æœ‰å¯¹è±¡éƒ½ç»è¿‡å¹¶å‘æ ‡è®°åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸å†ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»<br />-XX:+ClassUnloadingWithConcurrentMarké»˜è®¤å¯ç”¨<br>
<a name="GTtk1"></a></p>
<h3 id="jdk8u60å›æ”¶å·¨å‹å¯¹è±¡">JDK8u60å›æ”¶å·¨å‹å¯¹è±¡</h3>
<figure data-type="image" tabindex="19"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645773276792-ac88935c-20ea-45ae-aecd-5b0f787258fd-20220312195245215.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>ä¸€ä¸ªå¯¹è±¡å¤§äºRegionçš„ä¸€åŠæ—¶ï¼Œç§°ä¹‹ä¸ºå·¨å‹å¯¹è±¡</li>
<li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li>
<li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li>
<li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå½“å·¨å‹å¯¹è±¡çš„incomingä¸º0æ—¶ï¼Œå·¨å‹å¯¹è±¡å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰<br>
<a name="rqruU"></a></li>
</ul>
<h3 id="jdk9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´">JDK9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´</h3>
<ul>
<li>å¹¶å‘æ ‡è®°å¿…é¡»åœ¨å †ç©ºé—´å æ»¡å‰å®Œæˆï¼Œå¦åˆ™é€€åŒ–ä¸ºFullGC</li>
<li>JDK9ä¹‹å‰éœ€è¦ä½¿ç”¨<code>-XX:InitiatingHeapOccupancyPercent</code></li>
<li>JDK9å¯ä»¥åŠ¨æ€è°ƒæ•´
<ul>
<li><code>-XX:InitiatingHeapOccupancyPercent</code>ç”¨æ¥è®¾ç½®åˆå§‹å€¼</li>
<li>è¿›è¡Œæ•°æ®é‡‡æ ·å¹¶åŠ¨æ€è°ƒæ•´</li>
<li>æ€»ä¼šæ·»åŠ ä¸€ä¸ªå®‰å…¨çš„å­˜æ¡£ç©ºé—´<br>
<a name="joAjF"></a></li>
</ul>
</li>
</ul>
<h1 id="åƒåœ¾å›æ”¶è°ƒä¼˜">åƒåœ¾å›æ”¶è°ƒä¼˜</h1>
<p><a name="HjJ1t"></a></p>
<h2 id="è°ƒä¼˜çš„é¢†åŸŸ">è°ƒä¼˜çš„é¢†åŸŸ</h2>
<ul>
<li>å†…å­˜</li>
<li>é”ç«äº‰</li>
<li>cpuå ç”¨</li>
<li>io<br>
<a name="cu0gm"></a></li>
</ul>
<h2 id="ç¡®å®šè°ƒä¼˜ç›®æ ‡">ç¡®å®šè°ƒä¼˜ç›®æ ‡</h2>
<ul>
<li>ä½å»¶è¿Ÿè¿˜æ˜¯é«˜ååé‡ï¼Œé€‰æ‹©åˆé€‚çš„å›æ”¶ç«™
<ul>
<li>ç§‘å­¦è®¡ç®—é€‚åˆé«˜ååé‡</li>
<li>webé¡¹ç›®é€‚åˆä½å»¶è¿Ÿ</li>
</ul>
</li>
<li>é€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨
<ul>
<li>ä½å»¶è¿Ÿï¼šCMSã€G1ã€ZGC</li>
<li>é«˜ååé‡ï¼šParallelGC</li>
</ul>
</li>
<li>å¯ä»¥é€šè¿‡æ›´æ¢è™šæ‹Ÿæœºæ¥è¿›è¡Œè°ƒä¼˜ï¼šä¾‹å¦‚ï¼ŒZingè™šæ‹Ÿæœº<br>
<a name="rSxQG"></a></li>
</ul>
<h2 id="æœ€å¿«çš„gcæ˜¯ä¸å‘ç”Ÿgc">æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h2>
<ul>
<li>æŸ¥çœ‹FullGCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘å¦‚ä¸‹çš„é—®é¢˜</li>
<li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤š
<ul>
<li>resultSet = statement.executeQuery(&quot;select * from è¡¨&quot;)</li>
</ul>
</li>
<li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿
<ul>
<li>å¯¹è±¡å›¾</li>
<li>å¯¹è±¡å¤§å°</li>
</ul>
</li>
<li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼
<ul>
<li>static Map map ä¸€ç›´å‘é™æ€mapä¸­å­˜æ”¾å¯¹è±¡</li>
<li>ç†Ÿç»ƒä½¿ç”¨è½¯å¼±å¼•ç”¨ï¼Œä½¿ç”¨ç¼“å­˜æ—¶ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç¼“å­˜å®ç°<br>
<a name="ww9gt"></a></li>
</ul>
</li>
</ul>
<h2 id="æ–°ç”Ÿä»£è°ƒä¼˜">æ–°ç”Ÿä»£è°ƒä¼˜</h2>
<p><a name="z5bCA"></a></p>
<h3 id="æ–°ç”Ÿä»£ç‰¹ç‚¹">æ–°ç”Ÿä»£ç‰¹ç‚¹</h3>
<ul>
<li>æ‰€æœ‰çš„newæ“ä½œçš„å†…å­˜åˆ†é…éå¸¸å»‰ä»·
<ul>
<li>TLAB thread-local allocation buffer
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåœ¨ä¼Šç”¸å›­ä¸­è¢«åˆ†é…ä¸€å—ç§æœ‰çš„åŒºåŸŸ</li>
<li>å½“çº¿ç¨‹newä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœTLABæœ‰ç©ºé—´ï¼Œé‚£ä¹ˆä¼˜å…ˆåœ¨TLABåˆ†é…å†…å­˜</li>
<li>å‡å°‘äº†çº¿ç¨‹åˆ†é…å†…å­˜æ—¶çš„å†²çª</li>
</ul>
</li>
</ul>
</li>
<li>æ­»äº¡å¯¹è±¡çš„å›æ”¶ä»£ä»·æ˜¯é›¶</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»</li>
<li>MinorGCçš„æ—¶é—´è¿œè¿œä½äºFullGC<br>
<a name="kKa7V"></a></li>
</ul>
<h3 id="è°ƒä¼˜">è°ƒä¼˜</h3>
<p>-Xmn(è®¾ç½®æ–°ç”Ÿä»£çš„åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°)ï¼šOracleå»ºè®®æ–°ç”Ÿä»£å¤§å°ä¸ºæ•´ä¸ªå †å¤§å°çš„25%-50%ï¼Œåˆšå¼€å§‹æ—¶éšç€æ–°ç”Ÿä»£çš„å®¹é‡å¢å¤§ï¼Œååé‡é€æ¸å‡é«˜ï¼Œä½†æ˜¯åˆ°è¾¾ä¸€å®šå¤§å°åï¼Œååé‡éšç€æ–°ç”Ÿä»£å®¹é‡å¢å¤§ä¼šå‡å°‘(ä½†æ˜¯å‡å°‘çš„ç¨‹åº¦è¾ƒå°)(æ–°ç”Ÿä»£å®¹é‡å¤ªå¤§ä¼šå¯¼è‡´è€å¹´ä»£å®¹é‡å˜å°‘ï¼Œå®¹æ˜“è§¦å‘FullGCï¼Œå¯¼è‡´åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´å˜é•¿)ã€‚å»ºè®®è®¾ç½®ä¸º<code>å¹¶å‘é‡*(è¯·æ±‚å“åº”è¿‡ç¨‹ä¸­äº§ç”Ÿå¯¹è±¡)</code><br />å¹¸å­˜åŒºï¼šå¤§å°èƒ½ä¿ç•™<code>å½“å‰æ´»è·ƒå¯¹è±¡+éœ€è¦æ™‹å‡å¯¹è±¡</code> <br />å¹¸å­˜åŒºæ™‹å‡é˜ˆå€¼ï¼šæ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»å¯¹è±¡å°½å¿«æ™‹å‡<br />-XX:MaxTenuringThreshold=thresholdï¼šè°ƒæ•´æœ€å¤§æ™‹å‡é˜ˆå€¼<br />-XX:+PrintTenuringDistributionï¼šæ˜¾ç¤ºæ™‹å‡è¯¦ç»†ä¿¡æ¯<br>
<a name="naN9Q"></a></p>
<h2 id="è€å¹´ä»£è°ƒä¼˜">è€å¹´ä»£è°ƒä¼˜</h2>
<p>ä»¥CMSä¸ºä¾‹</p>
<ul>
<li>CMSçš„è€å¹´ä»£å†…å­˜è¶Šå¤§è¶Šå¥½</li>
<li>å…ˆå°è¯•ä¸åšè°ƒä¼˜ï¼Œå¦‚æœæ²¡æœ‰FullGCé‚£ä¹ˆå·²ç»å¾ˆå¥½äº†ï¼Œå¦åˆ™å…ˆå°è¯•è°ƒä¼˜æ–°ç”Ÿä»£</li>
<li>è§‚å¯Ÿå‘ç”ŸFullGCæ—¶è€å¹´ä»£å†…å­˜å ç”¨ï¼Œå°†è€å¹´ä»£å†…å­˜é¢„è®¾è°ƒå¤§1/4-1/3
<ul>
<li>-XX:CMSInitiatingOccupancyFraction=percentè¶…è¿‡ç™¾åˆ†æ¯”è¿›è¡ŒCMSåƒåœ¾å›æ”¶<br>
<a name="i48zJ"></a></li>
</ul>
</li>
</ul>
<h2 id="è°ƒä¼˜æ¡ˆä¾‹">è°ƒä¼˜æ¡ˆä¾‹</h2>
<p><a name="jS1vq"></a></p>
<h3 id="1-fullgcå’Œminorgcé¢‘ç¹ä¸”minorgcæ›´é¢‘ç¹">1. FullGCå’ŒMinorGCé¢‘ç¹ï¼Œä¸”MinorGCæ›´é¢‘ç¹</h3>
<p>æ–°ç”Ÿä»£ç©ºé—´å°ï¼Œä¸”ä¼šé€ æˆç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡è¿›å…¥åˆ°è€å¹´ä»£ä»è€Œå¼•å‘FullGC<br />é€šè¿‡å¢å¤§æ–°ç”Ÿä»£ç©ºé—´ï¼ŒåŒæ—¶æé«˜å¹¸å­˜åŒºæ™‹å‡é˜ˆå€¼ï¼Œè®©ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ç•™åœ¨æ–°ç”Ÿä»£ä¸­<br>
<a name="BRQdA"></a></p>
<h3 id="2è¯·æ±‚é«˜å³°æœŸå‘ç”Ÿfullgcå•è¯æš‚åœæ—¶é—´ç‰¹åˆ«é•¿cms">2.è¯·æ±‚é«˜å³°æœŸå‘ç”ŸFullGCï¼Œå•è¯æš‚åœæ—¶é—´ç‰¹åˆ«é•¿(CMS)</h3>
<p>æŸ¥çœ‹GCè¯¦æƒ…ï¼Œå‘ç°é‡æ–°æ ‡è®°è€—æ—¶è¾ƒå¤š<br />åœ¨é‡æ–°æ ‡è®°å‰è¿›è¡Œä¸€æ¬¡æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶<br />-XX:CMSScavengeBeforeRemark<br>
<a name="OQZGJ"></a></p>
<h3 id="3è€å¹´ä»£å……è£•æƒ…å†µä¸‹å‘ç”Ÿfullgcjdk17-cms">3.è€å¹´ä»£å……è£•æƒ…å†µä¸‹ï¼Œå‘ç”ŸFullGC(JDK1.7 CMS)</h3>
<p>æ°¸ä¹…å¸¦ç©ºé—´ä¸è¶³</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVMå†…å­˜ç»“æ„]]></title>
        <id>https://yeyuan1107.github.io/post/jvm-nei-cun-jie-gou/</id>
        <link href="https://yeyuan1107.github.io/post/jvm-nei-cun-jie-gou/">
        </link>
        <updated>2022-02-18T13:10:04.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨</h1>
<p><a name="BVQjL"></a></p>
<p>ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„å †ã€æ–¹æ³•åŒºéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„</p>
<h2 id="å®šä¹‰">å®šä¹‰</h2>
<p>Program Counter Register(ç¨‹åºè®¡æ•°å™¨)(å¯„å­˜å™¨)<br>
<a name="gBUBr"></a></p>
<h2 id="ä½œç”¨">ä½œç”¨</h2>
<figure data-type="image" tabindex="1"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645583767626-1bcd7879-043b-42d8-8558-02c2302e76fd-20220312195126176.png" alt="iShot2022-02-22 11.07.15.png" loading="lazy"></figure>
<ul>
<li>å³ä¾§ä¸ºJavaæºä»£ç </li>
<li>å·¦ä¾§ä¸ºäºŒè¿›åˆ¶å­—èŠ‚ç ï¼Œå¯¹åº”æ¯ä¸€æ¡jvmæŒ‡ä»¤ï¼Œ<strong>jvmæŒ‡ä»¤éœ€è¦é€šè¿‡è§£é‡Šå™¨ç”Ÿæˆæœºå™¨ç ï¼Œå†å°†æœºå™¨ç äº¤ç»™CPUæ¥æ‰§è¡Œ</strong></li>
<li>ç¨‹åºè®¡æ•°å™¨ï¼šè®°ä½ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œå½“å‰æŒ‡ä»¤æ‰§è¡Œç»“æŸåï¼Œè§£é‡Šå™¨åˆ°ç¨‹åºè®¡æ•°å™¨è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œæ¥ç€è¿›è¡Œæ‰§è¡Œ</li>
<li>ç¨‹åºè®¡æ•°å™¨ï¼šç‰©ç†(ç¡¬ä»¶)ä¸Šæ˜¯é€šè¿‡å¯„å­˜å™¨æ¥å®ç°çš„<br>
<a name="aG3Ta"></a></li>
</ul>
<h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2>
<ol>
<li>çº¿ç¨‹ç§æœ‰çš„ï¼Œå±äºå½“å‰çº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ—¶é—´ç‰‡è€—å°½ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰çº¿ç¨‹çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼Œç­‰åˆ°å½“å‰çº¿ç¨‹è·å¾—CPUæ—¶ç»§ç»­è¿›è¡Œæ‰§è¡Œ</li>
<li>å”¯ä¸€ä¸€ä¸ªä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡ºçš„åŒº<br>
<a name="LX2CM"></a></li>
</ol>
<h1 id="è™šæ‹Ÿæœºæ ˆ">è™šæ‹Ÿæœºæ ˆ</h1>
<pre><code class="language-java">-XssæŒ‡å®šè™šæ‹Ÿæœºæ ˆå¤§å°
</code></pre>
<ul>
<li><strong>è™šæ‹Ÿæœºæ ˆ</strong>æŒ‡çš„æ˜¯çº¿ç¨‹è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œå¤šä¸ªçº¿ç¨‹å°±æœ‰å¤šä¸ªè™šæ‹Ÿæœºæ ˆæ ˆå†…çš„å…ƒç´ ç§°ä¹‹ä¸ºæ ˆå¸§ã€‚</li>
<li><strong>æ ˆå¸§</strong>æŒ‡çš„æ˜¯æ¯ä¸ªæ–¹æ³•è¿è¡Œæ—¶éœ€è¦çš„å†…å­˜(æ–¹æ³•å‚æ•°ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿”å›åœ°å€ç­‰)å½“çº¿ç¨‹<strong>è°ƒç”¨ä¸€ä¸ªæ–¹æ³•</strong>æ—¶ï¼Œè™šæ‹Ÿæœºæ ˆä¸ºè¯¥æ–¹æ³•åˆ†é…æ ˆå¸§ç©ºé—´ï¼Œå¹¶å°†æ ˆå¸§å‹å…¥è™šæ‹Ÿæœºæ ˆä¸­ï¼Œç­‰æ–¹æ³•ç»“æŸæ—¶å°†è¯¥æ–¹æ³•å¯¹åº”çš„æ ˆå¸§å¼¹å‡ºæ ˆ<br>
<a name="VAkBD"></a></li>
</ul>
<h2 id="å®šä¹‰-2">å®šä¹‰</h2>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ ˆ</li>
<li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§(Frame)ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</li>
<li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li>
</ul>
<blockquote>
<p>åƒåœ¾å›æ”¶ä¸æ¶‰åŠæ ˆå†…å­˜ï¼Œåƒåœ¾å›æ”¶åªæ¶‰åŠå †å†…å­˜<br />æ ˆå†…å­˜è¶Šå¤§çº¿ç¨‹æ•°è¶Šå°‘ï¼Œå¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½<br />æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡(<strong>ä¸é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œé€ƒç¦»ä½œç”¨èŒƒå›´çš„è¡Œä¸ºæ¯”å¦‚ä½œä¸ºå‚æ•°ä¼ å…¥æˆ–è€…ä½œä¸ºè¿”å›å€¼ä¼ å‡º</strong>)æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå°±æ— é¡»è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä»–æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åä¹‹ï¼Œå¦‚æœä¸ºçº¿ç¨‹å…±äº«çš„ï¼Œå°±éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜<br />å¦‚æœå±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»äº†æ–¹æ³•ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¦‚æœä¸ºåŸºæœ¬æ•°æ®ç±»å‹å˜é‡ï¼Œåˆ™ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
</blockquote>
<p><a name="eEKHZ"></a></p>
<h2 id="æ ˆå†…å­˜æº¢å‡ºstackoverflowerror">æ ˆå†…å­˜æº¢å‡º(StackOverflowError)</h2>
<ol>
<li>æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º</li>
<li>æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º<br>
<a name="LODNb"></a></li>
</ol>
<h3 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­">çº¿ç¨‹è¿è¡Œè¯Šæ–­</h3>
<p><a name="Hw0CJ"></a></p>
<h4 id="æ¡ˆä¾‹ä¸€cpuå ç”¨è¿‡å¤š">æ¡ˆä¾‹ä¸€ï¼šCPUå ç”¨è¿‡å¤š</h4>
<ul>
<li>ç”¨topå‘½ä»¤å®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜</li>
<li>ps H -eo pidmtid,%cpu | grep è¿›ç¨‹id() ç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜</li>
<li>jstack è¿›ç¨‹id
<ul>
<li>å¯ä»¥æ ¹æ®çº¿ç¨‹idæ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œæ•°<br>
<a name="pmQ8C"></a></li>
</ul>
</li>
</ul>
<h4 id="æ¡ˆä¾‹äºŒç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ">æ¡ˆä¾‹äºŒï¼šç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ</h4>
<ul>
<li>jstackæŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ­»é”<br>
<a name="rEdZ1"></a></li>
</ul>
<h1 id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</h1>
<p>ç»™æœ¬åœ°æ–¹æ³•çš„è¿è¡Œ(æœ‰ä¸€äº›æ–¹æ³•æ— æ³•ä½¿ç”¨Javaå®ç°ï¼Œä½¿ç”¨æœ¬åœ°C++ä»£ç å®ç°)ï¼Œæä¾›å†…å­˜ç©ºé—´<br>
<a name="GaEUb"></a></p>
<h1 id="å †heap">å †(Heap)</h1>
<pre><code class="language-java">-XmxæŒ‡å®šå †ç©ºé—´å¤§å°
</code></pre>
<p><a name="AV6XS"></a></p>
<h2 id="å®šä¹‰-3">å®šä¹‰</h2>
<p>é€šè¿‡newå…³é”®å­—åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šä½¿ç”¨å †</p>
<blockquote>
<p>ç‰¹ç‚¹<br />ä»–æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå †ä¸­å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜<br />æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</p>
</blockquote>
<p><a name="td14f"></a></p>
<h2 id="å †å†…å­˜æº¢å‡ºoutofmemoryerror-oom">å †å†…å­˜æº¢å‡º(OutOfMemoryError OOM)</h2>
<p><a name="MH1HW"></a></p>
<h2 id="å †å†…å­˜è¯Šæ–­">å †å†…å­˜è¯Šæ–­</h2>
<ol>
<li>jpså·¥å…·
<ul>
<li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº›javaè¿›ç¨‹</li>
</ul>
</li>
<li>jmapå·¥å…·
<ul>
<li>æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ</li>
<li><code>jmap -heap è¿›ç¨‹id</code></li>
<li>Eden Space(æ–°ç”Ÿä»£)ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡ä½¿ç”¨çš„åŒºåŸŸ</li>
</ul>
</li>
<li>jconsoleå·¥å…·
<ul>
<li>å›¾å½¢ç•Œé¢çš„ï¼Œå¤šåŠŸèƒ½çš„æ£€æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹<br>
<a name="F3H9e"></a></li>
</ul>
</li>
</ol>
<h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3>
<p><a name="nmmT4"></a></p>
<h4 id="åƒåœ¾å›æ”¶åå†…å­˜å ç”¨ä»ç„¶å¾ˆé«˜">åƒåœ¾å›æ”¶åï¼Œå†…å­˜å ç”¨ä»ç„¶å¾ˆé«˜</h4>
<p>jvisualvm -&gt; å †dump -&gt; æœ€å¤§çš„å¯¹è±¡<br>
<a name="LyLHY"></a></p>
<h1 id="æ–¹æ³•åŒº">æ–¹æ³•åŒº</h1>
<pre><code class="language-java">-XX:MaxMetaspaceSize=8m//æŒ‡å®šå…ƒç©ºé—´å¤§å°
</code></pre>
<p><a name="y7tTp"></a></p>
<h2 id="å®šä¹‰-4">å®šä¹‰</h2>
<ul>
<li>æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œåœ¨æ–¹æ³•åŒºä¸­å­˜å‚¨äº†ç±»çš„ç»“æ„çš„æœ‰å…³ä¿¡æ¯(Fieldã€æ–¹æ³•æ•°æ®ã€æ–¹æ³•åŠæ„é€ å™¨æ–¹æ³•çš„ä»£ç ã€è¿è¡Œæ—¶å¸¸äº®æ± )</li>
<li>æ–¹æ³•åŒºåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œé€»è¾‘ä¸Šæ˜¯å †çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†(ä¸åŒå‚å®¶å®ç°ä¸åŒ)</li>
<li>æ–¹æ³•åŒºä¹Ÿä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºé”™è¯¯<br>
<a name="wXjvM"></a></li>
</ul>
<h2 id="ç»„æˆ">ç»„æˆ</h2>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645584184422-6dc5d964-688d-4544-9f7a-cb26ea82942d-20220312195126578.png" alt="iShot2022-02-22 16.00.35.png" loading="lazy"><br />å¸¸é‡æ± (è¿è¡Œæ—¶å¸¸é‡æ± )ï¼š</p>
<ul>
<li>ä¸€ä¸ªç±»è¦è¿è¡Œéœ€è¦å…ˆç¼–è¯‘æˆäºŒè¿›åˆ¶å­—èŠ‚ç (äºŒè¿›åˆ¶å­—èŠ‚ç ä¸­åŒ…å«ï¼šç±»çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¸¸é‡æ± ï¼Œç±»çš„æ–¹æ³•å®šä¹‰ï¼ŒåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤)</li>
<li>javap -v xxx.class æ˜¾ç¤ºåç¼–è¯‘åçš„è¯¦ç»†ä¿¡æ¯ <code>#xxä»£è¡¨ä»å¸¸é‡æ± ä¸­å¯»æ‰¾ç¼–å·ä¸ºxxçš„å†…å®¹</code></li>
<li><strong>å¸¸é‡æ± </strong>ï¼Œå°±æ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯</li>
<li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œä»–çš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·<code>#xx</code>åœ°å€å˜ä¸ºçœŸå®åœ°å€<br>
<a name="VRmXm"></a></li>
</ul>
<h2 id="æ–¹æ³•åŒºå†…å­˜æº¢å‡ºoutofmemoryerror-oom">æ–¹æ³•åŒºå†…å­˜æº¢å‡º(OutOfMemoryError OOM)</h2>
<ol>
<li>1.8ä»¥å‰ä¼šå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º
<ul>
<li>OutOfMemoryError:PermGen space</li>
<li>-XX:MaxPermSize=8m</li>
</ul>
</li>
<li>1.8ä¹‹åä¼šå¯¼è‡´å…ƒç©ºé—´å†…å­˜æº¢å‡º
<ul>
<li>OutOfMemoryError:Metaspace</li>
<li>-XX:MaxMetaspaceSize=8m</li>
</ul>
</li>
</ol>
<p>å¸¸è§åœºæ™¯ï¼š</p>
<ul>
<li>Springï¼šcglibåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç </li>
<li>MyBatisï¼šcglibåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç </li>
<li>ä¸Šè¿°ä¸¤ç§æƒ…å†µå¯¼è‡´æ–¹æ³•åŒºç±»ä¸åœåŠ è½½ï¼Œä»è€Œå¯¼è‡´OOM<br>
<a name="uGQxj"></a></li>
</ul>
<h2 id="è¿è¡Œæ—¶å¸¸é‡æ± ">è¿è¡Œæ—¶å¸¸é‡æ± </h2>
<ul>
<li><strong>å¸¸é‡æ± </strong>ï¼Œå°±æ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ä¿¡æ¯</li>
<li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œä»–çš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·<code>#xx</code>åœ°å€å˜ä¸ºçœŸå®åœ°å€<br>
<a name="nH56Q"></a></li>
</ul>
<h2 id="stringtable">StringTable</h2>
<ul>
<li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰å˜ä¸ºå¯¹è±¡</li>
<li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilder(1.8)</li>
<li>å­—ç¬¦ä¸²å¸¸é‡å‡­å€Ÿçš„åŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</li>
<li>å¯ä»¥ä½¿ç”¨internæ–¹æ³•ï¼Œä¸»åŠ¨å°† ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± 
<ul>
<li><strong>1.8</strong>intern()å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ï¼Œæœ€ç»ˆéƒ½è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡ã€‚å¦‚æœæˆåŠŸæ”¾å…¥é‚£ä¹ˆå½“å‰å¯¹è±¡çš„åœ°å€ä¸å¸¸é‡æ± ä¸­çš„åœ°å€å˜ä¸ºç›¸åŒï¼Œå¦åˆ™ä¸ä¼šå‘ç”Ÿå˜åŒ–</li>
<li><strong>1.6</strong>intern()å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œç„¶åæ”¾å…¥ä¸²æ± ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ï¼Œæœ€ç»ˆéƒ½è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡ã€‚ä¸ç®¡æˆåŠŸæ”¾å…¥ä¸å¦é‚£ä¹ˆå½“å‰å¯¹è±¡çš„åœ°å€ä¸å¸¸é‡æ± ä¸­çš„åœ°å€å‡ä¸ç›¸åŒ</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// 1. å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿™æ—¶&quot;a&quot;ã€&quot;b&quot;ã€&quot;ab&quot;éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œè¿˜æ²¡æœ‰å˜ä¸ºJavaå­—ç¬¦ä¸²å¯¹è±¡
// 2. ldc #2 ä¼šæŠŠ a ç¬¦å·å˜ä¸º&quot;a&quot;å­—ç¬¦ä¸²å¯¹è±¡ï¼ŒåŒæ—¶å‡†å¤‡å¥½ä¸€å¤„ç©ºé—´ï¼Œç§°ä¸ºStringTable[ ]\(HashTableç»“æ„æ— æ³•æ‰©å®¹)
// 3. ä»StringTable[ ]ä¸­å¯»æ‰¾ a å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ”¾å…¥åˆ°StringTableä¸­(ç”¨åˆ°æ‰ä¼šåˆ›å»ºå¹¶æ”¾åˆ°StringTableä¸­ï¼Œç”¨ä¸åˆ°å°±ä¸ä¼šåˆ›å»º)
// 4. ldc #3 ä¼šæŠŠ b ç¬¦å·å˜ä¸º&quot;b&quot;å­—ç¬¦ä¸²å¯¹è±¡
// 5. ä»StringTable[ ]ä¸­å¯»æ‰¾ b å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ”¾å…¥åˆ°StringTableä¸­
// 6. ldc #4 ä¼šæŠŠ ab ç¬¦å·å˜ä¸º&quot;ab&quot;å­—ç¬¦ä¸²å¯¹è±¡
// 7. ä»StringTable[ ]ä¸­å¯»æ‰¾ ab å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ”¾å…¥åˆ°StringTableä¸­
String s1 = &quot;a&quot;;
String s2 = &quot;b&quot;;
String s3 = &quot;ab&quot;;
// new StringBuilder().append(s1).append(s2).toString()
// toString()ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå˜é‡ new String(&quot;ab&quot;) å¹¶å­˜å…¥åˆ°s4ä¸­
// s3æ˜¯StringTableä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œs4æ˜¯ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡å­˜æ”¾åœ¨å †ä¸­
String s4 = s1 + s2;
// javacåœ¨ç¼–è¯‘æœŸé—´çš„ä¼˜åŒ–ï¼Œç»“æœå·²ç»åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šä¸º&quot;ab&quot;ä¸å¯èƒ½å†å˜åŒ–
String s5 = &quot;a&quot; + &quot;b&quot;;
String s6 = s4.intern();

System.out.println(s3 == s4); //false
System.out.println(s3 == s5); //true
System.out.println(s3 == s6); //true


// æ‰§è¡Œå®Œè¯¥è¡Œä»£ç åStringTableä¸­æœ‰&quot;c&quot;å’Œ&quot;d&quot;
// new String(&quot;c&quot;) æ˜¯newäº†ä¸€ä¸ªStringå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜æ”¾åœ¨å †ä¸­
// new String(&quot;d&quot;) æ˜¯newäº†ä¸€ä¸ªStringå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜æ”¾åœ¨å †ä¸­
// x2 = new String(&quot;cd&quot;) æ”¾åœ¨å †ä¸­ï¼Œå¹¶ä¸æ”¾åœ¨ä¸²æ± ä¸­
String x2 = new String(&quot;c&quot;) + new String(&quot;d&quot;);
String x1 = &quot;cd&quot;;
// intern()å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ï¼Œæœ€ç»ˆéƒ½è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡
// å¦‚æœæˆåŠŸæ”¾å…¥é‚£ä¹ˆx2çš„åœ°å€æ”¹ä¸ºå¸¸é‡æ± ä¸­çš„åœ°å€ï¼Œå¦åˆ™ä¸ä¼šå‘ç”Ÿå˜åŒ–
x2.intern(); 

System.out.println(x1 == x2); //false
// å¦‚æœå€’æ•°ä¸¤è¡Œä»£ç äº’æ¢ä½ç½® é‚£ä¹ˆä¸ºtrue ã€‚ä½†æ˜¯å¦‚æœæ˜¯Java6åŠä¹‹å‰ä¾ç„¶ä¸ºfalse
</code></pre>
<p><a name="czz9Y"></a></p>
<h3 id="stringtableä½ç½®">StringTableä½ç½®</h3>
<figure data-type="image" tabindex="2"><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645584899069-917db5ed-1144-410a-a0b4-90d13902671c-20220312195126888.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>1.6åŠä¹‹å‰StringTableåœ¨å¸¸é‡æ± ä¸­
<ul>
<li>æ°¸ä¹…ä»£åƒåœ¾å›æ”¶æ•ˆç‡è¾ƒä½</li>
<li>éœ€è¦ä½¿ç”¨Full GCæ‰è¿›è¡Œæ°¸ä¹…ä»£çš„åƒåœ¾å›æ”¶</li>
<li>Full GCåªæœ‰åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶æ‰ä¼šè§¦å‘</li>
</ul>
</li>
<li>1.7åŠä¹‹åStringTableåœ¨å †ä¸­
<ul>
<li>å †ä¸­åƒåœ¾å›æ”¶æ•ˆç‡é«˜</li>
<li>Minor GCè¿›è¡Œå †ä¸­çš„åƒåœ¾å›æ”¶</li>
<li>å‡è½»äº†å­—ç¬¦ä¸²å¯¹æ–¹æ³•åŒºçš„å†…å­˜å ç”¨<br>
<a name="yo9FR"></a></li>
</ul>
</li>
</ul>
<h3 id="stringtableåƒåœ¾å›æ”¶">StringTableåƒåœ¾å›æ”¶</h3>
<pre><code class="language-java">-Xmx1m -XX:+PringStringTableStatisticså¼€å¯StringTableç»Ÿè®¡åŠŸèƒ½ -Xx:+PrintGCDetails -verbose:gcæ‰“å°åƒåœ¾å›æ”¶çš„è¯¦ç»†ä¿¡æ¯
</code></pre>
<ul>
<li>StringTableä¸­ä¹Ÿå­˜åœ¨åƒåœ¾å›æ”¶ï¼Œå¹¶ä¸ä¼šä¸€ç›´ä¿å­˜<br>
<a name="g9gOx"></a></li>
</ul>
<h3 id="stringtableæ€§èƒ½è°ƒä¼˜">StringTableæ€§èƒ½è°ƒä¼˜</h3>
<pre><code class="language-java">-Xx:StringTableSize=200000 //åº•å±‚ä¸ºHashTableä¸ºæ•°ç»„å’Œé“¾è¡¨ç›¸ç»“åˆï¼Œè°ƒæ•´æ•°ç»„(æ¡¶)å¤§å°
</code></pre>
<ul>
<li>è°ƒæ•´-Xx:StringTableSize=æ¡¶ä¸ªæ•°</li>
<li>è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± ï¼Œå¦‚æœæœ‰å¤§é‡å­—ç¬¦ä¸²é‡å¤ï¼Œå¯ä»¥å°†é‡å¤çš„å­—ç¬¦ä¸²å…¥æ± ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´<br>
<a name="uSm4E"></a></li>
</ul>
<h1 id="ç›´æ¥å†…å­˜direct-memory">ç›´æ¥å†…å­˜(Direct Memory)</h1>
<p><a name="YHLoA"></a></p>
<h2 id="å®šä¹‰-5">å®šä¹‰</h2>
<ul>
<li>å¸¸è§äºNIOæ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº(ByteBuffer)</li>
<li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†æ˜¯ã€è¯»å†™æ€§èƒ½é«˜</li>
<li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645598236995-08c40bc6-edb7-42f0-b2f3-6d046b625007-20220312195126935.png" alt="image.png" loading="lazy">     <img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645599130121-94f43755-ab9d-45bc-85c3-c0253472f17b-20220312195127322.png" alt="image.png" loading="lazy"></p>
<ul>
<li>ä¸ä½¿ç”¨ç›´æ¥å†…å­˜ï¼šjavaæ— æ³•ç›´æ¥è®¿é—®ç³»ç»Ÿç¼“å­˜åŒºï¼Œéœ€è¦å…ˆä»ç³»ç»Ÿç¼“å­˜åŒºè¯»å…¥åˆ°javaç¼“å­˜åŒºä¸­ï¼Œå†è¯»å…¥åˆ°ç¨‹åºä¸­è¿›è¡Œä½¿ç”¨</li>
<li>ä½¿ç”¨ç›´æ¥å†…å­˜ï¼šç›´æ¥åˆ’åˆ†ä¸€å—ç›´æ¥å†…å­˜ï¼Œè¯¥å†…å­˜æ—¢å¯ä»¥æ“ä½œç³»ç»Ÿè®¿é—®ï¼Œåˆå¯ä»¥javaç¨‹åºè®¿é—®ï¼Œæé«˜æ–‡ä»¶çš„è¯»å–é€Ÿåº¦<br>
<a name="leNmD"></a></li>
</ul>
<h2 id="ç›´æ¥å†…å­˜çš„é‡Šæ”¾">ç›´æ¥å†…å­˜çš„é‡Šæ”¾</h2>
<ol>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645601651664-6f7a90db-a776-4825-953b-d16577c6f535-20220312195127410.png" alt="image.png" loading="lazy"></li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645601706459-6686f2e4-dc19-4957-aebd-a2c45ae191cd-20220312195127436.png" alt="image.png" loading="lazy"></li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645601844846-ef5e2258-db83-4586-8334-8e530d039397-20220312195127641.png" alt="image.png" loading="lazy"></li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645601808485-a093dd5f-4d3e-420a-a475-2aaa798531c7-20220312195127901.png" alt="image.png" loading="lazy"></li>
<li><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645601966473-12f1e35d-14b8-4cff-a1f7-eb2de788b46b-20220312195128064.png" alt="image.png" loading="lazy"></li>
<li>Cleanerä¸­çš„thisæŒ‡ByteBufferå¯¹è±¡ï¼Œå½“ByteBufferå¯¹è±¡è¢«åƒåœ¾å›æ”¶æ‰æ—¶ï¼Œå°±ä¼šè§¦å‘å…¶ä¸­çš„clean()æ–¹æ³•ã€‚åœ¨ReferenceHandlerçº¿ç¨‹ä¸­ç›‘æµ‹è™šå¼•ç”¨å¯¹è±¡ï¼Œä¸€æ—¦è™šå¼•ç”¨å¯¹è±¡å…³è”çš„å®é™…å¯¹è±¡(ByteBuffer)è¢«å›æ”¶ï¼Œå°±ä¼šæ‰§è¡Œclean()æ–¹æ³•ï¼Œæ‰§è¡Œä»»åŠ¡å¯¹è±¡(Deallocator)<br>
<a name="l2zr3"></a></li>
</ol>
<h2 id="åˆ†é…å’Œå›æ”¶">åˆ†é…å’Œå›æ”¶</h2>
<ul>
<li>ä½¿ç”¨äº†Unsafeå¯¹è±¡å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼Œå¹¶ä¸”å›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li>
<li>ByteBufferçš„å®ç°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº†Cleaner(è™šå¼•ç”¨)æ¥ç›‘æµ‹ByteBufferå¯¹è±¡ï¼Œä¸€æ—¦ByteBufferå¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç”±ReferenceHandlerçº¿ç¨‹é€šè¿‡Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ–¹æ³•æ¥é‡Šæ”¾å†…å­˜</li>
<li><code>-Xx:+DisableExplicitGC</code>ç¦ç”¨ä»£ç ä¸­æ˜¾å¼çš„åƒåœ¾å›æ”¶
<ul>
<li><code>System.gc()</code>æ˜¾å¼çš„åƒåœ¾å›æ”¶ï¼Œè§¦å‘FullGCï¼ŒåŒæ—¶æ¸…ç†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè€—è´¹æ—¶é—´è¾ƒé•¿</li>
<li>å¯èƒ½å¯¹ByteBufferæœ‰å½±å“ï¼Œå¯¼è‡´ç›´æ¥å†…å­˜å ç”¨è¾ƒå¤§
<ul>
<li>å¦‚éœ€ä½¿ç”¨<code>-Xx:+DisableExplicitGC</code>ï¼Œç›´æ¥å†…å­˜ä½¿ç”¨<code>unsafe.freeMemory()</code>ç®¡ç†ç›´æ¥å†…å­˜</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JVMå¼•è¨€]]></title>
        <id>https://yeyuan1107.github.io/post/jvm-yin-yan/</id>
        <link href="https://yeyuan1107.github.io/post/jvm-yin-yan/">
        </link>
        <updated>2022-02-15T13:09:38.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯jvm">ä»€ä¹ˆæ˜¯JVM</h1>
<p>Java Virtual Machine - Javaç¨‹åºçš„è¿è¡Œç¯å¢ƒ(JavaäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒ)<br>
<a name="o4x8y"></a></p>
<h1 id="jvmçš„å¥½å¤„">JVMçš„å¥½å¤„</h1>
<ol>
<li>Javaç¨‹åºä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œçš„åŸºçŸ³</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæä¾›äº†åƒåœ¾å›æ”¶çš„åŠŸèƒ½</li>
<li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</li>
<li>å¤šæ€<br>
<a name="dkaO8"></a></li>
</ol>
<h1 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h1>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645583640772-362689af-35bf-4ccd-a74b-a67477032489-20220312194953326.png" alt="iShot2022-02-22 10.41.00.png" loading="lazy"><br>
<a name="PdQ5k"></a></p>
<h1 id="å¸¸è§jvm">å¸¸è§JVM</h1>
<p><strong>æœ¬ç¬”è®°åŸºäºHotSpot</strong><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645583661822-54ab67ad-0ecb-47db-a0d3-4e3e14f88bea-20220312194953677.png" alt="iShot2022-02-22 10.58.18.png" loading="lazy"><br>
<a name="giZNB"></a></p>
<h1 id="å­¦ä¹ è·¯çº¿">å­¦ä¹ è·¯çº¿<img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/1645583698773-0f9a5c55-5b71-442f-a7b8-7b0c9227c4de-20220312194953952.png" alt="iShot2022-02-22 11.01.01.png" loading="lazy"></h1>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Java11æ–°ç‰¹æ€§]]></title>
        <id>https://yeyuan1107.github.io/post/java11-xin-te-xing/</id>
        <link href="https://yeyuan1107.github.io/post/java11-xin-te-xing/">
        </link>
        <updated>2021-12-05T13:21:46.000Z</updated>
        <content type="html"><![CDATA[<p><a name="Uhq1Z"></a></p>
<h1 id="stringæ–°å¢æ–¹æ³•">Stringæ–°å¢æ–¹æ³•</h1>
<ol>
<li>isBlank()ï¼šåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºç™½</li>
<li>strip()ï¼šå»é™¤é¦–å°¾ç©ºç™½</li>
<li>stripTrailing()ï¼šå»é™¤å°¾éƒ¨ç©ºæ ¼</li>
<li>stripLoading()ï¼šå»é™¤é¦–éƒ¨ç©ºæ ¼</li>
<li>repeat(int count)ï¼šå¤åˆ¶å­—ç¬¦ä¸²</li>
<li>lines().count()ï¼šè¡Œæ•°ç»Ÿè®¡<br>
<a name="PDR2I"></a></li>
</ol>
<h1 id="optionalåŠ å¼º">OptionalåŠ å¼º</h1>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/Optional%E5%A2%9E%E5%BC%BA.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=PZMGY&amp;originHeight=506&amp;originWidth=1407&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"><br>
<a name="fhRwc"></a></p>
<h1 id="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­çš„å‡çº§">å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­çš„å‡çº§</h1>
<p>åœ¨varä¸Šæ·»åŠ æ³¨è§£çš„è¯­æ³•æ ¼å¼ï¼Œåœ¨jdk10ä¸­æ˜¯ä¸èƒ½å®ç°çš„ã€‚åœ¨JDK11ä¸­åŠ å…¥äº†è¿™æ ·çš„è¯­æ³•</p>
<pre><code class="language-java">//é”™è¯¯çš„å½¢å¼ : å¿…é¡»è¦æœ‰ç±»å‹ , å¯ä»¥åŠ ä¸Š var
//Consumer&lt;String&gt; con1 = (@Deprecated t) --&gt;System.out.println(t.toUpperCase());
//æ­£ç¡®çš„å½¢å¼
//ä½¿ç”¨ var çš„å¥½å¤„æ˜¯åœ¨ä½¿ç”¨ lambda è¡¨è¾¾å¼æ—¶ç»™å‚æ•°åŠ ä¸Šæ³¨è§£ã€‚
Consumer&lt;String&gt; con2 = ( (@Deprecated var t) --&gt;System. out .println(t.UpperCase());
</code></pre>
<p><a name="wi6wy"></a></p>
<h1 id="å…¨æ–°çš„httpå®¢æˆ·ç«¯api">å…¨æ–°çš„HTTPå®¢æˆ·ç«¯API</h1>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/HttpClient-1-20220312153039410.png" alt="" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/HttpClient-2-20220312153039447.png" alt="" loading="lazy"><br>
<a name="RApG4"></a></p>
<h1 id="æ›´ç®€åŒ–çš„ç¼–è¯‘è¿è¡Œç¨‹åº">æ›´ç®€åŒ–çš„ç¼–è¯‘è¿è¡Œç¨‹åº</h1>
<p>JDK11ä¹‹å‰javac xxx.javajava xxx<br />JDK11åŠä¹‹åjava xxx.java</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong><br>
æ‰§è¡Œæºæ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªç±»ï¼Œç¬¬ä¸€ä¸ªç±»å¿…é¡»åŒ…å«ä¸»æ–¹æ³•<br />å¹¶ä¸”ä¸å¯ä»¥ä½¿ç”¨å…¶ä»–æºæ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰ç±»ï¼Œæœ¬æ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰ç±»æ˜¯å¯ä»¥ä½¿ç”¨çš„</p>
</blockquote>
<p><a name="u7ptS"></a></p>
<h1 id="åºŸå¼ƒnashornå¼•æ“">åºŸå¼ƒNashornå¼•æ“</h1>
<p>åºŸé™¤Nashorn javascript å¼•æ“ åœ¨åç»­ç‰ˆæœ¬å‡†å¤‡ç§»é™¤æ‰ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è€ƒè™‘ä½¿ç”¨ GraalVMã€‚<br>
<a name="wmh0f"></a></p>
<h1 id="zgc">ZGC</h1>
<ul>
<li>GC æ˜¯ java ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ ã€‚ ç„¶è€Œå½“ GC åœé¡¿å¤ªé•¿ å°±ä¼šå¼€å§‹å½±å“åº”ç”¨çš„å“åº”æ—¶é—´ ã€‚ æ¶ˆé™¤æˆ–è€…å‡å°‘ GC åœé¡¿æ—¶é•¿ java å°†å¯¹æ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯æ˜¯ä¸€ä¸ªæ›´æœ‰å¸å¼•åŠ›çš„å¹³å° ã€‚ æ­¤å¤– ç°ä»£ç³»ç»Ÿä¸­å¯ç”¨å†…å­˜ä¸æ–­å¢é•¿ç”¨æˆ·å’Œç¨‹åºå‘˜å¸Œæœ› JVM èƒ½å¤Ÿä»¥é«˜æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨è¿™äº›å†…å­˜ å¹¶ä¸”æ— éœ€é•¿æ—¶é—´çš„ GC æš‚åœæ—¶é—´ ã€‚</li>
<li>ZGC A Scalable Low Latency Garbage Collector(Experimental)ï¼Œè¿™åº”è¯¥æ˜¯ JDK 11 æœ€ä¸ºç©ç›®çš„ç‰¹æ€§æ²¡æœ‰ä¹‹ä¸€ã€‚ ä½†æ˜¯åé¢å¸¦äº† Experimentalï¼Œè¯´æ˜è¿™è¿˜ä¸å»ºè®®ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ZGC æ˜¯ä¸€ä¸ªå¹¶å‘ï¼ŒåŸºäº regionï¼Œå‹ç¼©å‹çš„åƒåœ¾æ”¶é›†å™¨åªæœ‰ root æ‰«æé˜¶æ®µä¼šSTW( stop the world )å› æ­¤ GC åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢é•¿å’Œå­˜æ´»å¯¹è±¡çš„å¢é•¿è€Œå˜é•¿<br>
<a name="K6VZ1"></a></li>
</ul>
<h2 id="ä¼˜åŠ¿">ä¼˜åŠ¿ï¼š</h2>
<ol>
<li>GC æš‚åœæ—¶é—´ä¸ä¼šè¶…è¿‡ 10 ms</li>
<li>æ—¢èƒ½å¤„ç†å‡ ç™¾å…†çš„å°å †ä¹Ÿèƒ½å¤„ç†å‡ ä¸ªTçš„å¤§å †</li>
<li>å’ŒG1ç›¸æ¯”åº”ç”¨ååèƒ½åŠ›ä¸ä¼šä¸‹é™è¶…è¿‡15%</li>
<li>ä¸ºæœªæ¥çš„GCåŠŸèƒ½å’Œåˆ©ç”¨ colord æŒ‡é’ˆä»¥åŠ Load barriers ä¼˜åŒ–å¥ å®šåŸºç¡€</li>
<li>åˆå§‹åªæ”¯æŒ 64 ä½ç³»ç»Ÿ</li>
</ol>
<ul>
<li>ZGC çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šæ”¯æŒ TB çº§å†…å­˜å®¹é‡æš‚åœæ—¶é—´ä½ 10 ms å¯¹æ•´ä¸ªç¨‹åºååé‡çš„å½±å“å°äº15%ã€‚ å°†æ¥è¿˜å¯ä»¥æ‰©å±•å®ç°æœºåˆ¶ï¼Œä»¥æ”¯æŒä¸å°‘ä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¤šå±‚å †(å³çƒ­å¯¹è±¡ç½®äº DRAM å’Œå†·å¯¹è±¡ç½®äº NVMe é—ªå­˜æˆ–å‹ç¼©å †)<br>
<a name="jltPJ"></a></li>
</ul>
<h1 id="å…¶ä»–æ–°ç‰¹æ€§">å…¶ä»–æ–°ç‰¹æ€§</h1>
<ul>
<li>Unicode 10</li>
<li>Deprecate the Pack200 Tools and API</li>
<li>æ–°çš„ Epsilon åƒåœ¾æ”¶é›†å™¨</li>
<li>å®Œå…¨æ”¯æŒ Linux å®¹å™¨(åŒ…æ‹¬ Docker)</li>
<li>æ”¯æŒ G1 ä¸Šçš„å¹¶è¡Œå®Œå…¨åƒåœ¾æ”¶é›†</li>
<li>æœ€æ–°çš„ HTTPS å®‰å…¨åè®® TLS 1.3</li>
<li>Java Flight Recorder</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Java10æ–°ç‰¹æ€§]]></title>
        <id>https://yeyuan1107.github.io/post/java10-xin-te-xing/</id>
        <link href="https://yeyuan1107.github.io/post/java10-xin-te-xing/">
        </link>
        <updated>2021-12-05T13:21:22.000Z</updated>
        <content type="html"><![CDATA[<p><a name="xhmxg"></a></p>
<h1 id="å±€éƒ¨å˜é‡çš„ç±»å‹æ¨æ–­">å±€éƒ¨å˜é‡çš„ç±»å‹æ¨æ–­</h1>
<pre><code class="language-java">//å¼•ç”¨å‹å˜é‡ä¹Ÿå¯ä»¥
//åœ¨å¤„ç†varæ—¶ï¼Œç¼–è¯‘å™¨å…ˆæ˜¯æŸ¥çœ‹è¡¨è¾¾å¼å³è¾¹éƒ¨åˆ†ï¼Œå¹¶æ ¹æ®å³è¾¹å˜é‡å€¼çš„ç±»å‹è¿›è¡Œæ¨æ–­ï¼Œä½œä¸ºå·¦è¾¹å˜é‡çš„ç±»å‹ï¼Œç„¶åå°†è¯¥ç±»å‹å†™å…¥å­—èŠ‚ç å½“ä¸­
var å˜é‡å = xxx;
</code></pre>
<p>ä¸èƒ½ç”¨çš„æƒ…å†µ</p>
<ol>
<li>å±€éƒ¨å˜é‡ä¸èµ‹å€¼</li>
<li>Lambdaè¡¨è¾¾å¼ä¸­å·¦è¾¹çš„å‡½æ•°å¼æ¥å£ä¸èƒ½å£°æ˜ä¸ºvar</li>
<li>æ–¹æ³•å¼•ç”¨</li>
<li>æ•°ç»„çš„é™æ€åˆå§‹åŒ–<code>int[] arr = {1, 2, 3, 4, 5}</code></li>
<li>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</li>
<li>æ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹ã€æ„é€ å™¨å‚æ•°ç±»å‹</li>
<li>å±æ€§</li>
<li>catchå—</li>
</ol>
<blockquote>
<p>æ³¨æ„<br>
varä¸æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œé™¤äº†ä¸èƒ½ç”¨å®ƒä½œä¸ºç±»åï¼Œå…¶ä»–çš„éƒ½å¯ä»¥<br>
varå¹¶ä¸ä¼šæ”¹å˜Javaæ—¶ä¸€é—¨é™æ€ç±»å‹è¯­è¨€çš„äº‹å®</p>
</blockquote>
<p><a name="fL1jZ"></a></p>
<h1 id="é›†åˆæ–°å¢åˆ›å»ºä¸å¯å˜é›†åˆçš„æ–¹æ³•">é›†åˆæ–°å¢åˆ›å»ºä¸å¯å˜é›†åˆçš„æ–¹æ³•</h1>
<pre><code class="language-java">//ç¤ºä¾‹ 1
var list1 = List.of(&quot; Java&quot;, &quot; Python&quot;, &quot;C&quot;);
var copy1 = List.copyOf(list1);
System.out.println(list1 == copy1); // true
//ç¤ºä¾‹ 2
var list2 = new ArrayList&lt;String&gt;();
var copy2 = List.copyOf(list2);
System.out.println(list2 == copy2); // false
//ç¤ºä¾‹ 1 å’Œ 2 ä»£ç åŸºæœ¬ä¸€è‡´ï¼Œ ä¸ºä»€ä¹ˆä¸€ä¸ªä¸º true, ä¸€ä¸ªä¸º false?
//å¦‚æœå½“å‰é›†åˆå·²ç»æ˜¯åªè¯»é›†åˆï¼Œé‚£ä¹ˆcopyOf()è¿”å›å€¼ä¸ºå½“å‰é›†åˆ
//å¦‚æœä¸æ˜¯åªè¯»é›†åˆcopyOf()è¿”å›ä¸€ä¸ªæ–°çš„é›†åˆï¼Œè¯¥é›†åˆæ˜¯åªè¯»çš„
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Java9æ–°ç‰¹æ€§]]></title>
        <id>https://yeyuan1107.github.io/post/java9-xin-te-xing/</id>
        <link href="https://yeyuan1107.github.io/post/java9-xin-te-xing/">
        </link>
        <updated>2021-12-04T13:20:40.000Z</updated>
        <content type="html"><![CDATA[<p><a name="FPuvW"></a></p>
<h1 id="jdkå’Œjreç»“æ„çš„æ”¹å˜">JDKå’ŒJREç»“æ„çš„æ”¹å˜</h1>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/JDK%E5%92%8CJRE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E7%9A%84%E6%94%B9%E5%8F%98.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=diP8p&amp;originHeight=823&amp;originWidth=1357&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/JDK%E5%92%8CJRE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E7%9A%84%E6%94%B9%E5%8F%98-1.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=EhREH&amp;originHeight=763&amp;originWidth=1601&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"><br />æ¨¡å—åŒ–ç³»ç»Ÿ</p>
<ul>
<li>Jigsaw -&gt; Modularity</li>
<li>éšç€Javaçš„å‘å±•ï¼ŒJavaè¿è¡Œç¯å¢ƒè†¨èƒ€å’Œè‡ƒè‚¿ï¼Œæ¯æ¬¡JVMå¯åŠ¨çš„æ—¶å€™ï¼Œè‡³å°‘ä¼šæœ‰30-60MBçš„å†…å­˜åŠ è½½ï¼Œä¸»è¦åŸå› æ˜¯JVMéœ€è¦åŠ è½½rt.jar</li>
<li>æœ¬è´¨ä¸Šè®²ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æ¨¡å—æ¥ç®¡ç†å„ä¸ªpackageï¼Œé€šè¿‡å£°æ˜æŸä¸ªpackageæš´éœ²ï¼Œæ¨¡å—(module)çš„æ¦‚å¿µï¼Œå…¶å®å°±æ˜¯packageå¤–å†è£¹ä¸€å±‚ï¼Œä¸å£°æ˜é»˜è®¤å°±æ˜¯éšè—ã€‚å› æ­¤ï¼Œæ¨¡å—åŒ–ä½¿å¾—ä»£ç ç»„ç»‡ä¸Šæ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æŒ‡å®šå“ªäº›éƒ¨åˆ†å¯ä»¥æš´éœ²ï¼Œå“ªäº›éƒ¨åˆ†éšè—
<ul>
<li>æ¨¡å—ç”»çš„ä¸»è¦ç›®çš„åœ¨äºå‡å°‘å†…å­˜çš„å¼€é”€</li>
<li>åªé¡»å¿…è¦æ¨¡å—ï¼Œè€Œéå…¨éƒ¨jdkæ¨¡å—ï¼Œå¯è§è¯å„ç§ç±»åº“å’Œå¤§å‹åº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤</li>
<li>æ”¹è¿›JavaSEå¹³å°ï¼Œä½¿å…¶å¯ä»¥é€‚åº”ä¸åŒå¤§å°çš„è®¡ç®—è®¾å¤‡</li>
<li>æ”¹è¿›å…¶å®‰å…¨æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼Œæé«˜æ€§èƒ½</li>
</ul>
</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/%E6%A8%A1%E5%9D%97%E5%8C%96.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=HwMJo&amp;originHeight=769&amp;originWidth=1544&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/%E6%A8%A1%E5%9D%97%E5%8C%96-1.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=WzVET&amp;originHeight=679&amp;originWidth=1340&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/%E6%A8%A1%E5%9D%97%E5%8C%96-2.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=pfuhb&amp;originHeight=666&amp;originWidth=1137&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" loading="lazy"></p>
<ul>
<li>Javaçš„REPLå·¥å…·ï¼šjShell å‘½ä»¤
<ul>
<li>REPL(read-evaluate-print-loop)ï¼Œä»¥äº¤äº’å¼çš„æ–¹å¼å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡Œæ±‚èŒã€‚å¼€å‘è€…åªéœ€è¦è¾“å…¥ä¸€äº›ä»£ç ï¼Œå°±å¯ä»¥åœ¨ç¼–è¯‘å‰è·å¾—å¯¹ç¨‹åºçš„åé¦ˆ</li>
</ul>
</li>
<li>å¤šç‰ˆæœ¬å…¼å®¹ jar åŒ…</li>
<li>æ¥å£çš„ç§æœ‰æ–¹æ³•
<ul>
<li>JDK8ä¸­å¢åŠ äº†staticæ–¹æ³•å’Œé»˜è®¤æ–¹æ³•</li>
<li>JDK9æ¥å£ä¸­çš„æ–¹æ³•å¯ä»¥æ˜¯privateçš„</li>
</ul>
</li>
<li>é’»çŸ³æ“ä½œç¬¦çš„ä½¿ç”¨å‡çº§
<ul>
<li>JDK9ä¸­åŒ¿åå®ç°ç±»é’»çŸ³æ“ä½œç¬¦ä¸­çš„ç±»å‹å¯ä»¥çœç•¥<code>Comparator\&lt;Object&gt; com = new Comparator\&lt;&gt;()</code>	ï¼ŒJDK8ä¸­ä¼šæŠ¥é”™</li>
</ul>
</li>
<li>è¯­æ³•æ”¹è¿›ï¼š try è¯­å¥
<ul>
<li>JDK8ä¹‹å‰ï¼Œèµ„æºçš„å…³é—­æ”¾åœ¨finallyä¸­ã€‚JDK8ä¸­ï¼Œå¯ä»¥å®ç°èµ„æºçš„è‡ªåŠ¨å…³é—­ï¼Œä½†æ˜¯è¦æ±‚æ‰§è¡Œåå¿…é¡»å…³é—­çš„æ‰€æœ‰èµ„æºå¿…é¡»åœ¨tryå­å¥ä¸­åˆå§‹åŒ–(catchåè‡ªåŠ¨å…³é—­æ‹¬å·ä¸­åˆ›å»ºçš„èµ„æº)ï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚JDK9ä¸­ï¼Œç”¨èµ„æºè¯­å¥ç¼–å†™tryå°†æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨tryå­—å¥ä¸­ä½¿ç”¨å·²ç»åˆå§‹åŒ–è¿‡çš„èµ„æºï¼Œæ­¤æ—¶çš„èµ„æºæ˜¯finalçš„</li>
</ul>
</li>
</ul>
<p><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/JDK8-try-20220312152941311.png" alt="" loading="lazy"><br /><img src="http://yuanye1107.oss-cn-shanghai.aliyuncs.com/img/JDK9-try-20220312152941335.png" alt="" loading="lazy"></p>
<ul>
<li>String å­˜å‚¨ç»“æ„å˜æ›´
<ul>
<li>Stringä»char[] -&gt; byte[]åŒæ—¶åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ç©ºé—´ã€‚</li>
<li>StringBufferå’ŒStringBuilderåŒæ ·æ›´æ”¹</li>
</ul>
</li>
<li>å¿«é€Ÿåˆ›å»ºåªè¯»é›†åˆï¼š of()
<ul>
<li>Java8ä¸­ï¼šCollections.unmodifiableList(é›†åˆå)ï¼ŒArrays.asList(Object[] objs)</li>
<li>Java9ä¸­ï¼š
<ul>
<li>static <E> List<E> LIst.of(E e1, E e2, ... , E en)</li>
<li>Set.of()</li>
<li>Map.of()</li>
<li>Map.ofEntries()</li>
</ul>
</li>
</ul>
</li>
<li>å¢å¼ºçš„ Stream API
<ul>
<li>åœ¨ Java 9 ä¸­ï¼Œ Stream API å˜å¾—æ›´å¥½ï¼Œ Stream æ¥å£ä¸­æ·»åŠ äº† 4 ä¸ªæ–°çš„æ–¹æ³•takeWhile , dropWhile, ofNullable ï¼Œè¿˜æœ‰ä¸ª iterate æ–¹æ³•çš„æ–°é‡è½½æ–¹æ³• ï¼Œå¯ä»¥è®©ä½ æä¾›ä¸€ä¸ª Predicate ( åˆ¤æ–­æ¡ä»¶ æ¥æŒ‡å®šä»€ä¹ˆæ—¶å€™ç»“æŸè¿­ä»£ ã€‚
<ul>
<li>takeWhile(predicate)è¿”å›ä»å¼€å¤´å¼€å§‹çš„å°½é‡å¤šçš„å…ƒç´ ï¼Œä»å¼€å¤´åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„ï¼ŒPredicateä¸ºå‡½æ•°å¼æ¥å£</li>
<li>dropWhile(predicate)ä¸takeWhile()ç›¸åï¼Œè¿”å›ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ åŠå…¶ä¹‹åçš„å…ƒç´ </li>
<li>ofNullable()å½¢å‚å˜é‡æ˜¯å¯ä»¥ä¸ºnullå€¼çš„å•ä¸ªå…ƒç´ </li>
<li>iterate(seed, predicate, UnaryOperator)é‡è½½æ–¹æ³•ï¼ŒæŒ‡å®šä»€ä¹ˆæ—¶å€™ç»“æŸè¿­ä»£</li>
</ul>
</li>
<li>é™¤äº†å¯¹ Stream æœ¬èº«çš„æ‰©å±•ï¼Œ Optional å’Œ Stream ä¹‹é—´çš„ç»“åˆä¹Ÿå¾—åˆ°äº†æ”¹è¿›ã€‚ç°åœ¨å¯ä»¥é€šè¿‡ Optional çš„æ–°æ–¹æ³• stream() å°†ä¸€ä¸ª Optional å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ª(å¯èƒ½æ˜¯ç©ºçš„) Stream å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>InputStreamåŠ å¼º
<ul>
<li>InputStreamå¢åŠ æ–¹æ³•transferTo(OutputStream)ï¼Œç›´æ¥å°†è¾“å…¥æµçš„æ‰€æœ‰æ•°æ®è‡ªåŠ¨åœ°å¤åˆ¶åˆ°è¾“å‡ºæµä¸­</li>
</ul>
</li>
<li>å…¨æ–° çš„ HTTP å®¢æˆ·ç«¯ API</li>
<li>Deprecated çš„ç›¸å…³ API</li>
<li>javadoc çš„ HTML 5 æ”¯æŒ</li>
<li>Javascript å¼•æ“å‡çº§ï¼š Nashorn</li>
<li>java çš„åŠ¨æ€ ç¼–è¯‘å™¨</li>
</ul>
]]></content>
    </entry>
</feed>